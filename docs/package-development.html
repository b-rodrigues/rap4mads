<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Package development | Reproducible Analytical Pipelines - Master’s of Data Science</title>
  <meta name="description" content="Chapter 5 Package development | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Package development | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Package development | Reproducible Analytical Pipelines - Master’s of Data Science" />
  
  
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-10-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="git.html"/>
<link rel="next" href="unit-tests.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAP4MADS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducible-analytical-pipelines"><i class="fa fa-check"></i><b>1.2</b> Reproducible analytical pipelines?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-products"><i class="fa fa-check"></i><b>1.3</b> Data products?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.4</b> Machine learning?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-r-why-not-insert-your-favourite-programming-language"><i class="fa fa-check"></i><b>1.5</b> Why R? Why not [insert your favourite programming language]</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i><b>1.6</b> Pre-requisites</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.7</b> Grading</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#jargon"><i class="fa fa-check"></i><b>1.8</b> Jargon</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#further-reading"><i class="fa fa-check"></i><b>1.9</b> Further reading</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.10</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-in-data-with-r"><i class="fa fa-check"></i><b>2.1</b> Reading in data with R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-little-aside-on-pipes"><i class="fa fa-check"></i><b>2.2</b> A little aside on pipes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exploring-and-cleaning-data-with-r"><i class="fa fa-check"></i><b>2.3</b> Exploring and cleaning data with R</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>2.4</b> Data visualization</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#further-reading-1"><i class="fa fa-check"></i><b>2.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html"><i class="fa fa-check"></i><b>3</b> A primer on functional programming</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#defining-your-own-functions"><i class="fa fa-check"></i><b>3.2</b> Defining your own functions</a></li>
<li class="chapter" data-level="3.3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a></li>
<li class="chapter" data-level="3.4" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#further-reading-2"><i class="fa fa-check"></i><b>3.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#installing-git"><i class="fa fa-check"></i><b>4.2</b> Installing Git</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#setting-up-a-repo"><i class="fa fa-check"></i><b>4.3</b> Setting up a repo</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#cloning-the-repository-onto-your-computer"><i class="fa fa-check"></i><b>4.4</b> Cloning the repository onto your computer</a></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#your-first-commit"><i class="fa fa-check"></i><b>4.5</b> Your first commit</a></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#collaborating"><i class="fa fa-check"></i><b>4.6</b> Collaborating</a></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#branches"><i class="fa fa-check"></i><b>4.7</b> Branches</a></li>
<li class="chapter" data-level="4.8" data-path="git.html"><a href="git.html#contributing-to-someone-elses-repository"><i class="fa fa-check"></i><b>4.8</b> Contributing to someone else’s repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>5</b> Package development</a>
<ul>
<li class="chapter" data-level="5.1" data-path="package-development.html"><a href="package-development.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="package-development.html"><a href="package-development.html#getting-started"><i class="fa fa-check"></i><b>5.2</b> Getting started</a></li>
<li class="chapter" data-level="5.3" data-path="package-development.html"><a href="package-development.html#adding-functions"><i class="fa fa-check"></i><b>5.3</b> Adding functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="package-development.html"><a href="package-development.html#functions-dependencies"><i class="fa fa-check"></i><b>5.3.1</b> Functions dependencies</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="package-development.html"><a href="package-development.html#documentation"><i class="fa fa-check"></i><b>5.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="package-development.html"><a href="package-development.html#documenting-functions"><i class="fa fa-check"></i><b>5.4.1</b> Documenting functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="package-development.html"><a href="package-development.html#documenting-the-package"><i class="fa fa-check"></i><b>5.4.2</b> Documenting the package</a></li>
<li class="chapter" data-level="5.4.3" data-path="package-development.html"><a href="package-development.html#checking-your-package"><i class="fa fa-check"></i><b>5.4.3</b> Checking your package</a></li>
<li class="chapter" data-level="5.4.4" data-path="package-development.html"><a href="package-development.html#installing-your-package"><i class="fa fa-check"></i><b>5.4.4</b> Installing your package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>6</b> Unit tests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unit-tests.html"><a href="unit-tests.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="unit-tests.html"><a href="unit-tests.html#testing-your-package"><i class="fa fa-check"></i><b>6.2</b> Testing your package</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="unit-tests.html"><a href="unit-tests.html#is-the-function-returning-an-expected-value-for-a-given-input"><i class="fa fa-check"></i><b>6.2.1</b> Is the function returning an expected value for a given input?</a></li>
<li class="chapter" data-level="6.2.2" data-path="unit-tests.html"><a href="unit-tests.html#can-the-function-deal-with-all-kinds-of-input"><i class="fa fa-check"></i><b>6.2.2</b> Can the function deal with all kinds of input?</a></li>
<li class="chapter" data-level="6.2.3" data-path="unit-tests.html"><a href="unit-tests.html#back-to-developing-again"><i class="fa fa-check"></i><b>6.2.3</b> Back to developing again</a></li>
<li class="chapter" data-level="6.2.4" data-path="unit-tests.html"><a href="unit-tests.html#and-back-to-testing"><i class="fa fa-check"></i><b>6.2.4</b> And back to testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html"><i class="fa fa-check"></i><b>7</b> Setting up pipelines with <code>{targets}</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#build-automation-with-r"><i class="fa fa-check"></i><b>7.2</b> Build automation with R</a></li>
<li class="chapter" data-level="7.3" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#an-aside-on-renv"><i class="fa fa-check"></i><b>7.3</b> An aside on <code>{renv}</code></a></li>
<li class="chapter" data-level="7.4" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#our-actual-first-pipeline"><i class="fa fa-check"></i><b>7.4</b> Our actual first pipeline</a></li>
<li class="chapter" data-level="7.5" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-someone-elses-pipeline"><i class="fa fa-check"></i><b>7.5</b> Running someone else’s pipeline</a></li>
<li class="chapter" data-level="7.6" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-any-code-with-older-packages"><i class="fa fa-check"></i><b>7.6</b> Running any code with older packages</a></li>
<li class="chapter" data-level="7.7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#why-we-need-more"><i class="fa fa-check"></i><b>7.7</b> Why we need more</a></li>
<li class="chapter" data-level="7.8" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#further-reading-3"><i class="fa fa-check"></i><b>7.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-products-1.html"><a href="data-products-1.html"><i class="fa fa-check"></i><b>8</b> Data products</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-products-1.html"><a href="data-products-1.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="data-products-1.html"><a href="data-products-1.html#a-first-taste-of-quarto"><i class="fa fa-check"></i><b>8.2</b> A first taste of Quarto</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-products-1.html"><a href="data-products-1.html#python-and-julia-code-chunks"><i class="fa fa-check"></i><b>8.2.1</b> Python and Julia code chunks</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-products-1.html"><a href="data-products-1.html#other-output-formats"><i class="fa fa-check"></i><b>8.3</b> Other output formats</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-products-1.html"><a href="data-products-1.html#word"><i class="fa fa-check"></i><b>8.3.1</b> Word</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-products-1.html"><a href="data-products-1.html#presentations"><i class="fa fa-check"></i><b>8.3.2</b> Presentations</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-products-1.html"><a href="data-products-1.html#pdf"><i class="fa fa-check"></i><b>8.3.3</b> PDF</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-products-1.html"><a href="data-products-1.html#interactive-web-applications-with-shiny"><i class="fa fa-check"></i><b>8.4</b> Interactive web applications with {shiny}</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-products-1.html"><a href="data-products-1.html#the-basic-structure-of-a-shiny-app"><i class="fa fa-check"></i><b>8.4.1</b> The basic structure of a Shiny app</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-products-1.html"><a href="data-products-1.html#references"><i class="fa fa-check"></i><b>8.4.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-products-1.html"><a href="data-products-1.html#how-to-build-data-products-using-targets"><i class="fa fa-check"></i><b>8.5</b> How to build data products using <code>{targets}</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html"><i class="fa fa-check"></i><b>9</b> Self-contained RAPs with Docker</a></li>
<li class="chapter" data-level="10" data-path="cicd-with-github-actions.html"><a href="cicd-with-github-actions.html"><i class="fa fa-check"></i><b>10</b> CI/CD with Github Actions</a></li>
<li class="chapter" data-level="11" data-path="what-else-should-you-learn.html"><a href="what-else-should-you-learn.html"><i class="fa fa-check"></i><b>11</b> What else should you learn?</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a>
<ul>
<li class="chapter" data-level="12.1" data-path="conclusion.html"><a href="conclusion.html#why-bother"><i class="fa fa-check"></i><b>12.1</b> Why bother</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/b-rodrigues/rap4mads" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Analytical Pipelines - Master’s of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="package-development" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Package development<a href="package-development.html#package-development" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div style="text-align:center;">
<p><img src="img/painting_of_a_package.png" width="512" /></p>
</div>
<p>What you’ll have learned by the end of the chapter: building and documenting your own package.</p>
<div id="introduction-3" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction<a href="package-development.html#introduction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this chapter we’re going to develop our own package. This package will contain
some functions that we will write to analyze some data.
Don’t focus too much on what these functions do or don’t do, that’s not really important.
What matters is that you understand how to build your own package, and why that’s useful.</p>
<p>R, as you know, has many many packages. When you type something like</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="package-development.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<p>This installs the <code>{dplyr}</code> package. The package gets downloaded from a repository called
CRAN - The Comprehensive R Archive Network (or from one of its mirrors). Developers thus
work on their packages and once they feel the package is ready for production they submit
it to CRAN. There are very strict rules to respect to publish on CRAN; but if the developers
respects these rules, and the package does something <em>non-trivial</em> (non-trivial is not really defined
but the idea is that your package cannot simply be a collection of your own implementation
of common mathematical functions for example), it’ll get published.</p>
<p>CRAN is actually quite a miracle; it works really well, and it’s been working well for decades,
since CRAN was founded in <a href="https://stat.ethz.ch/pipermail/r-announce/1997/000001.html">1997</a>.
Installing packages on R is rarely frustrating, and when it is, it is rarely, if ever,
CRAN’s fault (there are some packages that require your operating system to have certain
libraries or programs installed beforehand, and these can be frustrating to install, like <code>java</code>
or certain libraries used for geospatial statistics).</p>
<p>But while from the point of view from the user, CRAN is great, there are sometimes some
frictions between package developers and CRAN maintainers. I’ll spare you the drama, but just
know that contributing to CRAN can be sometimes frustrating.</p>
<p>This does not concern us however, because we are going to learn how to develop a package but
we are not going to publish it on CRAN. Instead, we will be using github.com as a replacement
for CRAN. This has the advantage that we do not have to be so strict and disciplined when
writing our package, and other users can install the package almost just as easily from
github.com, with the following command:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="package-development.html#cb76-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;github_username/some_package&quot;</span>)</span></code></pre></div>
<p>It is also possible to build the package and send it as a file per email for example, and then
install a local copy. This is more cumbersome, that’s why we’re going to use github.com as a
repository.</p>
</div>
<div id="getting-started" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Getting started<a href="package-development.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s first start by opening RStudio, and start a new project:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/new_package.mp4" type="video/mp4">
</video>
</div>
<p>Following these steps creates a folder in the specified path that already contains
some scaffolding for our package. This also opens a new RStudio session with the
default script <code>hello.R</code> opened:</p>
<div style="text-align:center;">
<p><img src="img/pack_1.png" width="1089" /></p>
</div>
<p>We can remove this script, but do take note of the following sentence:</p>
<pre><code># You can learn more about package authoring with RStudio at:
#
#   http://r-pkgs.had.co.nz/
#</code></pre>
<p>If this course succeeded in turning you into an avid R programmer, you might want to contribute
to the language by submitting some nice packages one day. You could at that point refer to this link
to learn the many, many subtleties of package development. But for our purposes, this chapter
will suffice.</p>
<p>Ok, so now let’s take a look inside the folder you just created and take a look at the package’s
structure. You can do so easily from within RStudio:</p>
<div style="text-align:center;">
<p><img src="img/pack_2.png" width="1086" /></p>
</div>
<p>But you can also navigate to the folder from inside a file explorer. The folder that will
matter to us the most for now is the <code>R</code> folder. This folder will contain your scripts, which
will contain your package’s functions. Let’s start by adding a new script.</p>
</div>
<div id="adding-functions" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Adding functions<a href="package-development.html#adding-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To add a new script, simply create a new script, and while we’re at it, let’s add some code to it:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/pack_adding_script.mp4" type="video/mp4">
</video>
</div>
<p>and that’s it! Well, this example is incredibly easy; there will be more subtleties later on,
but these are the basics: simply write your script as usual. Now let’s load the package with
<code>CTRL-SHIFT-L</code>. Loading the package makes it available in your current R session:</p>
<div style="text-align:center;">
<p><img src="img/pack_3.png" width="578" /></p>
</div>
<p>As you can see, the package is loaded, and RStudio’s autocomplete even suggest the function’s name
already. So now that we have already a function, let’s push our code to github.com (you remember that
we checked the box <code>Create a git repository</code> when we started the project?). For this,
let’s go back to github.com and create a new repository. Give it the same name as your package
on your computer, just to avoid confusion. Once the repo is created, you will see this familiar
screen:</p>
<div style="text-align:center;">
<p><img src="img/pack_4.png" width="915" /></p>
</div>
<p>We will start from an existing repository, because our repository already exists. So we can
use the terminal to enter the commands suggested here. We can also use the terminal
from RStudio:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/adding_remote.mp4" type="video/mp4">
</video>
</div>
<p>The steps above are a way to link your local repository to the remote repository living
on github.com. Without these initial steps, there is no way to link your package project
to github.com!</p>
<p>Let’s now write another function, which will depend on functions from other packages.</p>
<div id="functions-dependencies" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Functions dependencies<a href="package-development.html#functions-dependencies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the same script, add the following code:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="package-development.html#cb78-1" aria-hidden="true" tabindex="-1"></a>only_automatics <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset){</span>
<span id="cb78-2"><a href="package-development.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="package-development.html#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb78-4"><a href="package-development.html#cb78-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This creates a function that takes a dataset as an argument, and filters the <code>am</code> variable.
This function is not great: it is not documented, so the user might not know that the dataset
that is meant here is the <code>mtcars</code> dataset (which is included with R by default). So we will
need to document this. Also, the variable <code>am</code> is hardcoded, that’s not good either. What if
the user wants to filter another variable with another value? We will solve these issues later
on. But there is a worse problem here. The <code>filter()</code> function that the developer intended to
use here is <code>dplyr::filter()</code>, so the one from the <code>{dplyr}</code> package. However, there are several
functions called <code>filter()</code>. If you start typing <code>filter</code> inside a fresh R session, this is
what autocomplete suggests:</p>
<div style="text-align:center;">
<p><img src="img/pack_5.png" width="460" /></p>
</div>
<p>So there’s a <code>filter()</code> function from the <code>{stats}</code> package (which gets loaded automatically
with every new R session), and there’s a capital F <code>Filter()</code> function from the <code>{base}</code>
package (R is case sensitive, so <code>filter()</code> and <code>Filter()</code> are different functions).
So how can the developer specify the correct <code>filter()</code> function? Simply by using the following
notation: <code>dplyr::filter()</code> (which we have already encountered). So let’s rewrite the function
correctly:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="package-development.html#cb79-1" aria-hidden="true" tabindex="-1"></a>only_automatics <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset){</span>
<span id="cb79-2"><a href="package-development.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="package-development.html#cb79-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb79-4"><a href="package-development.html#cb79-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Great, so now <code>only_automatics()</code> at least knows which <code>filter</code> function to use, but this function
could be improved a lot more. In general, what you want is to have a function that is general enough
that it could work with any variable (if the dataset is supposed to be fixed), or that could work
with any combination of dataset and variable. Let’s make our function a bit more general,
by making it work on any variable from any dataset:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="package-development.html#cb80-1" aria-hidden="true" tabindex="-1"></a>my_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, condition){</span>
<span id="cb80-2"><a href="package-development.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="package-development.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(condition)</span>
<span id="cb80-4"><a href="package-development.html#cb80-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I renamed the function to <code>my_filter()</code> because now this function can work on any dataset and
with any predicate condition (of course this function is not really useful, since it’s only a
wrapper around <code>filter()</code>. But that’s not important). Let’s save the script and reload the
package with <code>CRTL-SHIFT-L</code> and try out the function:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="package-development.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_filter</span>(mtcars, am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>You will get this output:</p>
<pre><code>Error in `dplyr::filter()` at myPackage/R/functions.R:6:4:
! Problem while computing `..1 = condition`.
Caused by error in `mask$eval_all_filter()`:
! object &#39;am&#39; not found
Run `rlang::last_error()` to see where the error occurred.</code></pre>
<p>so what’s going on? R complains that it cannot find <code>am</code>.
What is wrong with our function? After all, if I call the following, it works:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="package-development.html#cb83-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="package-development.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora  15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<p>So what gives? What’s going on here, is that R doesn’t know that it has look
for <code>am</code> inside the <code>mtcars</code> dataset. R is looking for a variable called <code>am</code>
in the global environment, which does not exist. <code>dplyr::filter()</code> is programmed
in a way that tells R to look for <code>am</code> inside <code>mtcars</code> and not in the global
environment (or whatever parent environment the function gets called from).
We need to program our function in the same way. Remember in chapter 3, where
we learned about functions that take columns of data frames as arguments? This
is exactly the same situtation here. So, let’s simply enclose
references to columns of data frames inside <code>{{}}</code>, like so:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="package-development.html#cb85-1" aria-hidden="true" tabindex="-1"></a>my_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, condition){</span>
<span id="cb85-2"><a href="package-development.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="package-development.html#cb85-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>({{condition}})</span>
<span id="cb85-4"><a href="package-development.html#cb85-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, R knows where to look. So reload the package with <code>CTRL-SHIFT-L</code> and
try again:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="package-development.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_filter</span>(mtcars, am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora  15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<p>And it’s working!</p>
<p><code>{{}}</code> is not a feature available in a base installation of R, but is provided
by packages from the <code>tidyverse</code> (like <code>{dplyr}</code>, <code>{tidyr}</code>, etc). If you write functions
that depend on <code>{dplyr}</code> functions like <code>filter()</code>, <code>select()</code> etc, you’ll have to know
keep using <code>{{}}</code>.</p>
<p>Let’s now write a more useful function. Remember the datasets about unemployment in Luxembourg?
I’m thinking about the ones <a href="https://rap4mads.eu/introduction-to-r.html#reading-in-data-with-r">here</a>,
<code>unemp_2013.csv</code>, <code>unemp_2014.csv</code>, etc.</p>
<p>Let’s write a function that does some basic transformations on these files:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="package-development.html#cb88-1" aria-hidden="true" tabindex="-1"></a>clean_unemp <span class="ot">&lt;-</span> <span class="cf">function</span>(unemp_data, level, col_of_interest){</span>
<span id="cb88-2"><a href="package-development.html#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="package-development.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  unemp_data <span class="sc">|&gt;</span></span>
<span id="cb88-4"><a href="package-development.html#cb88-4" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb88-5"><a href="package-development.html#cb88-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>({{level}}) <span class="sc">|&gt;</span></span>
<span id="cb88-6"><a href="package-development.html#cb88-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(year, commune, {{col_of_interest}})</span>
<span id="cb88-7"><a href="package-development.html#cb88-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This function does 3 things:</p>
<ul>
<li>using <code>janitor::clean_names()</code>, it cleans the column names;</li>
<li>it filters on a user supplied level. This is because the csv file contains three “regional” levels so to speak: the whole country: first row, where commune equals <code>Grand-Duché de Luxembourg</code>, canton level: where commune contains the string <code>Canton</code> and the last level: the actual communes. Welcome to the real world, where data is dirty and does not always make sense.</li>
<li>it selects the columns that interest us (with year and commune hardcoded, because we always want those)</li>
</ul>
<p>So save the script, and reload your package using <code>CTRL-SHIFT-L</code>, and try with the following lines:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="package-development.html#cb89-1" aria-hidden="true" tabindex="-1"></a>unemp_2013 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2013.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 118 Columns: 8
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Commune
## dbl (7): Total employed population, of which: Wage-earners, of which: Non-wa...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="package-development.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(unemp_2013,</span>
<span id="cb91-2"><a href="package-development.html#cb91-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">grepl</span>(<span class="st">&quot;Grand-D.*&quot;</span>, commune),</span>
<span id="cb91-3"><a href="package-development.html#cb91-3" aria-hidden="true" tabindex="-1"></a>            active_population)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    year commune                   active_population
##   &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
## 1  2013 Grand-Duche de Luxembourg            242694</code></pre>
<p>This selects the columns for the whole country. Let’s try for cantons:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="package-development.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(unemp_2013,</span>
<span id="cb93-2"><a href="package-development.html#cb93-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune),</span>
<span id="cb93-3"><a href="package-development.html#cb93-3" aria-hidden="true" tabindex="-1"></a>            active_population)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##     year commune             active_population
##    &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt;
##  1  2013 Canton Capellen                 18873
##  2  2013 Canton Esch                     73063
##  3  2013 Canton Luxembourg               68368
##  4  2013 Canton Mersch                   13774
##  5  2013 Canton Clervaux                  7936
##  6  2013 Canton Diekirch                 14056
##  7  2013 Canton Redange                   7902
##  8  2013 Canton Vianden                   2280
##  9  2013 Canton Wiltz                     6670
## 10  2013 Canton Echternach                7967
## 11  2013 Canton Grevenmacher             12254
## 12  2013 Canton Remich                    9551</code></pre>
<p>And to select for communes, we need to not select cantons nor the whole country:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="package-development.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(unemp_2013,</span>
<span id="cb95-2"><a href="package-development.html#cb95-2" aria-hidden="true" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;(Canton|Grand-D.*)&quot;</span>, commune),</span>
<span id="cb95-3"><a href="package-development.html#cb95-3" aria-hidden="true" tabindex="-1"></a>            active_population)</span></code></pre></div>
<pre><code>## # A tibble: 105 × 3
##     year commune       active_population
##    &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;
##  1  2013 Dippach                    1817
##  2  2013 Garnich                     869
##  3  2013 Hobscheid                  1505
##  4  2013 Kaerjeng                   4355
##  5  2013 Kehlen                     2244
##  6  2013 Koerich                    1016
##  7  2013 Kopstal                    1284
##  8  2013 Mamer                      3209
##  9  2013 Septfontaines               399
## 10  2013 Steinfort                  2175
## # … with 95 more rows</code></pre>
<p>This seems to be working well (in one of the next sections we will learn how to systematize these
tests, instead of running them by hand each time we change the function).
Before continuing, let’s commit and push our changes.</p>
</div>
</div>
<div id="documentation" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Documentation<a href="package-development.html#documentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is time to start documenting our functions, and then our package. Documentation in R is not just
about telling users how to use the package and its functions, but it also serves a functional
role. There are several files that must be edited to completely document a package, and these
files also help define the dependencies of the package. Let’s start with the simplest thing we can
do, which is documenting functions.</p>
<div id="documenting-functions" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Documenting functions<a href="package-development.html#documenting-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As you’ll know, comments in R start with <code>#</code>. Documenting functions consists in commenting
them with a special kind of comments that start with <code>#'</code>. Let’s try on our <code>clean_unemp()</code>
function:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="package-development.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Easily filter unemployment data for Luxembourg</span></span>
<span id="cb97-2"><a href="package-development.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param unemp_data A data frame containing unemployment data for Luxembourg.</span></span>
<span id="cb97-3"><a href="package-development.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param level A predicate condition indicating the regional level of interest. See details for more.</span></span>
<span id="cb97-4"><a href="package-development.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param col_of_interest A column of the `unemp_data` data frame that you wish to select.</span></span>
<span id="cb97-5"><a href="package-development.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom janitor clean_names</span></span>
<span id="cb97-6"><a href="package-development.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom dplyr filter select</span></span>
<span id="cb97-7"><a href="package-development.html#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb97-8"><a href="package-development.html#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame</span></span>
<span id="cb97-9"><a href="package-development.html#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @details</span></span>
<span id="cb97-10"><a href="package-development.html#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This function allows the user to create a data frame for several regional levels. The first level</span></span>
<span id="cb97-11"><a href="package-development.html#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is the complete country. The second level are cantons, and the third level are neither cantons</span></span>
<span id="cb97-12"><a href="package-development.html#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nor the whole country, so the communes. Individual communes can be selected as well.</span></span>
<span id="cb97-13"><a href="package-development.html#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `level` must be predicate condition passed down to dplyr::filter. See the examples below</span></span>
<span id="cb97-14"><a href="package-development.html#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for its usage.</span></span>
<span id="cb97-15"><a href="package-development.html#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb97-16"><a href="package-development.html#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Filter on cantons</span></span>
<span id="cb97-17"><a href="package-development.html#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clean_unemp(unemp_2013,</span></span>
<span id="cb97-18"><a href="package-development.html#cb97-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             grepl(&quot;Canton&quot;, commune),</span></span>
<span id="cb97-19"><a href="package-development.html#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             active_population)</span></span>
<span id="cb97-20"><a href="package-development.html#cb97-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Filter on a specific commune</span></span>
<span id="cb97-21"><a href="package-development.html#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clean_unemp(unemp_2013,</span></span>
<span id="cb97-22"><a href="package-development.html#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             grepl(&quot;Kayl&quot;, commune),</span></span>
<span id="cb97-23"><a href="package-development.html#cb97-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             active_population)</span></span>
<span id="cb97-24"><a href="package-development.html#cb97-24" aria-hidden="true" tabindex="-1"></a>clean_unemp <span class="ot">&lt;-</span> <span class="cf">function</span>(unemp_data, level, col_of_interest){</span>
<span id="cb97-25"><a href="package-development.html#cb97-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-26"><a href="package-development.html#cb97-26" aria-hidden="true" tabindex="-1"></a>  unemp_data <span class="sc">|&gt;</span></span>
<span id="cb97-27"><a href="package-development.html#cb97-27" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb97-28"><a href="package-development.html#cb97-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>({{level}}) <span class="sc">|&gt;</span></span>
<span id="cb97-29"><a href="package-development.html#cb97-29" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(year, commune, {{col_of_interest}})</span>
<span id="cb97-30"><a href="package-development.html#cb97-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The special comments that start with <code>#'</code> will be compiled into a nice looking document that users
can then read. You can add sections to the documentation by using keywords that start
with <code>@</code>. The example above shows essentially everything you need to know to
properly document your functions. An important keyword, that will not appear in the documentation
itself, is <code>@importFrom</code>. This will be useful later, when we document the package, as it helps
define the dependencies of your package. For now, let’s simply remember to write this. The other
thing that might not be obvious is the <code>@export</code> line. This simply tells R that this function should be
public, available to the users. If you need to define private functions, you can omit this
keyword and the function won’t be visible to users (this is only partially true however, users
can always reach deep into the package and use private functions by using <code>:::</code>, as in <code>package:::my_private_function()</code>).</p>
<p>You can now save the script and press <code>CRTL-SHIFT-D</code>. This will generate the help file for your function:</p>
<div style="text-align:center;">
<p><img src="img/pack_6.png" width="1393" /></p>
</div>
<p>Now, writing <code>?clean_unemp</code> in the console shows the documentation for <code>clean_unemp</code>:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/help_clean_unemp.mp4" type="video/mp4">
</video>
</div>
<p>Now, let’s document the package.</p>
</div>
<div id="documenting-the-package" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Documenting the package<a href="package-development.html#documenting-the-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="the-namespace-file" class="section level4 hasAnchor" number="5.4.2.1">
<h4><span class="header-section-number">5.4.2.1</span> The NAMESPACE file<a href="package-development.html#the-namespace-file" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are several files you need to edit to properly document your package. Some are optional
like <em>vignettes</em>, and some are not optional, like the DESCRIPTION and the NAMESPACE. Let’s start
with the NAMESPACE. This file gets generated automatically, but sometimes it can happen that it
gets stuck in a state where it doesn’t get generated anymore. In these cases, you should simply
delete it, and then document your package again:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/namespace.mp4" type="video/mp4">
</video>
</div>
<p>As you can see from the video, the NAMESPACE defines some interesting stuff. First, it says which
of our functions are exported, and should be available to the users. Then, it defines the imports.
This is possible because of the <code>@importFrom</code> keywords from before. What we can now do, is go
back to our function and remove all the references to the packages and simply use the functions,
meaning that we can use <code>filter(blabla)</code> instead of <code>dplyr::filter()</code>. But in my opinion, it is
best to keep them the script as it is. There already there, and by having them there, even if they’re
redundant with the NAMESPACE, someone reading the source code will know immediately where the functions come from.
But if you want, you can remove the references to the packages, it’ll work.</p>
</div>
<div id="the-description-file" class="section level4 hasAnchor" number="5.4.2.2">
<h4><span class="header-section-number">5.4.2.2</span> The DESCRIPTION file<a href="package-development.html#the-description-file" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The DESCRIPTION file requires more manual work. Let’s take a look at the file as it stands:</p>
<pre><code>Package: myPackage
Type: Package
Title: What the Package Does (Title Case)
Version: 0.1.0
Author: Who wrote it
Maintainer: The package maintainer &lt;yourself@somewhere.net&gt;
Description: More about what it does (maybe more than one line)
    Use four spaces when indenting paragraphs within the Description.
License: What license is it under?
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.1</code></pre>
<p>Let’s change this to:</p>
<pre><code>Package: myPackage
Type: Package
Title: Clean Lux Unemployment Data
Version: 0.1.0
Author: Bruno Rodrigues
Maintainer: Bruno Rodrigues
Description: This package allows users to easily get unemployent data for Luxembourg
    from raw csv files
License: GPL (&gt;=3)
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.1</code></pre>
<p>All of this is not really important if you’re not releasing your package on CRAN, but still important
to think about. If it’s a package you’re keeping private to your company, none of it matters
much, but if it’s on github.com, you might want to still fill out these fields. What could be important
is the license you’re releasing the package under (again, only important if you release on CRAN or
keep it on github.com). What’s really important in this file, is what’s missing. We are going to add some more lines
to this file, which are quite important:</p>
<pre><code>Package: myPackage
Type: Package
Title: Clean Lux Unemployment Data
Version: 0.1.0
Author: Bruno Rodrigues
Maintainer: Bruno Rodrigues
Description: This package allows users to easily get unemployent data for Luxembourg
    from raw csv files
License: GPL (&gt;=3)
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.1
Depends:
    R (&gt;= 4.1),
Imports:
    dplyr,
    janitor
Suggests: 
    knitr,
    rmarkdown,
    testthat</code></pre>
<p>We added three fields:</p>
<ul>
<li>Depends: we can define hard dependencies here. Because I’m using the base pipe <code>|&gt;</code> in my examples, my package needs at least R version 4.1.</li>
<li>Imports: these is where we list packages that our package needs in order to run. If these packages are not available, they will be installed when users install our package.</li>
<li>Suggests: these packages are not required to run, but can unlock further capabilities. This is also where we can list packages that are required to build <em>vignettes</em> (which we’ll discover shortly), or for unit testing.</li>
</ul>
<p>There is another field we could add, Remotes, which is where we could define the usage of a package
only released on github.com. To know more about this, read
<a href="https://r-pkgs.org/dependencies.html#nonstandard-dependencies">this section</a>
of <a href="https://r-pkgs.org/">R packages</a>.</p>
</div>
<div id="vignettes" class="section level4 hasAnchor" number="5.4.2.3">
<h4><span class="header-section-number">5.4.2.3</span> Vignettes<a href="package-development.html#vignettes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vignettes are long form documentation that explain some of the use-cases of your package.
They are written in the RMarkdown format, which we will learn about in chapter 8.
To see an example of a vignette, you can take a look at this vignette titled
<a href="https://b-rodrigues.github.io/chronicler/articles/advanced-topics.html">A non-mathematician’s introduction to monads</a>
from my <code>{chronicler}</code> package, or you could also type:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="package-development.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="at">package =</span> <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<p>to see the list of available vignettes for the <code>{dplyr}</code> package, and then write:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="package-development.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;programming&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<p>to open the vignette locally.</p>
</div>
<div id="packages-website" class="section level4 hasAnchor" number="5.4.2.4">
<h4><span class="header-section-number">5.4.2.4</span> Package’s website<a href="package-development.html#packages-website" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the previous section I’ve linked to a vignette from my <code>{chronicler}</code> package.
<a href="https://b-rodrigues.github.io/chronicler/">The website</a> was automatically generated
using the <a href="https://pkgdown.r-lib.org/">pkgdown</a> package. We are not going to discuss how
it works in detail here, but you should know this exists, and is actually quite easy to use.</p>
</div>
</div>
<div id="checking-your-package" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Checking your package<a href="package-development.html#checking-your-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before sharing your package with the world, you might want to run <code>devtools::check()</code> to make sure
everything is alright. <code>devtools::check()</code> will make sure that you didn’t forget something crucial,
like declaring a dependency in the DESCRIPTION file for example. The goal is to see something
like this at the end of <code>devtools::check()</code>:</p>
<pre><code>0 errors ✔ | 0 warnings ✔ | 3 notes ✖</code></pre>
<p>If you want to release your package on CRAN, it’s a good idea to address the notes as well, but
what you must absolutely deal with are errors and warnings, even if you’re keeping this package
for yourself.</p>
</div>
<div id="installing-your-package" class="section level3 hasAnchor" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> Installing your package<a href="package-development.html#installing-your-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once you’re done working on your package, you can install it with <code>CRTL-SHIFT-B</code>. This way
you can start using your package from any R session. People that want to install your package
can use <code>devtools::install_github()</code> to install it from github.com. You might want to communicate
a specific commit hash to your users, so they install a fixed version of your package, and not
the latest development version. For example, let’s suppose that I have been working on my package,
but would prefer my potential users to install the package as it stood at the commit with the
hash <code>"c65b748014de03f848248599b5e53c604c6ca91d"</code>. I can write this in the README of the package:</p>
<pre><code>To install the package, please use the following line

devtools::install_github(&quot;b-rodrigues/myPackage&quot;, ref = &quot;c65b748014de03f848248599b5e53c604c6ca91d&quot;)</code></pre>
<p>This will install the <code>{myPackage}</code> package as it looked like at this particular commit. You could
also create a branch called <code>release</code> for example, and direct users to install from this branch:</p>
<pre><code>To install the package, please use the following line

devtools::install_github(&quot;b-rodrigues/myPackage&quot;, ref = &quot;release&quot;)</code></pre>
<p>But for this, you need to create a release branch, which will only contain release-ready code.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="git.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="unit-tests.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/b-rodrigues/rap4mads/edit/master/05-package-dev.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/b-rodrigues/rap4mads/blob/master/05-package-dev.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
