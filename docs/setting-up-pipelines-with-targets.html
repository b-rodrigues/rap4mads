<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Setting up pipelines with {targets} | Reproducible Analytical Pipelines - Master’s of Data Science</title>
  <meta name="description" content="Chapter 7 Setting up pipelines with {targets} | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Setting up pipelines with {targets} | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Setting up pipelines with {targets} | Reproducible Analytical Pipelines - Master’s of Data Science" />
  
  
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-11-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="unit-tests.html"/>
<link rel="next" href="data-products-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAP4MADS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducible-analytical-pipelines"><i class="fa fa-check"></i><b>1.2</b> Reproducible analytical pipelines?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-products"><i class="fa fa-check"></i><b>1.3</b> Data products?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.4</b> Machine learning?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-r-why-not-insert-your-favourite-programming-language"><i class="fa fa-check"></i><b>1.5</b> Why R? Why not [insert your favourite programming language]</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i><b>1.6</b> Pre-requisites</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.7</b> Grading</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#jargon"><i class="fa fa-check"></i><b>1.8</b> Jargon</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#further-reading"><i class="fa fa-check"></i><b>1.9</b> Further reading</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.10</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-in-data-with-r"><i class="fa fa-check"></i><b>2.1</b> Reading in data with R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-little-aside-on-pipes"><i class="fa fa-check"></i><b>2.2</b> A little aside on pipes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exploring-and-cleaning-data-with-r"><i class="fa fa-check"></i><b>2.3</b> Exploring and cleaning data with R</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>2.4</b> Data visualization</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#further-reading-1"><i class="fa fa-check"></i><b>2.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html"><i class="fa fa-check"></i><b>3</b> A primer on functional programming</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#defining-your-own-functions"><i class="fa fa-check"></i><b>3.2</b> Defining your own functions</a></li>
<li class="chapter" data-level="3.3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a></li>
<li class="chapter" data-level="3.4" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#further-reading-2"><i class="fa fa-check"></i><b>3.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#installing-git"><i class="fa fa-check"></i><b>4.2</b> Installing Git</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#setting-up-a-repo"><i class="fa fa-check"></i><b>4.3</b> Setting up a repo</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#cloning-the-repository-onto-your-computer"><i class="fa fa-check"></i><b>4.4</b> Cloning the repository onto your computer</a></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#your-first-commit"><i class="fa fa-check"></i><b>4.5</b> Your first commit</a></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#collaborating"><i class="fa fa-check"></i><b>4.6</b> Collaborating</a></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#branches"><i class="fa fa-check"></i><b>4.7</b> Branches</a></li>
<li class="chapter" data-level="4.8" data-path="git.html"><a href="git.html#contributing-to-someone-elses-repository"><i class="fa fa-check"></i><b>4.8</b> Contributing to someone else’s repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>5</b> Package development</a>
<ul>
<li class="chapter" data-level="5.1" data-path="package-development.html"><a href="package-development.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="package-development.html"><a href="package-development.html#getting-started"><i class="fa fa-check"></i><b>5.2</b> Getting started</a></li>
<li class="chapter" data-level="5.3" data-path="package-development.html"><a href="package-development.html#adding-functions"><i class="fa fa-check"></i><b>5.3</b> Adding functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="package-development.html"><a href="package-development.html#functions-dependencies"><i class="fa fa-check"></i><b>5.3.1</b> Functions dependencies</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="package-development.html"><a href="package-development.html#documentation"><i class="fa fa-check"></i><b>5.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="package-development.html"><a href="package-development.html#documenting-functions"><i class="fa fa-check"></i><b>5.4.1</b> Documenting functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="package-development.html"><a href="package-development.html#documenting-the-package"><i class="fa fa-check"></i><b>5.4.2</b> Documenting the package</a></li>
<li class="chapter" data-level="5.4.3" data-path="package-development.html"><a href="package-development.html#checking-your-package"><i class="fa fa-check"></i><b>5.4.3</b> Checking your package</a></li>
<li class="chapter" data-level="5.4.4" data-path="package-development.html"><a href="package-development.html#installing-your-package"><i class="fa fa-check"></i><b>5.4.4</b> Installing your package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>6</b> Unit tests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unit-tests.html"><a href="unit-tests.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="unit-tests.html"><a href="unit-tests.html#testing-your-package"><i class="fa fa-check"></i><b>6.2</b> Testing your package</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="unit-tests.html"><a href="unit-tests.html#is-the-function-returning-an-expected-value-for-a-given-input"><i class="fa fa-check"></i><b>6.2.1</b> Is the function returning an expected value for a given input?</a></li>
<li class="chapter" data-level="6.2.2" data-path="unit-tests.html"><a href="unit-tests.html#can-the-function-deal-with-all-kinds-of-input"><i class="fa fa-check"></i><b>6.2.2</b> Can the function deal with all kinds of input?</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="unit-tests.html"><a href="unit-tests.html#back-to-developing-again"><i class="fa fa-check"></i><b>6.3</b> Back to developing again</a></li>
<li class="chapter" data-level="6.4" data-path="unit-tests.html"><a href="unit-tests.html#and-back-to-testing"><i class="fa fa-check"></i><b>6.4</b> And back to testing</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html"><i class="fa fa-check"></i><b>7</b> Setting up pipelines with <code>{targets}</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#build-automation-with-r"><i class="fa fa-check"></i><b>7.2</b> Build automation with R</a></li>
<li class="chapter" data-level="7.3" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#an-aside-on-renv"><i class="fa fa-check"></i><b>7.3</b> An aside on <code>{renv}</code></a></li>
<li class="chapter" data-level="7.4" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#our-actual-first-pipeline"><i class="fa fa-check"></i><b>7.4</b> Our actual first pipeline</a></li>
<li class="chapter" data-level="7.5" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-someone-elses-pipeline"><i class="fa fa-check"></i><b>7.5</b> Running someone else’s pipeline</a></li>
<li class="chapter" data-level="7.6" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-any-code-with-older-packages"><i class="fa fa-check"></i><b>7.6</b> Running any code with older packages</a></li>
<li class="chapter" data-level="7.7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#why-we-need-more"><i class="fa fa-check"></i><b>7.7</b> Why we need more</a></li>
<li class="chapter" data-level="7.8" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#further-reading-3"><i class="fa fa-check"></i><b>7.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-products-1.html"><a href="data-products-1.html"><i class="fa fa-check"></i><b>8</b> Data products</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-products-1.html"><a href="data-products-1.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="data-products-1.html"><a href="data-products-1.html#a-first-taste-of-quarto"><i class="fa fa-check"></i><b>8.2</b> A first taste of Quarto</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-products-1.html"><a href="data-products-1.html#python-and-julia-code-chunks"><i class="fa fa-check"></i><b>8.2.1</b> Python and Julia code chunks</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-products-1.html"><a href="data-products-1.html#other-output-formats"><i class="fa fa-check"></i><b>8.3</b> Other output formats</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-products-1.html"><a href="data-products-1.html#word"><i class="fa fa-check"></i><b>8.3.1</b> Word</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-products-1.html"><a href="data-products-1.html#presentations"><i class="fa fa-check"></i><b>8.3.2</b> Presentations</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-products-1.html"><a href="data-products-1.html#pdf"><i class="fa fa-check"></i><b>8.3.3</b> PDF</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-products-1.html"><a href="data-products-1.html#interactive-web-applications-with-shiny"><i class="fa fa-check"></i><b>8.4</b> Interactive web applications with {shiny}</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-products-1.html"><a href="data-products-1.html#the-basic-structure-of-a-shiny-app"><i class="fa fa-check"></i><b>8.4.1</b> The basic structure of a Shiny app</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-products-1.html"><a href="data-products-1.html#slightly-more-advanced-shiny"><i class="fa fa-check"></i><b>8.4.2</b> Slightly more advanced shiny</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-products-1.html"><a href="data-products-1.html#basic-optimization-of-shiny-apps"><i class="fa fa-check"></i><b>8.4.3</b> Basic optimization of Shiny apps</a></li>
<li class="chapter" data-level="8.4.4" data-path="data-products-1.html"><a href="data-products-1.html#deploying-your-shiny-app"><i class="fa fa-check"></i><b>8.4.4</b> Deploying your shiny app</a></li>
<li class="chapter" data-level="8.4.5" data-path="data-products-1.html"><a href="data-products-1.html#references"><i class="fa fa-check"></i><b>8.4.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-products-1.html"><a href="data-products-1.html#how-to-build-data-products-using-targets"><i class="fa fa-check"></i><b>8.5</b> How to build data products using <code>{targets}</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html"><i class="fa fa-check"></i><b>9</b> Self-contained RAPs with Docker</a>
<ul>
<li class="chapter" data-level="9.1" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#introduction-7"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#installing-docker"><i class="fa fa-check"></i><b>9.2</b> Installing Docker</a></li>
<li class="chapter" data-level="9.3" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#the-rocker-project"><i class="fa fa-check"></i><b>9.3</b> The Rocker Project</a></li>
<li class="chapter" data-level="9.4" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#docker-essentials"><i class="fa fa-check"></i><b>9.4</b> Docker essentials</a></li>
<li class="chapter" data-level="9.5" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#making-our-own-images-and-run-some-code"><i class="fa fa-check"></i><b>9.5</b> Making our own images and run some code</a></li>
<li class="chapter" data-level="9.6" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#reproducibility-with-docker"><i class="fa fa-check"></i><b>9.6</b> Reproducibility with Docker</a></li>
<li class="chapter" data-level="9.7" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#building-a-truly-reproducible-pipeline"><i class="fa fa-check"></i><b>9.7</b> Building a truly reproducible pipeline</a></li>
<li class="chapter" data-level="9.8" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html#references-1"><i class="fa fa-check"></i><b>9.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cicd-with-github-actions.html"><a href="cicd-with-github-actions.html"><i class="fa fa-check"></i><b>10</b> CI/CD with Github Actions</a></li>
<li class="chapter" data-level="11" data-path="what-else-should-you-learn.html"><a href="what-else-should-you-learn.html"><i class="fa fa-check"></i><b>11</b> What else should you learn?</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a>
<ul>
<li class="chapter" data-level="12.1" data-path="conclusion.html"><a href="conclusion.html#why-bother"><i class="fa fa-check"></i><b>12.1</b> Why bother</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/b-rodrigues/rap4mads" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Analytical Pipelines - Master’s of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="setting-up-pipelines-with-targets" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Setting up pipelines with <code>{targets}</code><a href="setting-up-pipelines-with-targets.html#setting-up-pipelines-with-targets" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div style="text-align:center;">
<p><img src="img/pipeline.png" width="512" /></p>
</div>
<p>What you’ll have learned by the end of the chapter: how to set up an (almost) reproducible pipeline.</p>
<div id="introduction-5" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction<a href="setting-up-pipelines-with-targets.html#introduction-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>{targets}</code> is a build automation tool for the R programming language. <em>Build</em>, in the context of
this course means the creation of a data product. As mentioned in the introduction, this data
product can be anything from predictions from a model to interactive web applications. <em>Automation</em>
means that this build automation tool will take the burden off our shoulders when it’ll be time to
run the build pipeline. Using such a tool, programmers don’t need to think about which parts of the
code to rerun if they introduce a change somewhere. Only the parts affected by the change will run.
These tools also run the pipeline in parallel, because they identify independent parts of the
pipeline which are then run simultaneously. Build automation tools have many benefits, and because
they work in a certain way, they also force you to work in a more structured way.</p>
</div>
<div id="build-automation-with-r" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Build automation with R<a href="setting-up-pipelines-with-targets.html#build-automation-with-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an introduction, there really is not a better source than the <code>{targets}</code> manual itself, and in
particular the <a href="https://books.ropensci.org/targets/walkthrough.html">walkthrough section</a>. After
reading this section, we have the basic knowledge to build our first pipeline. The goal of this
pipeline will be to simply create a plot using the unemployment data we’ve been working on. Let’s
create a new project in RStudio, but make sure that you check the following boxes:</p>
<p><img src="img/pipeline_1.png" width="412" /></p>
<p>You should see the following message in the R console:</p>
<pre><code>* Initializing project ...
* Discovering package dependencies ... Done!
* Copying packages into the cache ... Done!
The following package(s) will be updated in the lockfile:

# CRAN ===============================
- renv   [* -&gt; 0.16.0]

The version of R recorded in the lockfile will be updated:
- R      [*] -&gt; [4.2.1]

* Lockfile written to &#39;~/six_to/first_pipeline/renv.lock&#39;.</code></pre>
<p>This is something that we have not discussed yet, so before we move on, let’s have a little aside
on what <code>{renv}</code> is.</p>
</div>
<div id="an-aside-on-renv" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> An aside on <code>{renv}</code><a href="setting-up-pipelines-with-targets.html#an-aside-on-renv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Whether they’re simple scripts to analyze some data or more complex reproducible analytical
pipelines, all of your projects depend on the packages that you use for the analysis. And these
packages evolve and change. It can very well happen that a function that you use from package
<code>{xyz}</code> version 1 won’t be available anymore in version 2. Or maybe it’s still available but it
works slightly differently. It can be something as trivial as the arguments of the function have been
renamed. The consequence is that when you’ll try to rerun your code, it won’t work at all, or
worse, it’ll work, but produce a result that is not comparable to old results anymore, because the
function got changed and the underlying algorithm isn’t the same anymore. So we need a certain
stability, and ideally keep reusing the same packages for the same project. If you want to update a
project to use new packages version, this can of course also be done, but it has to be conscious
choice and you will have to make sure that the updated pipeline (using the updated packages) is
able to reproduce old results before putting it into production.</p>
<p>It must be noted however that in my experience, it is usually possible to rerun old R code
without much hassle. But that’s what makes it worse; you get so used to this stability that you
don’t think about a way to keep your projects reproducible, because issues rarely happen with R.
It is thus best to get into the habit to use a tool like <code>{renv}</code>, which offers a certain stability
to your projects.</p>
<p><code>{renv}</code> creates separate package libraries, one per project. The idea is quite simple; start your
project with <code>{renv}</code> enabled (if you’re using RStudio, you can check the box <em>Use renv with this project</em>
when starting a new project, if you’re not using RStudio, you can run <code>renv::init()</code>, on the root of
the folder’s project).
This will create a file in the root of your project called <code>renv.lock</code>. You can open this file in a
text editor, and you should see that the R version you’re currently using is recorded (and the
version of <code>{renv}</code> itself). It should look something like this:</p>
<pre><code>{
  &quot;R&quot;: {
    &quot;Version&quot;: &quot;4.2.1&quot;,
    &quot;Repositories&quot;: [
      {
        &quot;Name&quot;: &quot;CRAN&quot;,
        &quot;URL&quot;: &quot;http://cran.rstudio.com&quot;
      }
    ]
  },
  &quot;Packages&quot;: {
    &quot;renv&quot;: {
      &quot;Package&quot;: &quot;renv&quot;,
      &quot;Version&quot;: &quot;0.16.0&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;c9e8442ab69bc21c9697ecf856c1e6c7&quot;,
      &quot;Requirements&quot;: []
    }
  }
}</code></pre>
<p>You can then work as usual. It doesn’t matter if you’re simply writing a script to perform a
“simple” analysis, or doing something more complex like a RAP. You will likely need to re-install
packages though; remember, <code>{renv}</code> sets up a library per project!</p>
<p>Once you’re done and satisfied, run <code>renv::snapshot()</code>. As you might have guessed from the name
this will take a snapshot of the project and write the current status to the <code>renv.lock</code> file:</p>
<pre><code>&gt; renv::snapshot()
The following package(s) will be updated in the lockfile:

# CRAN ===============================
- R6           [* -&gt; 2.5.1]
- cli          [* -&gt; 3.4.1]
- dplyr        [* -&gt; 1.0.10]
- fansi        [* -&gt; 1.0.3]
- generics     [* -&gt; 0.1.3]
- glue         [* -&gt; 1.6.2]
- lifecycle    [* -&gt; 1.0.3]
- magrittr     [* -&gt; 2.0.3]
- pillar       [* -&gt; 1.8.1]
- pkgconfig    [* -&gt; 2.0.3]
- rlang        [* -&gt; 1.0.6]
- tibble       [* -&gt; 3.1.8]
- tidyselect   [* -&gt; 1.2.0]
- utf8         [* -&gt; 1.2.2]
- vctrs        [* -&gt; 0.4.2]
- withr        [* -&gt; 2.5.0]

Do you want to proceed? [y/N]: </code></pre>
<p>In it, you will see that the libraries needed to run the project are also recorded. The
<code>renv.lock</code> will now look like this:</p>
<pre><code>{
  &quot;R&quot;: {
    &quot;Version&quot;: &quot;4.2.1&quot;,
    &quot;Repositories&quot;: [
      {
        &quot;Name&quot;: &quot;CRAN&quot;,
        &quot;URL&quot;: &quot;http://cran.rstudio.com&quot;
      }
    ]
  },
  &quot;Packages&quot;: {
    &quot;R6&quot;: {
      &quot;Package&quot;: &quot;R6&quot;,
      &quot;Version&quot;: &quot;2.5.1&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;470851b6d5d0ac559e9d01bb352b4021&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;cli&quot;: {
      &quot;Package&quot;: &quot;cli&quot;,
      &quot;Version&quot;: &quot;3.4.1&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;0d297d01734d2bcea40197bd4971a764&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;dplyr&quot;: {
      &quot;Package&quot;: &quot;dplyr&quot;,
      &quot;Version&quot;: &quot;1.0.10&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;539412282059f7f0c07295723d23f987&quot;,
      &quot;Requirements&quot;: [
        &quot;R6&quot;,
        &quot;generics&quot;,
        &quot;glue&quot;,
        &quot;lifecycle&quot;,
        &quot;magrittr&quot;,
        &quot;pillar&quot;,
        &quot;rlang&quot;,
        &quot;tibble&quot;,
        &quot;tidyselect&quot;,
        &quot;vctrs&quot;
      ]
    },
    &quot;fansi&quot;: {
      &quot;Package&quot;: &quot;fansi&quot;,
      &quot;Version&quot;: &quot;1.0.3&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;83a8afdbe71839506baa9f90eebad7ec&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;generics&quot;: {
      &quot;Package&quot;: &quot;generics&quot;,
      &quot;Version&quot;: &quot;0.1.3&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;15e9634c0fcd294799e9b2e929ed1b86&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;glue&quot;: {
      &quot;Package&quot;: &quot;glue&quot;,
      &quot;Version&quot;: &quot;1.6.2&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;4f2596dfb05dac67b9dc558e5c6fba2e&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;lifecycle&quot;: {
      &quot;Package&quot;: &quot;lifecycle&quot;,
      &quot;Version&quot;: &quot;1.0.3&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;001cecbeac1cff9301bdc3775ee46a86&quot;,
      &quot;Requirements&quot;: [
        &quot;cli&quot;,
        &quot;glue&quot;,
        &quot;rlang&quot;
      ]
    },
    &quot;magrittr&quot;: {
      &quot;Package&quot;: &quot;magrittr&quot;,
      &quot;Version&quot;: &quot;2.0.3&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;7ce2733a9826b3aeb1775d56fd305472&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;pillar&quot;: {
      &quot;Package&quot;: &quot;pillar&quot;,
      &quot;Version&quot;: &quot;1.8.1&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;f2316df30902c81729ae9de95ad5a608&quot;,
      &quot;Requirements&quot;: [
        &quot;cli&quot;,
        &quot;fansi&quot;,
        &quot;glue&quot;,
        &quot;lifecycle&quot;,
        &quot;rlang&quot;,
        &quot;utf8&quot;,
        &quot;vctrs&quot;
      ]
    },
    &quot;pkgconfig&quot;: {
      &quot;Package&quot;: &quot;pkgconfig&quot;,
      &quot;Version&quot;: &quot;2.0.3&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;01f28d4278f15c76cddbea05899c5d6f&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;renv&quot;: {
      &quot;Package&quot;: &quot;renv&quot;,
      &quot;Version&quot;: &quot;0.16.0&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;c9e8442ab69bc21c9697ecf856c1e6c7&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;rlang&quot;: {
      &quot;Package&quot;: &quot;rlang&quot;,
      &quot;Version&quot;: &quot;1.0.6&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;4ed1f8336c8d52c3e750adcdc57228a7&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;tibble&quot;: {
      &quot;Package&quot;: &quot;tibble&quot;,
      &quot;Version&quot;: &quot;3.1.8&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;56b6934ef0f8c68225949a8672fe1a8f&quot;,
      &quot;Requirements&quot;: [
        &quot;fansi&quot;,
        &quot;lifecycle&quot;,
        &quot;magrittr&quot;,
        &quot;pillar&quot;,
        &quot;pkgconfig&quot;,
        &quot;rlang&quot;,
        &quot;vctrs&quot;
      ]
    },
    &quot;tidyselect&quot;: {
      &quot;Package&quot;: &quot;tidyselect&quot;,
      &quot;Version&quot;: &quot;1.2.0&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;79540e5fcd9e0435af547d885f184fd5&quot;,
      &quot;Requirements&quot;: [
        &quot;cli&quot;,
        &quot;glue&quot;,
        &quot;lifecycle&quot;,
        &quot;rlang&quot;,
        &quot;vctrs&quot;,
        &quot;withr&quot;
      ]
    },
    &quot;utf8&quot;: {
      &quot;Package&quot;: &quot;utf8&quot;,
      &quot;Version&quot;: &quot;1.2.2&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;c9c462b759a5cc844ae25b5942654d13&quot;,
      &quot;Requirements&quot;: []
    },
    &quot;vctrs&quot;: {
      &quot;Package&quot;: &quot;vctrs&quot;,
      &quot;Version&quot;: &quot;0.4.2&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;0e3dfc070b2a8f0478fcdf86fb33355d&quot;,
      &quot;Requirements&quot;: [
        &quot;cli&quot;,
        &quot;glue&quot;,
        &quot;rlang&quot;
      ]
    },
    &quot;withr&quot;: {
      &quot;Package&quot;: &quot;withr&quot;,
      &quot;Version&quot;: &quot;2.5.0&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;c0e49a9760983e81e55cdd9be92e7182&quot;,
      &quot;Requirements&quot;: []
    }
  }
}
</code></pre>
<p>On your end, you’re done. You can push this project to github.com for instance, and someone
else who wishes to run this project will have to simply:</p>
<ul>
<li>Clone the repository;</li>
<li>Run <code>renv::restore()</code> to install all the required libraries.</li>
</ul>
<p>And that’s it! This person, who might be future you, will now be able to re-run the project
with the required libraries and the right versions.</p>
<p>In a coming section we are actually going to do just that, but for now, let’s go back to
<code>{targets}</code>.</p>
</div>
<div id="our-actual-first-pipeline" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Our actual first pipeline<a href="setting-up-pipelines-with-targets.html#our-actual-first-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div style="text-align:center;">
<p><img src="img/mario.png" width="512" /></p>
</div>
<p>Let’s start by building our very first pipeline. Our goal is the following: start with the unemployment
data for Luxembourg, and build a series of graphs. We want one graph for Luxembourg, one graph for
cantons, and one graph for selected communes. This series of graphs will be our data product; let’s not
focus too much on the data product itself, the focus here is on building the pipeline. In the next
chapter we are going to build more interesting data products.</p>
<p>I’ve been mentioning pipelines for some time now, but what is it actually? Nothing more than a script.
Let’s go back to the project we started at the beginning of the chapter. We can now create a <code>_targets.R</code>
file on the root of the project. Insert the following lines in the script, we will then go through each
of them:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="setting-up-pipelines-with-targets.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb127-2"><a href="setting-up-pipelines-with-targets.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb127-3"><a href="setting-up-pipelines-with-targets.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb127-4"><a href="setting-up-pipelines-with-targets.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb127-5"><a href="setting-up-pipelines-with-targets.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="setting-up-pipelines-with-targets.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb127-7"><a href="setting-up-pipelines-with-targets.html#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(unemp_data, <span class="fu">get_data</span>())</span>
<span id="cb127-8"><a href="setting-up-pipelines-with-targets.html#cb127-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The first line simply loads the <code>{targets}</code> package, the second to fourth lines load the packages
required for the pipeline to actually run. Then comes a list. Inside this list is where we will define the
targets, or the (intermediary) outputs of the pipeline. We defined <code>unemp_data</code> as being the output
of the function <code>get_data()</code>… but where does this function come from? Well, we need to create
another script called <code>functions.R</code> where we will define every function the we need for this
pipeline. Let’s create an empty script and put the following lines in it:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="setting-up-pipelines-with-targets.html#cb128-1" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb128-2"><a href="setting-up-pipelines-with-targets.html#cb128-2" aria-hidden="true" tabindex="-1"></a>  myPackage<span class="sc">::</span>unemp</span>
<span id="cb128-3"><a href="setting-up-pipelines-with-targets.html#cb128-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This function is as simple as it gets; it doesn’t take any arguments and returns the data that we
added to our package. This function could of course just as well read data from your computer, or
from the Internet, and return it. The fact our data is inside our package is just for convenience.
We can now go back to <code>_targets.R</code> and first of all, add a line to source this file, and then define new targets:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="setting-up-pipelines-with-targets.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb129-2"><a href="setting-up-pipelines-with-targets.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb129-3"><a href="setting-up-pipelines-with-targets.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb129-4"><a href="setting-up-pipelines-with-targets.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb129-5"><a href="setting-up-pipelines-with-targets.html#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span>
<span id="cb129-6"><a href="setting-up-pipelines-with-targets.html#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="setting-up-pipelines-with-targets.html#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb129-8"><a href="setting-up-pipelines-with-targets.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(unemp_data, <span class="fu">get_data</span>())</span>
<span id="cb129-9"><a href="setting-up-pipelines-with-targets.html#cb129-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>You can now run the pipeline using <code>tar_make()</code>… and you should get immediately an error:</p>
<pre><code>&gt; targets::tar_make()
• start target unemp_data
✖ error target unemp_data
• end pipeline [0.198 seconds]</code></pre>
<p>This is because our package is not in the <code>renv.lock</code> file. Remember that <code>{renv}</code> creates
a new library per project, and as such we now need to install <code>{myPackage}</code> from github.com into
our project. For this, run the following line (you might need to install <code>{devtools}</code> beforehand):</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="setting-up-pipelines-with-targets.html#cb131-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;b-rodrigues/myPackage&quot;</span>,</span>
<span id="cb131-2"><a href="setting-up-pipelines-with-targets.html#cb131-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ref =</span> <span class="st">&quot;e9d9129de3047c1ecce26d09dff429ec078d4dae&quot;</span>)</span></code></pre></div>
<p>The provided hash will make sure that the right version of the package gets installed for this project.
This way, if I continue to work on the package, users will be able to still install the correct version.
Since we’ve installed some new packages, run <code>renv::snapshot()</code> to rewrite the <code>renv.lock</code> file:</p>
<pre><code>&gt; renv::snapshot()
The following package(s) will be updated in the lockfile:

# CRAN ===============================
- Matrix       [* -&gt; 1.4-1]
- backports    [* -&gt; 1.4.1]
- base64url    [* -&gt; 1.4]
- callr        [* -&gt; 3.7.2]
- codetools    [* -&gt; 0.2-18]
- data.table   [* -&gt; 1.14.4]
- digest       [* -&gt; 0.6.30]
- evaluate     [* -&gt; 0.17]
- highr        [* -&gt; 0.9]
- igraph       [* -&gt; 1.3.5]
- knitr        [* -&gt; 1.40]
- lattice      [* -&gt; 0.20-45]
- processx     [* -&gt; 3.7.0]
- ps           [* -&gt; 1.7.1]
- stringi      [* -&gt; 1.7.8]
- stringr      [* -&gt; 1.4.1]
- targets      [* -&gt; 0.13.5]
- xfun         [* -&gt; 0.34]
- yaml         [* -&gt; 2.3.6]

# GitHub =============================
- myPackage    [* -&gt; b-rodrigues/myPackage@e9d9129de3047c1ecce26d09dff429ec078d4dae]

Do you want to proceed? [y/N]: </code></pre>
<p>It might be a good idea to take a look at the lock file, and in particular the <code>{myPackage}</code> entry.
If everything went alright, you should see something like this:</p>
<pre><code>&quot;myPackage&quot;: {
  &quot;Package&quot;: &quot;myPackage&quot;,
  &quot;Version&quot;: &quot;0.1.0&quot;,
  &quot;Source&quot;: &quot;GitHub&quot;,
  &quot;RemoteType&quot;: &quot;github&quot;,
  &quot;RemoteHost&quot;: &quot;api.github.com&quot;,
  &quot;RemoteRepo&quot;: &quot;myPackage&quot;,
  &quot;RemoteUsername&quot;: &quot;b-rodrigues&quot;,
  &quot;RemoteRef&quot;: &quot;e9d9129de3047c1ecce26d09dff429ec078d4dae&quot;,
  &quot;RemoteSha&quot;: &quot;e9d9129de3047c1ecce26d09dff429ec078d4dae&quot;,
  &quot;Hash&quot;: &quot;4740b43847e10e012bad2b8a1a533433&quot;,
  &quot;Requirements&quot;: [
    &quot;dplyr&quot;,
    &quot;janitor&quot;,
    &quot;rlang&quot;
  ]
},</code></pre>
<p>It can happen that every entry starting with “Remote” is missing. This depends how this
package was installed, and if the <code>DESCRIPTION</code> file of this package contains the required info.
If you installed it using <code>devtools::install_github()</code>, it should be fine. But it is always
better to check.
In case these are missing, you should add them by hand. Adding these fields will ensure that the
package will always get installed from github.com, and that the correct commit will be used. You
can then save the lock file and commit it alongside the rest of your project.</p>
<p>Ok, now we should be able to run our pipeline with <code>targets::tar_make()</code>.</p>
<p>This will not create any output, but this way you can at least test that it’s running. Also,
remember <code>tar_load()</code> and <code>tar_read()</code> from the walkthrough? First try to run
<code>tar_read(unemp_data)</code>, this should print the data in your console. You can then run
<code>tar_load(unemp_data)</code>, which this time loads the data in your global environment. You can now
access it interactively. This is quite useful if you need to inspect intermediary outputs.</p>
<p>Let’s now add intermediary outputs; we need data for Luxebmourg, data for the cantons and data for some communes. This is
where the function <code>clean_unemp()</code> from our package will come into play:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="setting-up-pipelines-with-targets.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb134-2"><a href="setting-up-pipelines-with-targets.html#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb134-3"><a href="setting-up-pipelines-with-targets.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb134-4"><a href="setting-up-pipelines-with-targets.html#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb134-5"><a href="setting-up-pipelines-with-targets.html#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span>
<span id="cb134-6"><a href="setting-up-pipelines-with-targets.html#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="setting-up-pipelines-with-targets.html#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb134-8"><a href="setting-up-pipelines-with-targets.html#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb134-9"><a href="setting-up-pipelines-with-targets.html#cb134-9" aria-hidden="true" tabindex="-1"></a>    unemp_data,</span>
<span id="cb134-10"><a href="setting-up-pipelines-with-targets.html#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_data</span>()</span>
<span id="cb134-11"><a href="setting-up-pipelines-with-targets.html#cb134-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb134-12"><a href="setting-up-pipelines-with-targets.html#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="setting-up-pipelines-with-targets.html#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb134-14"><a href="setting-up-pipelines-with-targets.html#cb134-14" aria-hidden="true" tabindex="-1"></a>    lux_data,</span>
<span id="cb134-15"><a href="setting-up-pipelines-with-targets.html#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb134-16"><a href="setting-up-pipelines-with-targets.html#cb134-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">place_name_of_interest =</span> <span class="st">&quot;Luxembourg&quot;</span>,</span>
<span id="cb134-17"><a href="setting-up-pipelines-with-targets.html#cb134-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">level_of_interest =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb134-18"><a href="setting-up-pipelines-with-targets.html#cb134-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb134-19"><a href="setting-up-pipelines-with-targets.html#cb134-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb134-20"><a href="setting-up-pipelines-with-targets.html#cb134-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-21"><a href="setting-up-pipelines-with-targets.html#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb134-22"><a href="setting-up-pipelines-with-targets.html#cb134-22" aria-hidden="true" tabindex="-1"></a>    canton_data,</span>
<span id="cb134-23"><a href="setting-up-pipelines-with-targets.html#cb134-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb134-24"><a href="setting-up-pipelines-with-targets.html#cb134-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">level_of_interest =</span> <span class="st">&quot;Canton&quot;</span>,</span>
<span id="cb134-25"><a href="setting-up-pipelines-with-targets.html#cb134-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb134-26"><a href="setting-up-pipelines-with-targets.html#cb134-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb134-27"><a href="setting-up-pipelines-with-targets.html#cb134-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-28"><a href="setting-up-pipelines-with-targets.html#cb134-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb134-29"><a href="setting-up-pipelines-with-targets.html#cb134-29" aria-hidden="true" tabindex="-1"></a>    commune_data,</span>
<span id="cb134-30"><a href="setting-up-pipelines-with-targets.html#cb134-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb134-31"><a href="setting-up-pipelines-with-targets.html#cb134-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">place_name_of_interest =</span> <span class="fu">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Dippach&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>, <span class="st">&quot;Esch/Alzette&quot;</span>, <span class="st">&quot;Mersch&quot;</span>),</span>
<span id="cb134-32"><a href="setting-up-pipelines-with-targets.html#cb134-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb134-33"><a href="setting-up-pipelines-with-targets.html#cb134-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-34"><a href="setting-up-pipelines-with-targets.html#cb134-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>At this stage it might be interesting to take a look at the network. Call <code>tar_visnetwork()</code> (you might get
prompted to install yet another package) and take a look at the pipeline:</p>
<p><img src="img/pipeline_2.png" width="740" /></p>
<p>All that’s missing now is to write a function to create plots. Since we didn’t learn how to make them using <code>{ggplot2}</code>,
simply copy the code below into the <code>functions.R</code> script:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="setting-up-pipelines-with-targets.html#cb135-1" aria-hidden="true" tabindex="-1"></a>make_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb135-2"><a href="setting-up-pipelines-with-targets.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb135-3"><a href="setting-up-pipelines-with-targets.html#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(</span>
<span id="cb135-4"><a href="setting-up-pipelines-with-targets.html#cb135-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(</span>
<span id="cb135-5"><a href="setting-up-pipelines-with-targets.html#cb135-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> active_population,</span>
<span id="cb135-6"><a href="setting-up-pipelines-with-targets.html#cb135-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> year,</span>
<span id="cb135-7"><a href="setting-up-pipelines-with-targets.html#cb135-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> place_name</span>
<span id="cb135-8"><a href="setting-up-pipelines-with-targets.html#cb135-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb135-9"><a href="setting-up-pipelines-with-targets.html#cb135-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb135-10"><a href="setting-up-pipelines-with-targets.html#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb135-11"><a href="setting-up-pipelines-with-targets.html#cb135-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb135-12"><a href="setting-up-pipelines-with-targets.html#cb135-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now use this function to define new targets in our <code>_targets.R</code> file:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="setting-up-pipelines-with-targets.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb136-2"><a href="setting-up-pipelines-with-targets.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb136-3"><a href="setting-up-pipelines-with-targets.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb136-4"><a href="setting-up-pipelines-with-targets.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb136-5"><a href="setting-up-pipelines-with-targets.html#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span>
<span id="cb136-6"><a href="setting-up-pipelines-with-targets.html#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="setting-up-pipelines-with-targets.html#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="setting-up-pipelines-with-targets.html#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb136-9"><a href="setting-up-pipelines-with-targets.html#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-10"><a href="setting-up-pipelines-with-targets.html#cb136-10" aria-hidden="true" tabindex="-1"></a>        unemp_data,</span>
<span id="cb136-11"><a href="setting-up-pipelines-with-targets.html#cb136-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">get_data</span>()</span>
<span id="cb136-12"><a href="setting-up-pipelines-with-targets.html#cb136-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-13"><a href="setting-up-pipelines-with-targets.html#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="setting-up-pipelines-with-targets.html#cb136-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-15"><a href="setting-up-pipelines-with-targets.html#cb136-15" aria-hidden="true" tabindex="-1"></a>        lux_data,</span>
<span id="cb136-16"><a href="setting-up-pipelines-with-targets.html#cb136-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb136-17"><a href="setting-up-pipelines-with-targets.html#cb136-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">place_name_of_interest =</span> <span class="st">&quot;Luxembourg&quot;</span>,</span>
<span id="cb136-18"><a href="setting-up-pipelines-with-targets.html#cb136-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">level_of_interest =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb136-19"><a href="setting-up-pipelines-with-targets.html#cb136-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb136-20"><a href="setting-up-pipelines-with-targets.html#cb136-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-21"><a href="setting-up-pipelines-with-targets.html#cb136-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-22"><a href="setting-up-pipelines-with-targets.html#cb136-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-23"><a href="setting-up-pipelines-with-targets.html#cb136-23" aria-hidden="true" tabindex="-1"></a>        canton_data,</span>
<span id="cb136-24"><a href="setting-up-pipelines-with-targets.html#cb136-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb136-25"><a href="setting-up-pipelines-with-targets.html#cb136-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">level_of_interest =</span> <span class="st">&quot;Canton&quot;</span>,</span>
<span id="cb136-26"><a href="setting-up-pipelines-with-targets.html#cb136-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb136-27"><a href="setting-up-pipelines-with-targets.html#cb136-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-28"><a href="setting-up-pipelines-with-targets.html#cb136-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-29"><a href="setting-up-pipelines-with-targets.html#cb136-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-30"><a href="setting-up-pipelines-with-targets.html#cb136-30" aria-hidden="true" tabindex="-1"></a>        commune_data,</span>
<span id="cb136-31"><a href="setting-up-pipelines-with-targets.html#cb136-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb136-32"><a href="setting-up-pipelines-with-targets.html#cb136-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">place_name_of_interest =</span> <span class="fu">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Dippach&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>, <span class="st">&quot;Esch/Alzette&quot;</span>, <span class="st">&quot;Mersch&quot;</span>),</span>
<span id="cb136-33"><a href="setting-up-pipelines-with-targets.html#cb136-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb136-34"><a href="setting-up-pipelines-with-targets.html#cb136-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-35"><a href="setting-up-pipelines-with-targets.html#cb136-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-36"><a href="setting-up-pipelines-with-targets.html#cb136-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-37"><a href="setting-up-pipelines-with-targets.html#cb136-37" aria-hidden="true" tabindex="-1"></a>        lux_plot,</span>
<span id="cb136-38"><a href="setting-up-pipelines-with-targets.html#cb136-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(lux_data)</span>
<span id="cb136-39"><a href="setting-up-pipelines-with-targets.html#cb136-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-40"><a href="setting-up-pipelines-with-targets.html#cb136-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-41"><a href="setting-up-pipelines-with-targets.html#cb136-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-42"><a href="setting-up-pipelines-with-targets.html#cb136-42" aria-hidden="true" tabindex="-1"></a>        canton_plot,</span>
<span id="cb136-43"><a href="setting-up-pipelines-with-targets.html#cb136-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(canton_data)</span>
<span id="cb136-44"><a href="setting-up-pipelines-with-targets.html#cb136-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-45"><a href="setting-up-pipelines-with-targets.html#cb136-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-46"><a href="setting-up-pipelines-with-targets.html#cb136-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb136-47"><a href="setting-up-pipelines-with-targets.html#cb136-47" aria-hidden="true" tabindex="-1"></a>        commune_plot,</span>
<span id="cb136-48"><a href="setting-up-pipelines-with-targets.html#cb136-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(commune_data)</span>
<span id="cb136-49"><a href="setting-up-pipelines-with-targets.html#cb136-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb136-50"><a href="setting-up-pipelines-with-targets.html#cb136-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-51"><a href="setting-up-pipelines-with-targets.html#cb136-51" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s now take a look at the pipeline again with <code>tar_visnetwork()</code>:</p>
<p><img src="img/pipeline_3.png" width="862" /></p>
<p>We see that new targets are outdated, and we need to run the pipeline to build them, so run the
pipeline using <code>tar_make()</code>. If everything went well, we can now take a look at our plots using
<code>tar_read(luxembourg_plot)</code>.</p>
<p>Finally, let’s write these plots to disk. The way to save a <code>ggplot</code> to disk is to use the
<code>ggsave()</code> function. But targets have to return something, so
<a href="https://books.ropensci.org/targets/targets.html#side-effects">side-effects</a> like writing to disk
must be handled in a specific way. What we’re going to do is write a wrapper around <code>ggsave()</code> that
will take the path where the plot should be save to disk, save the plot to the specified path, and
then return the plot. This way, we have a function that does not only have a side-effect, but also
a return value. Let’s go back to <code>functions.R</code> and add the following lines:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="setting-up-pipelines-with-targets.html#cb137-1" aria-hidden="true" tabindex="-1"></a>save_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(save_path, plot){</span>
<span id="cb137-2"><a href="setting-up-pipelines-with-targets.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(save_path, plot)</span>
<span id="cb137-3"><a href="setting-up-pipelines-with-targets.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  save_path</span>
<span id="cb137-4"><a href="setting-up-pipelines-with-targets.html#cb137-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now define these additional targets:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="setting-up-pipelines-with-targets.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb138-2"><a href="setting-up-pipelines-with-targets.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb138-3"><a href="setting-up-pipelines-with-targets.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb138-4"><a href="setting-up-pipelines-with-targets.html#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb138-5"><a href="setting-up-pipelines-with-targets.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span>
<span id="cb138-6"><a href="setting-up-pipelines-with-targets.html#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="setting-up-pipelines-with-targets.html#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="setting-up-pipelines-with-targets.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb138-9"><a href="setting-up-pipelines-with-targets.html#cb138-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-10"><a href="setting-up-pipelines-with-targets.html#cb138-10" aria-hidden="true" tabindex="-1"></a>        unemp_data,</span>
<span id="cb138-11"><a href="setting-up-pipelines-with-targets.html#cb138-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">get_data</span>()</span>
<span id="cb138-12"><a href="setting-up-pipelines-with-targets.html#cb138-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-13"><a href="setting-up-pipelines-with-targets.html#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-14"><a href="setting-up-pipelines-with-targets.html#cb138-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-15"><a href="setting-up-pipelines-with-targets.html#cb138-15" aria-hidden="true" tabindex="-1"></a>        lux_data,</span>
<span id="cb138-16"><a href="setting-up-pipelines-with-targets.html#cb138-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb138-17"><a href="setting-up-pipelines-with-targets.html#cb138-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">place_name_of_interest =</span> <span class="st">&quot;Luxembourg&quot;</span>,</span>
<span id="cb138-18"><a href="setting-up-pipelines-with-targets.html#cb138-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">level_of_interest =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb138-19"><a href="setting-up-pipelines-with-targets.html#cb138-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb138-20"><a href="setting-up-pipelines-with-targets.html#cb138-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-21"><a href="setting-up-pipelines-with-targets.html#cb138-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-22"><a href="setting-up-pipelines-with-targets.html#cb138-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-23"><a href="setting-up-pipelines-with-targets.html#cb138-23" aria-hidden="true" tabindex="-1"></a>        canton_data,</span>
<span id="cb138-24"><a href="setting-up-pipelines-with-targets.html#cb138-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb138-25"><a href="setting-up-pipelines-with-targets.html#cb138-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">level_of_interest =</span> <span class="st">&quot;Canton&quot;</span>,</span>
<span id="cb138-26"><a href="setting-up-pipelines-with-targets.html#cb138-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb138-27"><a href="setting-up-pipelines-with-targets.html#cb138-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-28"><a href="setting-up-pipelines-with-targets.html#cb138-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-29"><a href="setting-up-pipelines-with-targets.html#cb138-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-30"><a href="setting-up-pipelines-with-targets.html#cb138-30" aria-hidden="true" tabindex="-1"></a>        commune_data,</span>
<span id="cb138-31"><a href="setting-up-pipelines-with-targets.html#cb138-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">clean_unemp</span>(unemp_data,</span>
<span id="cb138-32"><a href="setting-up-pipelines-with-targets.html#cb138-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">place_name_of_interest =</span> <span class="fu">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Dippach&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>, <span class="st">&quot;Esch/Alzette&quot;</span>, <span class="st">&quot;Mersch&quot;</span>),</span>
<span id="cb138-33"><a href="setting-up-pipelines-with-targets.html#cb138-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb138-34"><a href="setting-up-pipelines-with-targets.html#cb138-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-35"><a href="setting-up-pipelines-with-targets.html#cb138-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-36"><a href="setting-up-pipelines-with-targets.html#cb138-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-37"><a href="setting-up-pipelines-with-targets.html#cb138-37" aria-hidden="true" tabindex="-1"></a>        lux_plot,</span>
<span id="cb138-38"><a href="setting-up-pipelines-with-targets.html#cb138-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(lux_data)</span>
<span id="cb138-39"><a href="setting-up-pipelines-with-targets.html#cb138-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-40"><a href="setting-up-pipelines-with-targets.html#cb138-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-41"><a href="setting-up-pipelines-with-targets.html#cb138-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-42"><a href="setting-up-pipelines-with-targets.html#cb138-42" aria-hidden="true" tabindex="-1"></a>        canton_plot,</span>
<span id="cb138-43"><a href="setting-up-pipelines-with-targets.html#cb138-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(canton_data)</span>
<span id="cb138-44"><a href="setting-up-pipelines-with-targets.html#cb138-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-45"><a href="setting-up-pipelines-with-targets.html#cb138-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-46"><a href="setting-up-pipelines-with-targets.html#cb138-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-47"><a href="setting-up-pipelines-with-targets.html#cb138-47" aria-hidden="true" tabindex="-1"></a>        commune_plot,</span>
<span id="cb138-48"><a href="setting-up-pipelines-with-targets.html#cb138-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">make_plot</span>(commune_data)</span>
<span id="cb138-49"><a href="setting-up-pipelines-with-targets.html#cb138-49" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-50"><a href="setting-up-pipelines-with-targets.html#cb138-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-51"><a href="setting-up-pipelines-with-targets.html#cb138-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-52"><a href="setting-up-pipelines-with-targets.html#cb138-52" aria-hidden="true" tabindex="-1"></a>        luxembourg_saved_plot,</span>
<span id="cb138-53"><a href="setting-up-pipelines-with-targets.html#cb138-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">save_plot</span>(<span class="st">&quot;fig/luxembourg.png&quot;</span>, lux_plot),</span>
<span id="cb138-54"><a href="setting-up-pipelines-with-targets.html#cb138-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">&quot;file&quot;</span></span>
<span id="cb138-55"><a href="setting-up-pipelines-with-targets.html#cb138-55" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-56"><a href="setting-up-pipelines-with-targets.html#cb138-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-57"><a href="setting-up-pipelines-with-targets.html#cb138-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-58"><a href="setting-up-pipelines-with-targets.html#cb138-58" aria-hidden="true" tabindex="-1"></a>        canton_saved_plot,</span>
<span id="cb138-59"><a href="setting-up-pipelines-with-targets.html#cb138-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">save_plot</span>(<span class="st">&quot;fig/canton.png&quot;</span>, canton_plot),</span>
<span id="cb138-60"><a href="setting-up-pipelines-with-targets.html#cb138-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">&quot;file&quot;</span></span>
<span id="cb138-61"><a href="setting-up-pipelines-with-targets.html#cb138-61" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb138-62"><a href="setting-up-pipelines-with-targets.html#cb138-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-63"><a href="setting-up-pipelines-with-targets.html#cb138-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_target</span>(</span>
<span id="cb138-64"><a href="setting-up-pipelines-with-targets.html#cb138-64" aria-hidden="true" tabindex="-1"></a>        commune_saved_plot,</span>
<span id="cb138-65"><a href="setting-up-pipelines-with-targets.html#cb138-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">save_plot</span>(<span class="st">&quot;fig/commune.png&quot;</span>, commune_plot),</span>
<span id="cb138-66"><a href="setting-up-pipelines-with-targets.html#cb138-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">&quot;file&quot;</span></span>
<span id="cb138-67"><a href="setting-up-pipelines-with-targets.html#cb138-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb138-68"><a href="setting-up-pipelines-with-targets.html#cb138-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-69"><a href="setting-up-pipelines-with-targets.html#cb138-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-70"><a href="setting-up-pipelines-with-targets.html#cb138-70" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s take a look at the network again:</p>
<p><img src="img/pipeline_4.png" width="897" /></p>
<p>Because we are saving a file to disk, we must add the <code>format = "file"</code> argument to the target definiton. This way, <code>{targets}</code> watches
these files for changes as well, and reruns the pipeline if a change is detected. Run the pipeline now with <code>tar_make()</code> and watch the plots
appear in the <code>fig</code> folder (which you may have to create before running the pipeline).</p>
<p>Let’s now change <code>make_plot()</code> function like this:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="setting-up-pipelines-with-targets.html#cb139-1" aria-hidden="true" tabindex="-1"></a>make_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb139-2"><a href="setting-up-pipelines-with-targets.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb139-3"><a href="setting-up-pipelines-with-targets.html#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(</span>
<span id="cb139-4"><a href="setting-up-pipelines-with-targets.html#cb139-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(</span>
<span id="cb139-5"><a href="setting-up-pipelines-with-targets.html#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> active_population,</span>
<span id="cb139-6"><a href="setting-up-pipelines-with-targets.html#cb139-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> year,</span>
<span id="cb139-7"><a href="setting-up-pipelines-with-targets.html#cb139-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> place_name</span>
<span id="cb139-8"><a href="setting-up-pipelines-with-targets.html#cb139-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb139-9"><a href="setting-up-pipelines-with-targets.html#cb139-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb139-10"><a href="setting-up-pipelines-with-targets.html#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb139-11"><a href="setting-up-pipelines-with-targets.html#cb139-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb139-12"><a href="setting-up-pipelines-with-targets.html#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;Unemployement for &quot;</span>, <span class="fu">paste</span>(<span class="fu">unique</span>(data<span class="sc">$</span>place_name), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)))</span>
<span id="cb139-13"><a href="setting-up-pipelines-with-targets.html#cb139-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If you know save the script, and check the pipeline with <code>tar_visnetwork()</code>, you will see that some targets are not out of date:</p>
<p><img src="img/pipeline_5.png" width="904" /></p>
<p>Every targets that gets made by <code>make_plot()</code> must be recomputed, and every targets that depends on
the intemediary outputs of <code>make_plot()</code> as well. Reloading the data is not necessary, since the
edits on <code>make_plot()</code> do not affect these targets. This is an incredible cognitive load that is
taken off the shoulders of data scientists; no need to keep track of outputs that are outdated, and
no need to re-run everything either, saving lots of time and processing power.</p>
<p>You now know the basics of setting up a reproducible (well, almost, as you’ll see) analytical
pipeline. Let’s now move to running someone else’s pipeline.</p>
</div>
<div id="running-someone-elses-pipeline" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Running someone else’s pipeline<a href="setting-up-pipelines-with-targets.html#running-someone-elses-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s now suppose that we want to run someone else’s pipeline, and let’s assume that that person
did a good job and used <code>{renv}</code> to lock the dependencies of the pipeline, and also made the pipeline
available on github.com.</p>
<p>As an example, we are going to use <a href="https://github.com/wlandau/targets-minimal">this repository</a> from the
author of <code>{targets}</code>. To start clone this repository:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="setting-up-pipelines-with-targets.html#cb140-1" aria-hidden="true" tabindex="-1"></a>git clone git<span class="sc">@</span>github.com<span class="sc">:</span>wlandau<span class="sc">/</span>targets<span class="sc">-</span>minimal.git</span></code></pre></div>
<p>and open an R session in the root of the folder (or open the <code>targets-minimal.rproj</code> file in the folder
you just cloned to open the project in RStudio), then call <code>renv::restore()</code>.
You should see this:</p>
<pre><code>&gt; renv::restore()</code></pre>
<pre><code>This project has not yet been activated.
Activating this project will ensure the project library is used during restore.
Please see `?renv::activate` for more details.

Would you like to activate this project before restore? [Y/n]: </code></pre>
<p>Press the <code>y</code> key on your keyboard to continue. The packages to run this pipeline will get installed
in a new library, separate from the default library as usual with <code>{renv}</code>:</p>
<pre><code>ℹ Using R 4.2.1 (lockfile was generated with R 4.1.0)
* Project &#39;~/targets-minimal&#39; loaded. [renv 0.16.0]
* The project library is out of sync with the lockfile.
* Use `renv::restore()` to install packages recorded in the lockfile.
The following package(s) will be updated:

# CRAN ===============================
...very long list of packages I&#39;m not showing here...
Do you want to proceed? [y/N]: </code></pre>
<p>Press Y to install the packages in the separate library.</p>
<p>As you can see from the screenshot below, because the packages used for this pipeline
are not old(ish), they get either download from MRAN or from CRAN’s archive (MRAN is the Microsoft
R Archive Network, a mirror of CRAN maintained by Microsoft, which gets snapshotted every day. It is thus
possible to download old packages from there):</p>
<p><img src="img/pipeline_6.png" width="470" /></p>
<p>You should now restart your R session for good measure (go to <code>Session -&gt; Restart Session</code>). You can now run
the pipeline simply with:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="setting-up-pipelines-with-targets.html#cb144-1" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_make</span>()</span></code></pre></div>
<p>The data product (or output) from this pipeline is the <code>index.html</code> file that appeared on the root folder
of your project.</p>
</div>
<div id="running-any-code-with-older-packages" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Running any code with older packages<a href="setting-up-pipelines-with-targets.html#running-any-code-with-older-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div style="text-align:center;">
<p><img src="img/calendar.png" width="512" /></p>
</div>
<p>What do you do if you need to run code with older packages, but the original developer did not use <code>{renv}</code>?
In such cases it is still possible to run that code with older packages. What you would need to know however
is the rough date where this code was written. Let’s say that you want to run an old script from 2019, and
you want to make sure that the results you will obtain are as close, if not absolutely equal, to the results
you would have obtained then. Let’s further assume that the script was last modified on October 31st 2019.</p>
<p>You can rerun this script with a library that looks like one from that same date using a package made
by Microsoft, called <code>{checkpoint}</code>. This package helps install packages from their repository, MRAN
(which was already mentioned before), and is quite easy to use. Simply add the following line at the top
of the script:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="setting-up-pipelines-with-targets.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkpoint</span>(<span class="st">&quot;2019-10-31&quot;</span>)</span></code></pre></div>
<p>You can read more about checkpoint <a href="https://cran.microsoft.com/web/packages/checkpoint/vignettes/checkpoint.html">here</a>.</p>
</div>
<div id="why-we-need-more" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Why we need more<a href="setting-up-pipelines-with-targets.html#why-we-need-more" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While <code>{renv}</code> is a huge step towards the right direction, there are at least four problems with it:</p>
<ul>
<li><code>{renv}</code> doesn’t do anything about R itself: a pipeline made to run on R version 3 (for example) could still produce different results when run on R 4, even if the packages are the same. In practice, however, R is quite stable, and breaking changes between versions are very rare; most code is retrocompatible for many versions.</li>
<li><code>{renv}</code> doesn’t do anything about the operating system the pipeline is running on. Results can even be different between <a href="https://www.frontiersin.org/articles/10.3389/fninf.2015.00012/full">different versions of the same operating system</a>, but in practice, that should only affect you in very specific businesses were very high precision floating point arithmetic is required.</li>
<li><code>{renv}</code> can sometimes fail to install packages. I tried running William Landau’s demo pipeline on two computers, one running OpenSuse Linux and one running Windows 10. It ran successfully on Linux, but not on Windows.</li>
<li><code>{renv}</code> relies on MRAN and CRAN. While it is unlikely that CRAN will ever be offline, as there are many, many mirrors around the world, <a href="https://en.wikipedia.org/wiki/Lindy_effect">and it could be argued that the longer CRAN is online, the likelier it is it’ll stay online</a>, the same cannot (yet) be said from MRAN. However, <code>{renv}</code> could be made to rely entirely on CRAN, so this last point might not be an issue.</li>
</ul>
<p>We are going to solve these issues in chapter 9, but for now, let’s be grateful for <code>{renv}</code>, <code>{targets}</code> and CRAN (and MRAN), for they allow us to quite easily
build (almost) reproducible pipelines quite easily! In the next chapter, we will continue building pipelines and build our very first data products.</p>
</div>
<div id="further-reading-3" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Further reading<a href="setting-up-pipelines-with-targets.html#further-reading-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>The <code>{targets}</code> <a href="https://books.ropensci.org/targets/">manual</a></li>
<li>The <code>{renv}</code> <a href="https://rstudio.github.io/renv/articles/renv.html">website</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="unit-tests.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-products-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/b-rodrigues/rap4mads/edit/master/07-targets.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/b-rodrigues/rap4mads/blob/master/07-targets.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
