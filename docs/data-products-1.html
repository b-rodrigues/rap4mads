<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Data products | Reproducible Analytical Pipelines - Master’s of Data Science</title>
  <meta name="description" content="Chapter 8 Data products | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Data products | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Data products | Reproducible Analytical Pipelines - Master’s of Data Science" />
  
  
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setting-up-pipelines-with-targets.html"/>
<link rel="next" href="self-contained-raps-with-docker.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAP4MADS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducible-analytical-pipelines"><i class="fa fa-check"></i><b>1.2</b> Reproducible analytical pipelines?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-products"><i class="fa fa-check"></i><b>1.3</b> Data products?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.4</b> Machine learning?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-r-why-not-insert-your-favourite-programming-language"><i class="fa fa-check"></i><b>1.5</b> Why R? Why not [insert your favourite programming language]</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i><b>1.6</b> Pre-requisites</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.7</b> Grading</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#jargon"><i class="fa fa-check"></i><b>1.8</b> Jargon</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#further-reading"><i class="fa fa-check"></i><b>1.9</b> Further reading</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.10</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-in-data-with-r"><i class="fa fa-check"></i><b>2.1</b> Reading in data with R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-little-aside-on-pipes"><i class="fa fa-check"></i><b>2.2</b> A little aside on pipes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exploring-and-cleaning-data-with-r"><i class="fa fa-check"></i><b>2.3</b> Exploring and cleaning data with R</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>2.4</b> Data visualization</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#further-reading-1"><i class="fa fa-check"></i><b>2.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html"><i class="fa fa-check"></i><b>3</b> A primer on functional programming</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#defining-your-own-functions"><i class="fa fa-check"></i><b>3.2</b> Defining your own functions</a></li>
<li class="chapter" data-level="3.3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a></li>
<li class="chapter" data-level="3.4" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#further-reading-2"><i class="fa fa-check"></i><b>3.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#installing-git"><i class="fa fa-check"></i><b>4.2</b> Installing Git</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#setting-up-a-repo"><i class="fa fa-check"></i><b>4.3</b> Setting up a repo</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#cloning-the-repository-onto-your-computer"><i class="fa fa-check"></i><b>4.4</b> Cloning the repository onto your computer</a></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#your-first-commit"><i class="fa fa-check"></i><b>4.5</b> Your first commit</a></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#collaborating"><i class="fa fa-check"></i><b>4.6</b> Collaborating</a></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#branches"><i class="fa fa-check"></i><b>4.7</b> Branches</a></li>
<li class="chapter" data-level="4.8" data-path="git.html"><a href="git.html#contributing-to-someone-elses-repository"><i class="fa fa-check"></i><b>4.8</b> Contributing to someone else’s repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>5</b> Package development</a>
<ul>
<li class="chapter" data-level="5.1" data-path="package-development.html"><a href="package-development.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="package-development.html"><a href="package-development.html#getting-started"><i class="fa fa-check"></i><b>5.2</b> Getting started</a></li>
<li class="chapter" data-level="5.3" data-path="package-development.html"><a href="package-development.html#adding-functions"><i class="fa fa-check"></i><b>5.3</b> Adding functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="package-development.html"><a href="package-development.html#functions-dependencies"><i class="fa fa-check"></i><b>5.3.1</b> Functions dependencies</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="package-development.html"><a href="package-development.html#documentation"><i class="fa fa-check"></i><b>5.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="package-development.html"><a href="package-development.html#documenting-functions"><i class="fa fa-check"></i><b>5.4.1</b> Documenting functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="package-development.html"><a href="package-development.html#documenting-the-package"><i class="fa fa-check"></i><b>5.4.2</b> Documenting the package</a></li>
<li class="chapter" data-level="5.4.3" data-path="package-development.html"><a href="package-development.html#checking-your-package"><i class="fa fa-check"></i><b>5.4.3</b> Checking your package</a></li>
<li class="chapter" data-level="5.4.4" data-path="package-development.html"><a href="package-development.html#installing-your-package"><i class="fa fa-check"></i><b>5.4.4</b> Installing your package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>6</b> Unit tests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unit-tests.html"><a href="unit-tests.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="unit-tests.html"><a href="unit-tests.html#testing-your-package"><i class="fa fa-check"></i><b>6.2</b> Testing your package</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="unit-tests.html"><a href="unit-tests.html#is-the-function-returning-an-expected-value-for-a-given-input"><i class="fa fa-check"></i><b>6.2.1</b> Is the function returning an expected value for a given input?</a></li>
<li class="chapter" data-level="6.2.2" data-path="unit-tests.html"><a href="unit-tests.html#can-the-function-deal-with-all-kinds-of-input"><i class="fa fa-check"></i><b>6.2.2</b> Can the function deal with all kinds of input?</a></li>
<li class="chapter" data-level="6.2.3" data-path="unit-tests.html"><a href="unit-tests.html#back-to-developing-again"><i class="fa fa-check"></i><b>6.2.3</b> Back to developing again</a></li>
<li class="chapter" data-level="6.2.4" data-path="unit-tests.html"><a href="unit-tests.html#and-back-to-testing"><i class="fa fa-check"></i><b>6.2.4</b> And back to testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html"><i class="fa fa-check"></i><b>7</b> Setting up pipelines with <code>{targets}</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#build-automation-with-r"><i class="fa fa-check"></i><b>7.2</b> Build automation with R</a></li>
<li class="chapter" data-level="7.3" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#an-aside-on-renv"><i class="fa fa-check"></i><b>7.3</b> An aside on <code>{renv}</code></a></li>
<li class="chapter" data-level="7.4" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#our-actual-first-pipeline"><i class="fa fa-check"></i><b>7.4</b> Our actual first pipeline</a></li>
<li class="chapter" data-level="7.5" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-someone-elses-pipeline"><i class="fa fa-check"></i><b>7.5</b> Running someone else’s pipeline</a></li>
<li class="chapter" data-level="7.6" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-any-code-with-older-packages"><i class="fa fa-check"></i><b>7.6</b> Running any code with older packages</a></li>
<li class="chapter" data-level="7.7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#why-we-need-more"><i class="fa fa-check"></i><b>7.7</b> Why we need more</a></li>
<li class="chapter" data-level="7.8" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#further-reading-3"><i class="fa fa-check"></i><b>7.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-products-1.html"><a href="data-products-1.html"><i class="fa fa-check"></i><b>8</b> Data products</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-products-1.html"><a href="data-products-1.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="data-products-1.html"><a href="data-products-1.html#a-first-taste-of-quarto"><i class="fa fa-check"></i><b>8.2</b> A first taste of Quarto</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-products-1.html"><a href="data-products-1.html#python-and-julia-code-chunks"><i class="fa fa-check"></i><b>8.2.1</b> Python and Julia code chunks</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-products-1.html"><a href="data-products-1.html#other-output-formats"><i class="fa fa-check"></i><b>8.3</b> Other output formats</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-products-1.html"><a href="data-products-1.html#word"><i class="fa fa-check"></i><b>8.3.1</b> Word</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-products-1.html"><a href="data-products-1.html#presentations"><i class="fa fa-check"></i><b>8.3.2</b> Presentations</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-products-1.html"><a href="data-products-1.html#pdf"><i class="fa fa-check"></i><b>8.3.3</b> PDF</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-products-1.html"><a href="data-products-1.html#interactive-web-applications-with-shiny"><i class="fa fa-check"></i><b>8.4</b> Interactive web applications with {shiny}</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-products-1.html"><a href="data-products-1.html#the-basic-structure-of-a-shiny-app"><i class="fa fa-check"></i><b>8.4.1</b> The basic structure of a Shiny app</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-products-1.html"><a href="data-products-1.html#slightly-more-advanced-shiny"><i class="fa fa-check"></i><b>8.4.2</b> Slightly more advanced shiny</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-products-1.html"><a href="data-products-1.html#basic-optimization-of-shiny-apps"><i class="fa fa-check"></i><b>8.4.3</b> Basic optimization of Shiny apps</a></li>
<li class="chapter" data-level="8.4.4" data-path="data-products-1.html"><a href="data-products-1.html#deploying-your-shiny-app"><i class="fa fa-check"></i><b>8.4.4</b> Deploying your shiny app</a></li>
<li class="chapter" data-level="8.4.5" data-path="data-products-1.html"><a href="data-products-1.html#references"><i class="fa fa-check"></i><b>8.4.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-products-1.html"><a href="data-products-1.html#how-to-build-data-products-using-targets"><i class="fa fa-check"></i><b>8.5</b> How to build data products using <code>{targets}</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html"><i class="fa fa-check"></i><b>9</b> Self-contained RAPs with Docker</a></li>
<li class="chapter" data-level="10" data-path="cicd-with-github-actions.html"><a href="cicd-with-github-actions.html"><i class="fa fa-check"></i><b>10</b> CI/CD with Github Actions</a></li>
<li class="chapter" data-level="11" data-path="what-else-should-you-learn.html"><a href="what-else-should-you-learn.html"><i class="fa fa-check"></i><b>11</b> What else should you learn?</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a>
<ul>
<li class="chapter" data-level="12.1" data-path="conclusion.html"><a href="conclusion.html#why-bother"><i class="fa fa-check"></i><b>12.1</b> Why bother</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/b-rodrigues/rap4mads" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Analytical Pipelines - Master’s of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-products-1" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Data products<a href="data-products-1.html#data-products-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div style="text-align:center;">
<p><img src="img/product.png" width="512" /></p>
</div>
<p>What you’ll have learned by the end of the chapter: you’ll know how to build data products using
Quarto and Shiny.</p>
<div id="introduction-6" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Introduction<a href="data-products-1.html#introduction-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are going to start by building data products using Quarto.</p>
<p>Quarto is a tool created by Posit, the company behind RStudio and Shiny. Quarto leverages pandoc to
convert between many document formats (for example, from <code>.md</code> to <code>.docx</code>) and makes it possible to
embed R, Python, Julia and Observable JS code into documents. It is not an R-specific tool, so it is
a program that you must install on your computer. So go to this
<a href="https://quarto.org/docs/get-started/">link</a> and download and install Quarto.</p>
<p>We are going to start simple, with “static” data products. By static I mean products without any
sort of interactivity, so the user can look at them, read them, but not change them in any way.
These products are essentially going to be documents in the <code>.docx</code>, <code>.pptx</code> and <code>.pdf</code> formats,
but also <code>.html</code>. Thanks to Quarto, it is thus possible to programmatically create documents.</p>
</div>
<div id="a-first-taste-of-quarto" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> A first taste of Quarto<a href="data-products-1.html#a-first-taste-of-quarto" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A Quarto file looks very close to a standard Markdown file. So if you know Markdown, you will not have
many problems to switch to Quarto. If you don’t know Markdown, no worries, its syntax is quite simple
and can be very quickly picked up.</p>
<p>Let’s start with a basic Quarto source. Open your favorite text editor (doesn’t have to be RStudio) and
create a file called <code>example.qmd</code> and copy the following lines in it:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb149-1"><a href="data-products-1.html#cb149-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb149-2"><a href="data-products-1.html#cb149-2" aria-hidden="true" tabindex="-1"></a>title: &quot;My Title&quot;</span>
<span id="cb149-3"><a href="data-products-1.html#cb149-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb149-4"><a href="data-products-1.html#cb149-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb149-5"><a href="data-products-1.html#cb149-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb149-6"><a href="data-products-1.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="data-products-1.html#cb149-7" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb149-8"><a href="data-products-1.html#cb149-8" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb149-9"><a href="data-products-1.html#cb149-9" aria-hidden="true" tabindex="-1"></a>n &lt;- 10</span>
<span id="cb149-10"><a href="data-products-1.html#cb149-10" aria-hidden="true" tabindex="-1"></a>rnorm(n)</span>
<span id="cb149-11"><a href="data-products-1.html#cb149-11" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://tiny-melomakarona-b87385.netlify.app/">This is the output</a>.</p>
<p>The first few lines of the document is where you can define the title of the document, the name of the author
and the date. For the date, I’ve use the <code>today</code> keyword to get today’s date
but you could use a string to set the date to a specific day (for example, “2022-10-28”).
The content in the document consists of a level 2 title (<code>## This is a simple quarto document</code>) and of an
R code chunk. Code chunks is were you will write code that gets then evaluated at render (compile) time.
To compile this file, run the following inside a terminal:</p>
<pre><code>➤ quarto render example.qmd</code></pre>
<p>If you’re inside RStudio, you can also render the document by pressing <code>CTRL-SHIFT-K</code> or run the command:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="data-products-1.html#cb151-1" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">&quot;example.qmd&quot;</span>)</span></code></pre></div>
<p>There are various ways to integrate Quarto with different editors:</p>
<ul>
<li><a href="https://quarto.org/docs/get-started/hello/vscode.html">VS Code</a></li>
<li><a href="https://quarto.org/docs/get-started/hello/rstudio.html">RStudio</a></li>
<li><a href="https://quarto.org/docs/get-started/hello/jupyter.html">Jupyter</a></li>
<li><a href="https://quarto.org/docs/get-started/hello/text-editor.html#editor-modes">(Neo)Vim, Emacs, Sublime</a></li>
</ul>
<p>Once the file is done rendering, you should find an <code>html</code> file in the same folder.
Open this html file inside a web browser and see the output. It is possible to run arbitrary R code
inside the code chunks:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb152-1"><a href="data-products-1.html#cb152-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb152-2"><a href="data-products-1.html#cb152-2" aria-hidden="true" tabindex="-1"></a>title: &quot;My Title&quot;</span>
<span id="cb152-3"><a href="data-products-1.html#cb152-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb152-4"><a href="data-products-1.html#cb152-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb152-5"><a href="data-products-1.html#cb152-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb152-6"><a href="data-products-1.html#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="data-products-1.html#cb152-7" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb152-8"><a href="data-products-1.html#cb152-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-9"><a href="data-products-1.html#cb152-9" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb152-10"><a href="data-products-1.html#cb152-10" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb152-11"><a href="data-products-1.html#cb152-11" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb152-12"><a href="data-products-1.html#cb152-12" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb152-13"><a href="data-products-1.html#cb152-13" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb152-14"><a href="data-products-1.html#cb152-14" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb152-15"><a href="data-products-1.html#cb152-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-16"><a href="data-products-1.html#cb152-16" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb152-17"><a href="data-products-1.html#cb152-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-18"><a href="data-products-1.html#cb152-18" aria-hidden="true" tabindex="-1"></a>unemp %&gt;% </span>
<span id="cb152-19"><a href="data-products-1.html#cb152-19" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;% </span>
<span id="cb152-20"><a href="data-products-1.html#cb152-20" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;,</span>
<span id="cb152-21"><a href="data-products-1.html#cb152-21" aria-hidden="true" tabindex="-1"></a>         place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;% </span>
<span id="cb152-22"><a href="data-products-1.html#cb152-22" aria-hidden="true" tabindex="-1"></a>  group_by(place_name) %&gt;%</span>
<span id="cb152-23"><a href="data-products-1.html#cb152-23" aria-hidden="true" tabindex="-1"></a>  nest() %&gt;% </span>
<span id="cb152-24"><a href="data-products-1.html#cb152-24" aria-hidden="true" tabindex="-1"></a>  mutate(plots = map2(.x = data, .y = place_name, ~ggplot(data = .x) +</span>
<span id="cb152-25"><a href="data-products-1.html#cb152-25" aria-hidden="true" tabindex="-1"></a>                                                theme_minimal() +</span>
<span id="cb152-26"><a href="data-products-1.html#cb152-26" aria-hidden="true" tabindex="-1"></a>                                                geom_line(aes(year, unemployment_rate_in_percent, group = 1)) +</span>
<span id="cb152-27"><a href="data-products-1.html#cb152-27" aria-hidden="true" tabindex="-1"></a>                                                labs(title = paste(&quot;Unemployment in&quot;, .y)))) %&gt;%</span>
<span id="cb152-28"><a href="data-products-1.html#cb152-28" aria-hidden="true" tabindex="-1"></a>  pull(plots)</span>
<span id="cb152-29"><a href="data-products-1.html#cb152-29" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://scintillating-crostata-2df896.netlify.app/">This is what the output looks like.</a></p>
<p>As you can see, it is quite easy to create a document with potentially hundreds of plots using what we’ve learned
until now. However, our document does not look great; for starters, we see the source code there, which we would like to hide.
People that will read this document might not be interested in the source code, but only in the plots. The other issue
is that when loading the <code>{dplyr}</code> package, users get some message informing them about some functions that get masked.
We would like to hide all of this. It turns out that code chunks have options, and we can use them to hide source code
and warning messages:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb153-1"><a href="data-products-1.html#cb153-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-2"><a href="data-products-1.html#cb153-2" aria-hidden="true" tabindex="-1"></a>title: &quot;My Title&quot;</span>
<span id="cb153-3"><a href="data-products-1.html#cb153-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb153-4"><a href="data-products-1.html#cb153-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb153-5"><a href="data-products-1.html#cb153-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-6"><a href="data-products-1.html#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="data-products-1.html#cb153-7" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb153-8"><a href="data-products-1.html#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="data-products-1.html#cb153-9" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb153-10"><a href="data-products-1.html#cb153-10" aria-hidden="true" tabindex="-1"></a>#| echo: false</span>
<span id="cb153-11"><a href="data-products-1.html#cb153-11" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb153-12"><a href="data-products-1.html#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="data-products-1.html#cb153-13" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb153-14"><a href="data-products-1.html#cb153-14" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb153-15"><a href="data-products-1.html#cb153-15" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb153-16"><a href="data-products-1.html#cb153-16" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb153-17"><a href="data-products-1.html#cb153-17" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb153-18"><a href="data-products-1.html#cb153-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-19"><a href="data-products-1.html#cb153-19" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb153-20"><a href="data-products-1.html#cb153-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-21"><a href="data-products-1.html#cb153-21" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb153-22"><a href="data-products-1.html#cb153-22" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb153-23"><a href="data-products-1.html#cb153-23" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;,</span>
<span id="cb153-24"><a href="data-products-1.html#cb153-24" aria-hidden="true" tabindex="-1"></a>         place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;%</span>
<span id="cb153-25"><a href="data-products-1.html#cb153-25" aria-hidden="true" tabindex="-1"></a>  group_by(place_name) %&gt;%</span>
<span id="cb153-26"><a href="data-products-1.html#cb153-26" aria-hidden="true" tabindex="-1"></a>  nest() %&gt;%</span>
<span id="cb153-27"><a href="data-products-1.html#cb153-27" aria-hidden="true" tabindex="-1"></a>  mutate(plots = map2(.x = data, .y = place_name, ~ggplot(data = .x) +</span>
<span id="cb153-28"><a href="data-products-1.html#cb153-28" aria-hidden="true" tabindex="-1"></a>                                                theme_minimal() +</span>
<span id="cb153-29"><a href="data-products-1.html#cb153-29" aria-hidden="true" tabindex="-1"></a>                                                geom_line(aes(year, unemployment_rate_in_percent, group = 1)) +</span>
<span id="cb153-30"><a href="data-products-1.html#cb153-30" aria-hidden="true" tabindex="-1"></a>                                                labs(title = paste(&quot;Unemployment in&quot;, .y)))) %&gt;%</span>
<span id="cb153-31"><a href="data-products-1.html#cb153-31" aria-hidden="true" tabindex="-1"></a>  pull(plots)</span>
<span id="cb153-32"><a href="data-products-1.html#cb153-32" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://velvety-taffy-93cb66.netlify.app/">This is what the output looks like.</a></p>
<p>Rendering this document will result in something nicer. We could also fold the code instead of completely removing
it. This is useful if we need to send the document to collaborators who might be interested in the source code as well.
However, code folding is something that only works in <code>html</code> outputs, and thus we need to specify the output format in the
header of the document (look at the three new lines after we define the data), and also remove the <code>echo: false</code> option
from the R chunk:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb154-1"><a href="data-products-1.html#cb154-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb154-2"><a href="data-products-1.html#cb154-2" aria-hidden="true" tabindex="-1"></a>title: &quot;My Title&quot;</span>
<span id="cb154-3"><a href="data-products-1.html#cb154-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb154-4"><a href="data-products-1.html#cb154-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb154-5"><a href="data-products-1.html#cb154-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb154-6"><a href="data-products-1.html#cb154-6" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb154-7"><a href="data-products-1.html#cb154-7" aria-hidden="true" tabindex="-1"></a>    code-fold: true</span>
<span id="cb154-8"><a href="data-products-1.html#cb154-8" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb154-9"><a href="data-products-1.html#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="data-products-1.html#cb154-10" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb154-11"><a href="data-products-1.html#cb154-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-12"><a href="data-products-1.html#cb154-12" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb154-13"><a href="data-products-1.html#cb154-13" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb154-14"><a href="data-products-1.html#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="data-products-1.html#cb154-15" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb154-16"><a href="data-products-1.html#cb154-16" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb154-17"><a href="data-products-1.html#cb154-17" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb154-18"><a href="data-products-1.html#cb154-18" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb154-19"><a href="data-products-1.html#cb154-19" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb154-20"><a href="data-products-1.html#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="data-products-1.html#cb154-21" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb154-22"><a href="data-products-1.html#cb154-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-23"><a href="data-products-1.html#cb154-23" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb154-24"><a href="data-products-1.html#cb154-24" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb154-25"><a href="data-products-1.html#cb154-25" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;,</span>
<span id="cb154-26"><a href="data-products-1.html#cb154-26" aria-hidden="true" tabindex="-1"></a>         place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;%</span>
<span id="cb154-27"><a href="data-products-1.html#cb154-27" aria-hidden="true" tabindex="-1"></a>  group_by(place_name) %&gt;%</span>
<span id="cb154-28"><a href="data-products-1.html#cb154-28" aria-hidden="true" tabindex="-1"></a>  nest() %&gt;%</span>
<span id="cb154-29"><a href="data-products-1.html#cb154-29" aria-hidden="true" tabindex="-1"></a>  mutate(plots = map2(.x = data, .y = place_name, ~ggplot(data = .x) +</span>
<span id="cb154-30"><a href="data-products-1.html#cb154-30" aria-hidden="true" tabindex="-1"></a>                                                theme_minimal() +</span>
<span id="cb154-31"><a href="data-products-1.html#cb154-31" aria-hidden="true" tabindex="-1"></a>                                                geom_line(aes(year, unemployment_rate_in_percent, group = 1)) +</span>
<span id="cb154-32"><a href="data-products-1.html#cb154-32" aria-hidden="true" tabindex="-1"></a>                                                labs(title = paste(&quot;Unemployment in&quot;, .y)))) %&gt;%</span>
<span id="cb154-33"><a href="data-products-1.html#cb154-33" aria-hidden="true" tabindex="-1"></a>  pull(plots)</span>
<span id="cb154-34"><a href="data-products-1.html#cb154-34" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://voluble-choux-674399.netlify.app/">This is what the output looks like.</a></p>
<p>It is of course possible to write several R chunks:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb155-1"><a href="data-products-1.html#cb155-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb155-2"><a href="data-products-1.html#cb155-2" aria-hidden="true" tabindex="-1"></a>title: &quot;My Title&quot;</span>
<span id="cb155-3"><a href="data-products-1.html#cb155-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb155-4"><a href="data-products-1.html#cb155-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb155-5"><a href="data-products-1.html#cb155-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb155-6"><a href="data-products-1.html#cb155-6" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb155-7"><a href="data-products-1.html#cb155-7" aria-hidden="true" tabindex="-1"></a>    code-fold: true</span>
<span id="cb155-8"><a href="data-products-1.html#cb155-8" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb155-9"><a href="data-products-1.html#cb155-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-10"><a href="data-products-1.html#cb155-10" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb155-11"><a href="data-products-1.html#cb155-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-12"><a href="data-products-1.html#cb155-12" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb155-13"><a href="data-products-1.html#cb155-13" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb155-14"><a href="data-products-1.html#cb155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-15"><a href="data-products-1.html#cb155-15" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb155-16"><a href="data-products-1.html#cb155-16" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb155-17"><a href="data-products-1.html#cb155-17" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb155-18"><a href="data-products-1.html#cb155-18" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb155-19"><a href="data-products-1.html#cb155-19" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb155-20"><a href="data-products-1.html#cb155-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-21"><a href="data-products-1.html#cb155-21" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb155-22"><a href="data-products-1.html#cb155-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-23"><a href="data-products-1.html#cb155-23" aria-hidden="true" tabindex="-1"></a>unemp &lt;- unemp %&gt;%</span>
<span id="cb155-24"><a href="data-products-1.html#cb155-24" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb155-25"><a href="data-products-1.html#cb155-25" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;)</span>
<span id="cb155-26"><a href="data-products-1.html#cb155-26" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb155-27"><a href="data-products-1.html#cb155-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-28"><a href="data-products-1.html#cb155-28" aria-hidden="true" tabindex="-1"></a>There are `r length(unique(unemp$place_name))` communes in the dataset.</span>
<span id="cb155-29"><a href="data-products-1.html#cb155-29" aria-hidden="true" tabindex="-1"></a>Below we plot the unemployment rate for 3 communes:</span>
<span id="cb155-30"><a href="data-products-1.html#cb155-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-31"><a href="data-products-1.html#cb155-31" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb155-32"><a href="data-products-1.html#cb155-32" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb155-33"><a href="data-products-1.html#cb155-33" aria-hidden="true" tabindex="-1"></a>  filter(place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;%</span>
<span id="cb155-34"><a href="data-products-1.html#cb155-34" aria-hidden="true" tabindex="-1"></a>  group_by(place_name) %&gt;%</span>
<span id="cb155-35"><a href="data-products-1.html#cb155-35" aria-hidden="true" tabindex="-1"></a>  nest() %&gt;%</span>
<span id="cb155-36"><a href="data-products-1.html#cb155-36" aria-hidden="true" tabindex="-1"></a>  mutate(plots = map2(.x = data, .y = place_name, ~ggplot(data = .x) +</span>
<span id="cb155-37"><a href="data-products-1.html#cb155-37" aria-hidden="true" tabindex="-1"></a>                                                theme_minimal() +</span>
<span id="cb155-38"><a href="data-products-1.html#cb155-38" aria-hidden="true" tabindex="-1"></a>                                                geom_line(aes(year, unemployment_rate_in_percent, group = 1)) +</span>
<span id="cb155-39"><a href="data-products-1.html#cb155-39" aria-hidden="true" tabindex="-1"></a>                                                labs(title = paste(&quot;Unemployment in&quot;, .y)))) %&gt;%</span>
<span id="cb155-40"><a href="data-products-1.html#cb155-40" aria-hidden="true" tabindex="-1"></a>  pull(plots)</span>
<span id="cb155-41"><a href="data-products-1.html#cb155-41" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://relaxed-concha-89be95.netlify.app/">This is what the output looks like</a>.</p>
<div id="python-and-julia-code-chunks" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Python and Julia code chunks<a href="data-products-1.html#python-and-julia-code-chunks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is possible, inside the same Quarto document, to define code chunks that run Python (or even Julia) code.
Put the following lines inside a file called <code>example2.qmd</code>
(to run the example below, you will need to have Python installed):</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb156-1"><a href="data-products-1.html#cb156-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb156-2"><a href="data-products-1.html#cb156-2" aria-hidden="true" tabindex="-1"></a>title: &quot;R and Python&quot;</span>
<span id="cb156-3"><a href="data-products-1.html#cb156-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb156-4"><a href="data-products-1.html#cb156-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb156-5"><a href="data-products-1.html#cb156-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb156-6"><a href="data-products-1.html#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="data-products-1.html#cb156-7" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb156-8"><a href="data-products-1.html#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="data-products-1.html#cb156-9" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb156-10"><a href="data-products-1.html#cb156-10" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb156-11"><a href="data-products-1.html#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="data-products-1.html#cb156-12" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb156-13"><a href="data-products-1.html#cb156-13" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb156-14"><a href="data-products-1.html#cb156-14" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb156-15"><a href="data-products-1.html#cb156-15" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb156-16"><a href="data-products-1.html#cb156-16" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb156-17"><a href="data-products-1.html#cb156-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-18"><a href="data-products-1.html#cb156-18" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb156-19"><a href="data-products-1.html#cb156-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-20"><a href="data-products-1.html#cb156-20" aria-hidden="true" tabindex="-1"></a>unemp &lt;- unemp %&gt;%</span>
<span id="cb156-21"><a href="data-products-1.html#cb156-21" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb156-22"><a href="data-products-1.html#cb156-22" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;)</span>
<span id="cb156-23"><a href="data-products-1.html#cb156-23" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb156-24"><a href="data-products-1.html#cb156-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-25"><a href="data-products-1.html#cb156-25" aria-hidden="true" tabindex="-1"></a>```{python}</span>
<span id="cb156-26"><a href="data-products-1.html#cb156-26" aria-hidden="true" tabindex="-1"></a>print(&quot;hello from Python&quot;)</span>
<span id="cb156-27"><a href="data-products-1.html#cb156-27" aria-hidden="true" tabindex="-1"></a>import sys</span>
<span id="cb156-28"><a href="data-products-1.html#cb156-28" aria-hidden="true" tabindex="-1"></a>print(sys.version)</span>
<span id="cb156-29"><a href="data-products-1.html#cb156-29" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://phenomenal-clafoutis-2b05c1.netlify.app/">This is what the output looks like.</a></p>
<p>If you have trouble rendering this line, make sure that you have the <code>jupyter</code> and <code>jupyterlab</code> modules installed.</p>
<p>It is also possible to pass objects from R to Python (and vice-versa):</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb157-1"><a href="data-products-1.html#cb157-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb157-2"><a href="data-products-1.html#cb157-2" aria-hidden="true" tabindex="-1"></a>title: &quot;R and Python&quot;</span>
<span id="cb157-3"><a href="data-products-1.html#cb157-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb157-4"><a href="data-products-1.html#cb157-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb157-5"><a href="data-products-1.html#cb157-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb157-6"><a href="data-products-1.html#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="data-products-1.html#cb157-7" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document</span>
<span id="cb157-8"><a href="data-products-1.html#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="data-products-1.html#cb157-9" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb157-10"><a href="data-products-1.html#cb157-10" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb157-11"><a href="data-products-1.html#cb157-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-12"><a href="data-products-1.html#cb157-12" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb157-13"><a href="data-products-1.html#cb157-13" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb157-14"><a href="data-products-1.html#cb157-14" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb157-15"><a href="data-products-1.html#cb157-15" aria-hidden="true" tabindex="-1"></a>library(ggplot2)</span>
<span id="cb157-16"><a href="data-products-1.html#cb157-16" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb157-17"><a href="data-products-1.html#cb157-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-18"><a href="data-products-1.html#cb157-18" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb157-19"><a href="data-products-1.html#cb157-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-20"><a href="data-products-1.html#cb157-20" aria-hidden="true" tabindex="-1"></a>unemp &lt;- unemp %&gt;%</span>
<span id="cb157-21"><a href="data-products-1.html#cb157-21" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb157-22"><a href="data-products-1.html#cb157-22" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;)</span>
<span id="cb157-23"><a href="data-products-1.html#cb157-23" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb157-24"><a href="data-products-1.html#cb157-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-25"><a href="data-products-1.html#cb157-25" aria-hidden="true" tabindex="-1"></a>The data that was loaded and cleaned from R can be accessed from Python using `r.unemp`:</span>
<span id="cb157-26"><a href="data-products-1.html#cb157-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-27"><a href="data-products-1.html#cb157-27" aria-hidden="true" tabindex="-1"></a>```{python}</span>
<span id="cb157-28"><a href="data-products-1.html#cb157-28" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb157-29"><a href="data-products-1.html#cb157-29" aria-hidden="true" tabindex="-1"></a>unemp_pd = pd.DataFrame(r.unemp)</span>
<span id="cb157-30"><a href="data-products-1.html#cb157-30" aria-hidden="true" tabindex="-1"></a>unemp_pd.head</span>
<span id="cb157-31"><a href="data-products-1.html#cb157-31" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://endearing-gnome-80e9df.netlify.app/">This is what the output looks like.</a></p>
<p>The HTML output is quite flexible, as it is possible to also integrate JS libraries. The following
example uses the <code>{g2r}</code> library (an R wrapper around the g2 javascript library) for creating
visualisations. To run the following code, make sure that you have the <code>{g2r}</code> package installed
(can only be install from github):</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="data-products-1.html#cb158-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;devOpifex/g2r&quot;</span>)</span></code></pre></div>
<p>The source file looks like this:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb159-1"><a href="data-products-1.html#cb159-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb159-2"><a href="data-products-1.html#cb159-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Quarto and JS libraries&quot;</span>
<span id="cb159-3"><a href="data-products-1.html#cb159-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb159-4"><a href="data-products-1.html#cb159-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb159-5"><a href="data-products-1.html#cb159-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb159-6"><a href="data-products-1.html#cb159-6" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb159-7"><a href="data-products-1.html#cb159-7" aria-hidden="true" tabindex="-1"></a>    code-fold: true</span>
<span id="cb159-8"><a href="data-products-1.html#cb159-8" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb159-9"><a href="data-products-1.html#cb159-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-10"><a href="data-products-1.html#cb159-10" aria-hidden="true" tabindex="-1"></a>## This is a simple quarto document showing basic plot interactivity using {g2r}</span>
<span id="cb159-11"><a href="data-products-1.html#cb159-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-12"><a href="data-products-1.html#cb159-12" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb159-13"><a href="data-products-1.html#cb159-13" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb159-14"><a href="data-products-1.html#cb159-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-15"><a href="data-products-1.html#cb159-15" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb159-16"><a href="data-products-1.html#cb159-16" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb159-17"><a href="data-products-1.html#cb159-17" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb159-18"><a href="data-products-1.html#cb159-18" aria-hidden="true" tabindex="-1"></a>library(g2r)</span>
<span id="cb159-19"><a href="data-products-1.html#cb159-19" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb159-20"><a href="data-products-1.html#cb159-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-21"><a href="data-products-1.html#cb159-21" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb159-22"><a href="data-products-1.html#cb159-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-23"><a href="data-products-1.html#cb159-23" aria-hidden="true" tabindex="-1"></a>unemp &lt;- unemp %&gt;%</span>
<span id="cb159-24"><a href="data-products-1.html#cb159-24" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb159-25"><a href="data-products-1.html#cb159-25" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;)</span>
<span id="cb159-26"><a href="data-products-1.html#cb159-26" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb159-27"><a href="data-products-1.html#cb159-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-28"><a href="data-products-1.html#cb159-28" aria-hidden="true" tabindex="-1"></a>There are `r length(unique(unemp$place_name))` communes in the dataset. Below we plot the unemployment rate for 3 communes:</span>
<span id="cb159-29"><a href="data-products-1.html#cb159-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-30"><a href="data-products-1.html#cb159-30" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb159-31"><a href="data-products-1.html#cb159-31" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb159-32"><a href="data-products-1.html#cb159-32" aria-hidden="true" tabindex="-1"></a>  filter(place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;%</span>
<span id="cb159-33"><a href="data-products-1.html#cb159-33" aria-hidden="true" tabindex="-1"></a>  g2(data = .) %&gt;% </span>
<span id="cb159-34"><a href="data-products-1.html#cb159-34" aria-hidden="true" tabindex="-1"></a>  fig_line(asp(year, unemployment_rate_in_percent, color = place_name)) </span>
<span id="cb159-35"><a href="data-products-1.html#cb159-35" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://timely-marzipan-6380f0.netlify.app/">This is what the output looks like.</a></p>
<p>It is possible to use other JS libraries, like here <code>DataTables</code>, wrapped inside the <code>{DT}</code> package:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb160-1"><a href="data-products-1.html#cb160-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb160-2"><a href="data-products-1.html#cb160-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Quarto and JS libraries&quot;</span>
<span id="cb160-3"><a href="data-products-1.html#cb160-3" aria-hidden="true" tabindex="-1"></a>author: &quot;My name&quot;</span>
<span id="cb160-4"><a href="data-products-1.html#cb160-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb160-5"><a href="data-products-1.html#cb160-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb160-6"><a href="data-products-1.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb160-7"><a href="data-products-1.html#cb160-7" aria-hidden="true" tabindex="-1"></a>    toc: true</span>
<span id="cb160-8"><a href="data-products-1.html#cb160-8" aria-hidden="true" tabindex="-1"></a>    code-fold: true</span>
<span id="cb160-9"><a href="data-products-1.html#cb160-9" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb160-10"><a href="data-products-1.html#cb160-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-11"><a href="data-products-1.html#cb160-11" aria-hidden="true" tabindex="-1"></a>## Basic plot interactivity using {g2r}</span>
<span id="cb160-12"><a href="data-products-1.html#cb160-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-13"><a href="data-products-1.html#cb160-13" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb160-14"><a href="data-products-1.html#cb160-14" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb160-15"><a href="data-products-1.html#cb160-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-16"><a href="data-products-1.html#cb160-16" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb160-17"><a href="data-products-1.html#cb160-17" aria-hidden="true" tabindex="-1"></a>library(tidyr)</span>
<span id="cb160-18"><a href="data-products-1.html#cb160-18" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb160-19"><a href="data-products-1.html#cb160-19" aria-hidden="true" tabindex="-1"></a>library(g2r)</span>
<span id="cb160-20"><a href="data-products-1.html#cb160-20" aria-hidden="true" tabindex="-1"></a>library(DT)</span>
<span id="cb160-21"><a href="data-products-1.html#cb160-21" aria-hidden="true" tabindex="-1"></a>library(myPackage)</span>
<span id="cb160-22"><a href="data-products-1.html#cb160-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-23"><a href="data-products-1.html#cb160-23" aria-hidden="true" tabindex="-1"></a>data(&quot;unemp&quot;)</span>
<span id="cb160-24"><a href="data-products-1.html#cb160-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-25"><a href="data-products-1.html#cb160-25" aria-hidden="true" tabindex="-1"></a>unemp &lt;- unemp %&gt;%</span>
<span id="cb160-26"><a href="data-products-1.html#cb160-26" aria-hidden="true" tabindex="-1"></a>  mutate(year = as.character(year)) %&gt;% </span>
<span id="cb160-27"><a href="data-products-1.html#cb160-27" aria-hidden="true" tabindex="-1"></a>  janitor::clean_names() %&gt;%</span>
<span id="cb160-28"><a href="data-products-1.html#cb160-28" aria-hidden="true" tabindex="-1"></a>  filter(level == &quot;Commune&quot;)</span>
<span id="cb160-29"><a href="data-products-1.html#cb160-29" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb160-30"><a href="data-products-1.html#cb160-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-31"><a href="data-products-1.html#cb160-31" aria-hidden="true" tabindex="-1"></a>There are `r length(unique(unemp$place_name))` communes in the dataset. Below we plot the unemployment rate for 3 communes:</span>
<span id="cb160-32"><a href="data-products-1.html#cb160-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-33"><a href="data-products-1.html#cb160-33" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb160-34"><a href="data-products-1.html#cb160-34" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb160-35"><a href="data-products-1.html#cb160-35" aria-hidden="true" tabindex="-1"></a>  filter(place_name %in% c(&quot;Luxembourg&quot;, &quot;Esch-sur-Alzette&quot;, &quot;Wiltz&quot;)) %&gt;%</span>
<span id="cb160-36"><a href="data-products-1.html#cb160-36" aria-hidden="true" tabindex="-1"></a>  g2(data = .) %&gt;% </span>
<span id="cb160-37"><a href="data-products-1.html#cb160-37" aria-hidden="true" tabindex="-1"></a>  fig_line(asp(year, unemployment_rate_in_percent, color = place_name)) </span>
<span id="cb160-38"><a href="data-products-1.html#cb160-38" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb160-39"><a href="data-products-1.html#cb160-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-40"><a href="data-products-1.html#cb160-40" aria-hidden="true" tabindex="-1"></a>## Interactive tables with {DT}</span>
<span id="cb160-41"><a href="data-products-1.html#cb160-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-42"><a href="data-products-1.html#cb160-42" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb160-43"><a href="data-products-1.html#cb160-43" aria-hidden="true" tabindex="-1"></a>unemp %&gt;%</span>
<span id="cb160-44"><a href="data-products-1.html#cb160-44" aria-hidden="true" tabindex="-1"></a>  DT::datatable(filter = &quot;top&quot;) </span>
<span id="cb160-45"><a href="data-products-1.html#cb160-45" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb160-46"><a href="data-products-1.html#cb160-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-47"><a href="data-products-1.html#cb160-47" aria-hidden="true" tabindex="-1"></a>## Others</span>
<span id="cb160-48"><a href="data-products-1.html#cb160-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-49"><a href="data-products-1.html#cb160-49" aria-hidden="true" tabindex="-1"></a>You can find more widgets over [here](http://gallery.htmlwidgets.org/).</span></code></pre></div>
<p><a href="https://playful-cucurucho-5cdcbb.netlify.app/">This is what the output looks like.</a></p>
<p>The final example illustrates templating. It is possible to write code that generates qmd code:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb161-1"><a href="data-products-1.html#cb161-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb161-2"><a href="data-products-1.html#cb161-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Templating with Quarto&quot;</span>
<span id="cb161-3"><a href="data-products-1.html#cb161-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb161-4"><a href="data-products-1.html#cb161-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb161-5"><a href="data-products-1.html#cb161-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb161-6"><a href="data-products-1.html#cb161-6" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb161-7"><a href="data-products-1.html#cb161-7" aria-hidden="true" tabindex="-1"></a>    toc: true</span>
<span id="cb161-8"><a href="data-products-1.html#cb161-8" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb161-9"><a href="data-products-1.html#cb161-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-10"><a href="data-products-1.html#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="data-products-1.html#cb161-11" aria-hidden="true" tabindex="-1"></a># Set up</span>
<span id="cb161-12"><a href="data-products-1.html#cb161-12" aria-hidden="true" tabindex="-1"></a>The goal is to have a frequency table for each question in a survey. But we</span>
<span id="cb161-13"><a href="data-products-1.html#cb161-13" aria-hidden="true" tabindex="-1"></a>do not want to have to do it by hand, so we define a function to create a </span>
<span id="cb161-14"><a href="data-products-1.html#cb161-14" aria-hidden="true" tabindex="-1"></a>table, and then, using the templating capabilities of Quarto, write some</span>
<span id="cb161-15"><a href="data-products-1.html#cb161-15" aria-hidden="true" tabindex="-1"></a>code to generate valid qmarkdown code. In the example below our survey only</span>
<span id="cb161-16"><a href="data-products-1.html#cb161-16" aria-hidden="true" tabindex="-1"></a>has 4 questions, but the solution described trivially scales to an infinity</span>
<span id="cb161-17"><a href="data-products-1.html#cb161-17" aria-hidden="true" tabindex="-1"></a>of questions. This is not the case if you’re solving this problem by hand.</span>
<span id="cb161-18"><a href="data-products-1.html#cb161-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-19"><a href="data-products-1.html#cb161-19" aria-hidden="true" tabindex="-1"></a>Start by loading the data and defining some needed variables:</span>
<span id="cb161-20"><a href="data-products-1.html#cb161-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-21"><a href="data-products-1.html#cb161-21" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-22"><a href="data-products-1.html#cb161-22" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb161-23"><a href="data-products-1.html#cb161-23" aria-hidden="true" tabindex="-1"></a>library(lubridate)</span>
<span id="cb161-24"><a href="data-products-1.html#cb161-24" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb161-25"><a href="data-products-1.html#cb161-25" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb161-26"><a href="data-products-1.html#cb161-26" aria-hidden="true" tabindex="-1"></a>library(rlang)</span>
<span id="cb161-27"><a href="data-products-1.html#cb161-27" aria-hidden="true" tabindex="-1"></a>library(DT)</span>
<span id="cb161-28"><a href="data-products-1.html#cb161-28" aria-hidden="true" tabindex="-1"></a>survey_data &lt;- read.csv(</span>
<span id="cb161-29"><a href="data-products-1.html#cb161-29" aria-hidden="true" tabindex="-1"></a>&quot;https://gist.githubusercontent.com/b-rodrigues/0c2249dec5a9c9477e0d1ad9964a1340/raw/873bcc7532b8bad613235f029884df1d0b947c90/survey_example.csv&quot;</span>
<span id="cb161-30"><a href="data-products-1.html#cb161-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb161-31"><a href="data-products-1.html#cb161-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-32"><a href="data-products-1.html#cb161-32" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-33"><a href="data-products-1.html#cb161-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-34"><a href="data-products-1.html#cb161-34" aria-hidden="true" tabindex="-1"></a>Let’s take a look at the data:</span>
<span id="cb161-35"><a href="data-products-1.html#cb161-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-36"><a href="data-products-1.html#cb161-36" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-37"><a href="data-products-1.html#cb161-37" aria-hidden="true" tabindex="-1"></a>datatable(survey_data)</span>
<span id="cb161-38"><a href="data-products-1.html#cb161-38" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-39"><a href="data-products-1.html#cb161-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-40"><a href="data-products-1.html#cb161-40" aria-hidden="true" tabindex="-1"></a>The column names are actually questions, so we save those in a variable:</span>
<span id="cb161-41"><a href="data-products-1.html#cb161-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-42"><a href="data-products-1.html#cb161-42" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-43"><a href="data-products-1.html#cb161-43" aria-hidden="true" tabindex="-1"></a>questions &lt;- colnames(survey_data)</span>
<span id="cb161-44"><a href="data-products-1.html#cb161-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-45"><a href="data-products-1.html#cb161-45" aria-hidden="true" tabindex="-1"></a>questions</span>
<span id="cb161-46"><a href="data-products-1.html#cb161-46" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-47"><a href="data-products-1.html#cb161-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-48"><a href="data-products-1.html#cb161-48" aria-hidden="true" tabindex="-1"></a>Now we define question codes:</span>
<span id="cb161-49"><a href="data-products-1.html#cb161-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-50"><a href="data-products-1.html#cb161-50" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-51"><a href="data-products-1.html#cb161-51" aria-hidden="true" tabindex="-1"></a>codes &lt;- paste0(&quot;var_&quot;, seq(1, 4))</span>
<span id="cb161-52"><a href="data-products-1.html#cb161-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-53"><a href="data-products-1.html#cb161-53" aria-hidden="true" tabindex="-1"></a>codes</span>
<span id="cb161-54"><a href="data-products-1.html#cb161-54" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-55"><a href="data-products-1.html#cb161-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-56"><a href="data-products-1.html#cb161-56" aria-hidden="true" tabindex="-1"></a>We create a lookup table that links questions to their codes:</span>
<span id="cb161-57"><a href="data-products-1.html#cb161-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-58"><a href="data-products-1.html#cb161-58" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-59"><a href="data-products-1.html#cb161-59" aria-hidden="true" tabindex="-1"></a>lookup &lt;- bind_cols(&quot;codes&quot; = codes, &quot;questions&quot; = questions)</span>
<span id="cb161-60"><a href="data-products-1.html#cb161-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-61"><a href="data-products-1.html#cb161-61" aria-hidden="true" tabindex="-1"></a>datatable(lookup)</span>
<span id="cb161-62"><a href="data-products-1.html#cb161-62" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-63"><a href="data-products-1.html#cb161-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-64"><a href="data-products-1.html#cb161-64" aria-hidden="true" tabindex="-1"></a>Finally, we replace the question names in the dataset by the code:</span>
<span id="cb161-65"><a href="data-products-1.html#cb161-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-66"><a href="data-products-1.html#cb161-66" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-67"><a href="data-products-1.html#cb161-67" aria-hidden="true" tabindex="-1"></a>colnames(survey_data) &lt;- codes</span>
<span id="cb161-68"><a href="data-products-1.html#cb161-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-69"><a href="data-products-1.html#cb161-69" aria-hidden="true" tabindex="-1"></a>datatable(survey_data)</span>
<span id="cb161-70"><a href="data-products-1.html#cb161-70" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-71"><a href="data-products-1.html#cb161-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-72"><a href="data-products-1.html#cb161-72" aria-hidden="true" tabindex="-1"></a>Now, we define a function that creates a frequency table. This function has</span>
<span id="cb161-73"><a href="data-products-1.html#cb161-73" aria-hidden="true" tabindex="-1"></a>two arguments: `dataset` and `var`. It uses the `dplyr::count()` function to</span>
<span id="cb161-74"><a href="data-products-1.html#cb161-74" aria-hidden="true" tabindex="-1"></a>count each instance of the levels of `var` in `dataset`. Then it uses the </span>
<span id="cb161-75"><a href="data-products-1.html#cb161-75" aria-hidden="true" tabindex="-1"></a>`knitr::kable()` function. This functions takes a data frame as an argument</span>
<span id="cb161-76"><a href="data-products-1.html#cb161-76" aria-hidden="true" tabindex="-1"></a>and returns a table formatted in markdown code:</span>
<span id="cb161-77"><a href="data-products-1.html#cb161-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-78"><a href="data-products-1.html#cb161-78" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-79"><a href="data-products-1.html#cb161-79" aria-hidden="true" tabindex="-1"></a>create_table &lt;- function(dataset, var){</span>
<span id="cb161-80"><a href="data-products-1.html#cb161-80" aria-hidden="true" tabindex="-1"></a>  dataset %&gt;%</span>
<span id="cb161-81"><a href="data-products-1.html#cb161-81" aria-hidden="true" tabindex="-1"></a>    count(!!var) %&gt;%</span>
<span id="cb161-82"><a href="data-products-1.html#cb161-82" aria-hidden="true" tabindex="-1"></a>    knitr::kable()</span>
<span id="cb161-83"><a href="data-products-1.html#cb161-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb161-84"><a href="data-products-1.html#cb161-84" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-85"><a href="data-products-1.html#cb161-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-86"><a href="data-products-1.html#cb161-86" aria-hidden="true" tabindex="-1"></a>The next function is the one that does the magic: it takes only one argument</span>
<span id="cb161-87"><a href="data-products-1.html#cb161-87" aria-hidden="true" tabindex="-1"></a>as an input, and generates valid markdown code using the `knitr::knit_expand()`</span>
<span id="cb161-88"><a href="data-products-1.html#cb161-88" aria-hidden="true" tabindex="-1"></a>function. Any variable between `{{}}` gets replaced by its value (so </span>
<span id="cb161-89"><a href="data-products-1.html#cb161-89" aria-hidden="true" tabindex="-1"></a>`{{question}}` gets replaced by the question that gets fetched from the </span>
<span id="cb161-90"><a href="data-products-1.html#cb161-90" aria-hidden="true" tabindex="-1"></a>lookup table defined above). Using this function, we can now loop over </span>
<span id="cb161-91"><a href="data-products-1.html#cb161-91" aria-hidden="true" tabindex="-1"></a>question codes, and what we get in return is valid markdown code that defines</span>
<span id="cb161-92"><a href="data-products-1.html#cb161-92" aria-hidden="true" tabindex="-1"></a>a section with the question as the title, and our table.</span>
<span id="cb161-93"><a href="data-products-1.html#cb161-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-94"><a href="data-products-1.html#cb161-94" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-95"><a href="data-products-1.html#cb161-95" aria-hidden="true" tabindex="-1"></a>return_section &lt;- function(var){</span>
<span id="cb161-96"><a href="data-products-1.html#cb161-96" aria-hidden="true" tabindex="-1"></a>  a &lt;- knitr::knit_expand(text = c(&quot;## {{question}}&quot;,   create_table(survey_data, var)),</span>
<span id="cb161-97"><a href="data-products-1.html#cb161-97" aria-hidden="true" tabindex="-1"></a>                          question = lookup$questions[grepl(quo_name(var), lookup$codes)])</span>
<span id="cb161-98"><a href="data-products-1.html#cb161-98" aria-hidden="true" tabindex="-1"></a>  cat(a, sep = &quot;\n&quot;)</span>
<span id="cb161-99"><a href="data-products-1.html#cb161-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb161-100"><a href="data-products-1.html#cb161-100" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-101"><a href="data-products-1.html#cb161-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-102"><a href="data-products-1.html#cb161-102" aria-hidden="true" tabindex="-1"></a>Our codes are strings, so to be able to use them inside of `dplyr::count()`</span>
<span id="cb161-103"><a href="data-products-1.html#cb161-103" aria-hidden="true" tabindex="-1"></a>we need to define them as bare string, or symbols. This can be done using the</span>
<span id="cb161-104"><a href="data-products-1.html#cb161-104" aria-hidden="true" tabindex="-1"></a>`rlang::sym()` function. If this is confusing, try running `count(mtcars, &quot;am&quot;)` </span>
<span id="cb161-105"><a href="data-products-1.html#cb161-105" aria-hidden="true" tabindex="-1"></a>and you will see that it will not return what you want (compare to `count(mtcars, am)`). </span>
<span id="cb161-106"><a href="data-products-1.html#cb161-106" aria-hidden="true" tabindex="-1"></a>This is also why we needed `rlang::quo_name()` in the function above, to convert</span>
<span id="cb161-107"><a href="data-products-1.html#cb161-107" aria-hidden="true" tabindex="-1"></a>the symbol back to a string, which is what `grepl()` requires:</span>
<span id="cb161-108"><a href="data-products-1.html#cb161-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-109"><a href="data-products-1.html#cb161-109" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb161-110"><a href="data-products-1.html#cb161-110" aria-hidden="true" tabindex="-1"></a>sym_codes &lt;- map(codes, sym)</span>
<span id="cb161-111"><a href="data-products-1.html#cb161-111" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb161-112"><a href="data-products-1.html#cb161-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-113"><a href="data-products-1.html#cb161-113" aria-hidden="true" tabindex="-1"></a>Finally, we can create the sections. The line below uses `purrr::walk()`, which</span>
<span id="cb161-114"><a href="data-products-1.html#cb161-114" aria-hidden="true" tabindex="-1"></a>is equivalent to `purrr::map()`, the difference being that we use `purrr::walk()`</span>
<span id="cb161-115"><a href="data-products-1.html#cb161-115" aria-hidden="true" tabindex="-1"></a>when we are interested in the side effects of a function:</span>
<span id="cb161-116"><a href="data-products-1.html#cb161-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-117"><a href="data-products-1.html#cb161-117" aria-hidden="true" tabindex="-1"></a>```{r, results=&quot;asis&quot;}</span>
<span id="cb161-118"><a href="data-products-1.html#cb161-118" aria-hidden="true" tabindex="-1"></a>walk(sym_codes, return_section)</span>
<span id="cb161-119"><a href="data-products-1.html#cb161-119" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://startling-shortbread-bc36ea.netlify.app/">This is what the output looks like.</a>.</p>
</div>
</div>
<div id="other-output-formats" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Other output formats<a href="data-products-1.html#other-output-formats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="word" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Word<a href="data-products-1.html#word" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s now generate a Word document using Quarto. As you will see, this will be quite easy; but keep in mind that the basic
interactivity that we have seen with HTML outputs won’t be possible here (but templating will work). Render the following
source file to get back a <code>.docx</code> document (you don’t even need to have MS Word installed for it to work), and
take of what we changed from the previous file:</p>
<ul>
<li>Output changed from <code>html</code> to <code>docx</code>;</li>
<li>No more <code>{DT}</code>, but <code>{pander}</code> instead to generated <code>.docx</code> tables</li>
</ul>
<p>Here is the file:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb162-1"><a href="data-products-1.html#cb162-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb162-2"><a href="data-products-1.html#cb162-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Templating with Quarto&quot;</span>
<span id="cb162-3"><a href="data-products-1.html#cb162-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb162-4"><a href="data-products-1.html#cb162-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb162-5"><a href="data-products-1.html#cb162-5" aria-hidden="true" tabindex="-1"></a>format: docx</span>
<span id="cb162-6"><a href="data-products-1.html#cb162-6" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb162-7"><a href="data-products-1.html#cb162-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-8"><a href="data-products-1.html#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="data-products-1.html#cb162-9" aria-hidden="true" tabindex="-1"></a># Set up</span>
<span id="cb162-10"><a href="data-products-1.html#cb162-10" aria-hidden="true" tabindex="-1"></a>The goal is to have a frequency table for each question in a survey. But we</span>
<span id="cb162-11"><a href="data-products-1.html#cb162-11" aria-hidden="true" tabindex="-1"></a>do not want to have to do it by hand, so we define a function to create a </span>
<span id="cb162-12"><a href="data-products-1.html#cb162-12" aria-hidden="true" tabindex="-1"></a>table, and then, using the templating capabilities of Quarto, write some</span>
<span id="cb162-13"><a href="data-products-1.html#cb162-13" aria-hidden="true" tabindex="-1"></a>code to generate valid qmarkdown code. In the example below our survey only</span>
<span id="cb162-14"><a href="data-products-1.html#cb162-14" aria-hidden="true" tabindex="-1"></a>has 4 questions, but the solution described trivially scales to an infinity</span>
<span id="cb162-15"><a href="data-products-1.html#cb162-15" aria-hidden="true" tabindex="-1"></a>of questions. This is not the case if you’re solving this problem by hand.</span>
<span id="cb162-16"><a href="data-products-1.html#cb162-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-17"><a href="data-products-1.html#cb162-17" aria-hidden="true" tabindex="-1"></a>Start by loading the data and defining some needed variables:</span>
<span id="cb162-18"><a href="data-products-1.html#cb162-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-19"><a href="data-products-1.html#cb162-19" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-20"><a href="data-products-1.html#cb162-20" aria-hidden="true" tabindex="-1"></a>#| warning: false</span>
<span id="cb162-21"><a href="data-products-1.html#cb162-21" aria-hidden="true" tabindex="-1"></a>library(lubridate)</span>
<span id="cb162-22"><a href="data-products-1.html#cb162-22" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb162-23"><a href="data-products-1.html#cb162-23" aria-hidden="true" tabindex="-1"></a>library(purrr)</span>
<span id="cb162-24"><a href="data-products-1.html#cb162-24" aria-hidden="true" tabindex="-1"></a>library(pander)</span>
<span id="cb162-25"><a href="data-products-1.html#cb162-25" aria-hidden="true" tabindex="-1"></a>library(rlang)</span>
<span id="cb162-26"><a href="data-products-1.html#cb162-26" aria-hidden="true" tabindex="-1"></a>survey_data &lt;- read.csv(</span>
<span id="cb162-27"><a href="data-products-1.html#cb162-27" aria-hidden="true" tabindex="-1"></a>&quot;https://gist.githubusercontent.com/b-rodrigues/0c2249dec5a9c9477e0d1ad9964a1340/raw/873bcc7532b8bad613235f029884df1d0b947c90/survey_example.csv&quot;</span>
<span id="cb162-28"><a href="data-products-1.html#cb162-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb162-29"><a href="data-products-1.html#cb162-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-30"><a href="data-products-1.html#cb162-30" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-31"><a href="data-products-1.html#cb162-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-32"><a href="data-products-1.html#cb162-32" aria-hidden="true" tabindex="-1"></a>Let’s take a look at the data:</span>
<span id="cb162-33"><a href="data-products-1.html#cb162-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-34"><a href="data-products-1.html#cb162-34" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-35"><a href="data-products-1.html#cb162-35" aria-hidden="true" tabindex="-1"></a>pander(head(survey_data))</span>
<span id="cb162-36"><a href="data-products-1.html#cb162-36" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-37"><a href="data-products-1.html#cb162-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-38"><a href="data-products-1.html#cb162-38" aria-hidden="true" tabindex="-1"></a>The column names are actually questions, so we save those in a variable:</span>
<span id="cb162-39"><a href="data-products-1.html#cb162-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-40"><a href="data-products-1.html#cb162-40" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-41"><a href="data-products-1.html#cb162-41" aria-hidden="true" tabindex="-1"></a>questions &lt;- colnames(survey_data)</span>
<span id="cb162-42"><a href="data-products-1.html#cb162-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-43"><a href="data-products-1.html#cb162-43" aria-hidden="true" tabindex="-1"></a>questions</span>
<span id="cb162-44"><a href="data-products-1.html#cb162-44" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-45"><a href="data-products-1.html#cb162-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-46"><a href="data-products-1.html#cb162-46" aria-hidden="true" tabindex="-1"></a>Now we define question codes:</span>
<span id="cb162-47"><a href="data-products-1.html#cb162-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-48"><a href="data-products-1.html#cb162-48" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-49"><a href="data-products-1.html#cb162-49" aria-hidden="true" tabindex="-1"></a>codes &lt;- paste0(&quot;var_&quot;, seq(1, 4))</span>
<span id="cb162-50"><a href="data-products-1.html#cb162-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-51"><a href="data-products-1.html#cb162-51" aria-hidden="true" tabindex="-1"></a>codes</span>
<span id="cb162-52"><a href="data-products-1.html#cb162-52" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-53"><a href="data-products-1.html#cb162-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-54"><a href="data-products-1.html#cb162-54" aria-hidden="true" tabindex="-1"></a>We create a lookup table that links questions to their codes:</span>
<span id="cb162-55"><a href="data-products-1.html#cb162-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-56"><a href="data-products-1.html#cb162-56" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-57"><a href="data-products-1.html#cb162-57" aria-hidden="true" tabindex="-1"></a>lookup &lt;- bind_cols(&quot;codes&quot; = codes, &quot;questions&quot; = questions)</span>
<span id="cb162-58"><a href="data-products-1.html#cb162-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-59"><a href="data-products-1.html#cb162-59" aria-hidden="true" tabindex="-1"></a>pander(lookup)</span>
<span id="cb162-60"><a href="data-products-1.html#cb162-60" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-61"><a href="data-products-1.html#cb162-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-62"><a href="data-products-1.html#cb162-62" aria-hidden="true" tabindex="-1"></a>Finally, we replace the question names in the dataset by the code:</span>
<span id="cb162-63"><a href="data-products-1.html#cb162-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-64"><a href="data-products-1.html#cb162-64" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-65"><a href="data-products-1.html#cb162-65" aria-hidden="true" tabindex="-1"></a>colnames(survey_data) &lt;- codes</span>
<span id="cb162-66"><a href="data-products-1.html#cb162-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-67"><a href="data-products-1.html#cb162-67" aria-hidden="true" tabindex="-1"></a>pander(survey_data)</span>
<span id="cb162-68"><a href="data-products-1.html#cb162-68" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-69"><a href="data-products-1.html#cb162-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-70"><a href="data-products-1.html#cb162-70" aria-hidden="true" tabindex="-1"></a>Now, we define a function that creates a frequency table. This function has</span>
<span id="cb162-71"><a href="data-products-1.html#cb162-71" aria-hidden="true" tabindex="-1"></a>two arguments: `dataset` and `var`. It uses the `dplyr::count()` function to</span>
<span id="cb162-72"><a href="data-products-1.html#cb162-72" aria-hidden="true" tabindex="-1"></a>count each instance of the levels of `var` in `dataset`. Then it uses the </span>
<span id="cb162-73"><a href="data-products-1.html#cb162-73" aria-hidden="true" tabindex="-1"></a>`knitr::kable()` function. This functions takes a data frame as an argument</span>
<span id="cb162-74"><a href="data-products-1.html#cb162-74" aria-hidden="true" tabindex="-1"></a>and returns a table formatted in markdown code:</span>
<span id="cb162-75"><a href="data-products-1.html#cb162-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-76"><a href="data-products-1.html#cb162-76" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-77"><a href="data-products-1.html#cb162-77" aria-hidden="true" tabindex="-1"></a>create_table &lt;- function(dataset, var){</span>
<span id="cb162-78"><a href="data-products-1.html#cb162-78" aria-hidden="true" tabindex="-1"></a>  dataset %&gt;%</span>
<span id="cb162-79"><a href="data-products-1.html#cb162-79" aria-hidden="true" tabindex="-1"></a>    count(!!var) %&gt;%</span>
<span id="cb162-80"><a href="data-products-1.html#cb162-80" aria-hidden="true" tabindex="-1"></a>    knitr::kable()</span>
<span id="cb162-81"><a href="data-products-1.html#cb162-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-82"><a href="data-products-1.html#cb162-82" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-83"><a href="data-products-1.html#cb162-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-84"><a href="data-products-1.html#cb162-84" aria-hidden="true" tabindex="-1"></a>The next function is the one that does the magic: it takes only one argument</span>
<span id="cb162-85"><a href="data-products-1.html#cb162-85" aria-hidden="true" tabindex="-1"></a>as an input, and generates valid markdown code using the `knitr::knit_expand()`</span>
<span id="cb162-86"><a href="data-products-1.html#cb162-86" aria-hidden="true" tabindex="-1"></a>function. Any variable between `{{}}` gets replaced by its value (so </span>
<span id="cb162-87"><a href="data-products-1.html#cb162-87" aria-hidden="true" tabindex="-1"></a>`{{question}}` gets replaced by the question that gets fetched from the </span>
<span id="cb162-88"><a href="data-products-1.html#cb162-88" aria-hidden="true" tabindex="-1"></a>lookup table defined above). Using this function, we can now loop over </span>
<span id="cb162-89"><a href="data-products-1.html#cb162-89" aria-hidden="true" tabindex="-1"></a>question codes, and what we get in return is valid markdown code that defines</span>
<span id="cb162-90"><a href="data-products-1.html#cb162-90" aria-hidden="true" tabindex="-1"></a>a section with the question as the title, and our table.</span>
<span id="cb162-91"><a href="data-products-1.html#cb162-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-92"><a href="data-products-1.html#cb162-92" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-93"><a href="data-products-1.html#cb162-93" aria-hidden="true" tabindex="-1"></a>return_section &lt;- function(var){</span>
<span id="cb162-94"><a href="data-products-1.html#cb162-94" aria-hidden="true" tabindex="-1"></a>  a &lt;- knitr::knit_expand(text = c(&quot;## {{question}}&quot;,   create_table(survey_data, var)),</span>
<span id="cb162-95"><a href="data-products-1.html#cb162-95" aria-hidden="true" tabindex="-1"></a>                          question = lookup$questions[grepl(quo_name(var), lookup$codes)])</span>
<span id="cb162-96"><a href="data-products-1.html#cb162-96" aria-hidden="true" tabindex="-1"></a>  cat(a, sep = &quot;\n&quot;)</span>
<span id="cb162-97"><a href="data-products-1.html#cb162-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-98"><a href="data-products-1.html#cb162-98" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-99"><a href="data-products-1.html#cb162-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-100"><a href="data-products-1.html#cb162-100" aria-hidden="true" tabindex="-1"></a>Our codes are strings, so to be able to use them inside of `dplyr::count()`</span>
<span id="cb162-101"><a href="data-products-1.html#cb162-101" aria-hidden="true" tabindex="-1"></a>we need to define them as bare string, or symbols. This can be done using the</span>
<span id="cb162-102"><a href="data-products-1.html#cb162-102" aria-hidden="true" tabindex="-1"></a>`rlang::sym()` function. If this is confusing, try running `count(mtcars, &quot;am&quot;)` </span>
<span id="cb162-103"><a href="data-products-1.html#cb162-103" aria-hidden="true" tabindex="-1"></a>and you will see that it will not return what you want (compare to `count(mtcars, am)`). </span>
<span id="cb162-104"><a href="data-products-1.html#cb162-104" aria-hidden="true" tabindex="-1"></a>This is also why we needed `rlang::quo_name()` in the function above, to convert</span>
<span id="cb162-105"><a href="data-products-1.html#cb162-105" aria-hidden="true" tabindex="-1"></a>the symbol back to a string, which is what `grepl()` requires:</span>
<span id="cb162-106"><a href="data-products-1.html#cb162-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-107"><a href="data-products-1.html#cb162-107" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb162-108"><a href="data-products-1.html#cb162-108" aria-hidden="true" tabindex="-1"></a>sym_codes &lt;- map(codes, sym)</span>
<span id="cb162-109"><a href="data-products-1.html#cb162-109" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb162-110"><a href="data-products-1.html#cb162-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-111"><a href="data-products-1.html#cb162-111" aria-hidden="true" tabindex="-1"></a>Finally, we can create the sections. The line below uses `purrr::walk()`, which</span>
<span id="cb162-112"><a href="data-products-1.html#cb162-112" aria-hidden="true" tabindex="-1"></a>is equivalent to `purrr::map()`, the difference being that we use `purrr::walk()`</span>
<span id="cb162-113"><a href="data-products-1.html#cb162-113" aria-hidden="true" tabindex="-1"></a>when we are interested in the side effects of a function:</span>
<span id="cb162-114"><a href="data-products-1.html#cb162-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-115"><a href="data-products-1.html#cb162-115" aria-hidden="true" tabindex="-1"></a>```{r, results=&quot;asis&quot;}</span>
<span id="cb162-116"><a href="data-products-1.html#cb162-116" aria-hidden="true" tabindex="-1"></a>walk(sym_codes, return_section)</span>
<span id="cb162-117"><a href="data-products-1.html#cb162-117" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><a href="https://github.com/b-rodrigues/rap4mads/blob/master/img/ex10.docx?raw=true">You can download the output here.</a></p>
<p>Unlike with HTML outputs, it is also not possible to enable code folding, but you could hide the code completely using the “#| echo = false”
chunk option. If you wan to hide all the code without having to specify “#| echo = false” on each chunk you can also add the <code>execute</code> option
to the document header:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb163-1"><a href="data-products-1.html#cb163-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-2"><a href="data-products-1.html#cb163-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Templating with Quarto&quot;</span>
<span id="cb163-3"><a href="data-products-1.html#cb163-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb163-4"><a href="data-products-1.html#cb163-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb163-5"><a href="data-products-1.html#cb163-5" aria-hidden="true" tabindex="-1"></a>format: docx</span>
<span id="cb163-6"><a href="data-products-1.html#cb163-6" aria-hidden="true" tabindex="-1"></a>execute:</span>
<span id="cb163-7"><a href="data-products-1.html#cb163-7" aria-hidden="true" tabindex="-1"></a>  echo: false</span>
<span id="cb163-8"><a href="data-products-1.html#cb163-8" aria-hidden="true" tabindex="-1"></a>---</span></code></pre></div>
<p>You can use a document as a template for Word documents generated with Quarto. For this, you must create a new Word file, and update the
styles. This document, with the updated styles, can then be referenced in the header to act as a template:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb164-1"><a href="data-products-1.html#cb164-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb164-2"><a href="data-products-1.html#cb164-2" aria-hidden="true" tabindex="-1"></a>title: &quot;Using a custom Word style&quot;</span>
<span id="cb164-3"><a href="data-products-1.html#cb164-3" aria-hidden="true" tabindex="-1"></a>author: &quot;Bruno Rodrigues&quot;</span>
<span id="cb164-4"><a href="data-products-1.html#cb164-4" aria-hidden="true" tabindex="-1"></a>date: today</span>
<span id="cb164-5"><a href="data-products-1.html#cb164-5" aria-hidden="true" tabindex="-1"></a>format: </span>
<span id="cb164-6"><a href="data-products-1.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  docx: </span>
<span id="cb164-7"><a href="data-products-1.html#cb164-7" aria-hidden="true" tabindex="-1"></a>    reference-doc: fancy_template.docx</span>
<span id="cb164-8"><a href="data-products-1.html#cb164-8" aria-hidden="true" tabindex="-1"></a>execute:</span>
<span id="cb164-9"><a href="data-products-1.html#cb164-9" aria-hidden="true" tabindex="-1"></a>  echo: false</span>
<span id="cb164-10"><a href="data-products-1.html#cb164-10" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb164-11"><a href="data-products-1.html#cb164-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-12"><a href="data-products-1.html#cb164-12" aria-hidden="true" tabindex="-1"></a># Introduction</span>
<span id="cb164-13"><a href="data-products-1.html#cb164-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-14"><a href="data-products-1.html#cb164-14" aria-hidden="true" tabindex="-1"></a>## MS Word is great (lol)</span>
<span id="cb164-15"><a href="data-products-1.html#cb164-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-16"><a href="data-products-1.html#cb164-16" aria-hidden="true" tabindex="-1"></a>This is normal text that is unreadable.</span></code></pre></div>
<p>Just put <code>fancy_template.docx</code> in the same folder as your source qmd file. You can download the template I’ve used from
<a href="https://github.com/b-rodrigues/rap4mads/blob/master/img/fancy_template.docx?raw=true">here</a> to test things out.</p>
<p>For more details, visit this <a href="https://quarto.org/docs/output-formats/ms-word-templates.html">page</a>.</p>
</div>
<div id="presentations" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Presentations<a href="data-products-1.html#presentations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is also possible to create presentations using Quarto. There are output formats as well: HTML, PDF and Powerpoint. I will
not discuss this here, because it is quite easy to get started, simply <a href="https://quarto.org/docs/presentations/">follow along</a>.</p>
</div>
<div id="pdf" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> PDF<a href="data-products-1.html#pdf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I do need to discuss the PDF output a little bit. In order to generate PDF files, Quarto uses the <code>pdflatex</code> compiler (or rather
pandoc, called by Quarto, uses <code>pdflatex</code>). <code>pdflatex</code> compiles <code>.tex</code> source files to PDF, so what Quarto does (by leveraging pandoc)
is first converting a <code>.qmd</code> file to a <code>.tex</code> file, and then call <code>pdflatex</code> to compile it. <code>.tex</code> files are the file extension of the
Latex typesetting language, extensively used in science. It makes it easy to write complex mathematical formulas, like this one:</p>
<p><span class="math display">\[\begin{align*}
S(\omega)
&amp;= \frac{\alpha g^2}{\omega^5} e^{[ -0.74\bigl\{\frac{\omega U_\omega 19.5}{g}\bigr\}^{\!-4}\,]} \\
&amp;= \frac{\alpha g^2}{\omega^5} \exp\Bigl[ -0.74\Bigl\{\frac{\omega U_\omega 19.5}{g}\Bigr\}^{\!-4}\,\Bigr]
\end{align*}\]</span></p>
<p>Latex is a bit unwieldly, so using Markdown to write scientific documents is becoming more and more popular. However, Latex still
has an edge when it comes to tables. But thankfully, it is possible to simply embed the Latex code that produces these tables in Markdown,
and there are packages that export regression table directly to PDF. In any case, in order to compile to PDF, you need to install
Texlive. Installing Texlive is frankly a mess, but thankfully there is a very simple alternative called TinyTex. TinyTex is both
available as an R package or as a standalone installation, and was put together by the author of RMarkdown (in a sense, Quarto is
a spiritual successor to RMarkdown). This package installs a self-contained Texlive installation locally, which can then be used
to compile PDF documents (from, or outside of R/RStudio). I highly recommend you use Tinytex. Instructions can be found
<a href="https://yihui.org/tinytex/">here</a>. Once you’ve installed TinyTex, you can try to compile the following example document
(the first time you run this, it might take some time, as the required packages get installed):</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb165-1"><a href="data-products-1.html#cb165-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb165-2"><a href="data-products-1.html#cb165-2" aria-hidden="true" tabindex="-1"></a>title: &quot;PDF example with table&quot;</span>
<span id="cb165-3"><a href="data-products-1.html#cb165-3" aria-hidden="true" tabindex="-1"></a>format: pdf</span>
<span id="cb165-4"><a href="data-products-1.html#cb165-4" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb165-5"><a href="data-products-1.html#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="data-products-1.html#cb165-6" aria-hidden="true" tabindex="-1"></a>## A PDF document using Quarto</span>
<span id="cb165-7"><a href="data-products-1.html#cb165-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-8"><a href="data-products-1.html#cb165-8" aria-hidden="true" tabindex="-1"></a>In the code below, we fit several models and then use the `{modelsummary}`</span>
<span id="cb165-9"><a href="data-products-1.html#cb165-9" aria-hidden="true" tabindex="-1"></a>package to print a nicely formatted table with minimal effort:</span>
<span id="cb165-10"><a href="data-products-1.html#cb165-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-11"><a href="data-products-1.html#cb165-11" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb165-12"><a href="data-products-1.html#cb165-12" aria-hidden="true" tabindex="-1"></a>library(modelsummary)</span>
<span id="cb165-13"><a href="data-products-1.html#cb165-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-14"><a href="data-products-1.html#cb165-14" aria-hidden="true" tabindex="-1"></a>url &lt;- &#39;https://vincentarelbundock.github.io/Rdatasets/csv/HistData/Guerry.csv&#39;</span>
<span id="cb165-15"><a href="data-products-1.html#cb165-15" aria-hidden="true" tabindex="-1"></a>dat &lt;- read.csv(url)</span>
<span id="cb165-16"><a href="data-products-1.html#cb165-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-17"><a href="data-products-1.html#cb165-17" aria-hidden="true" tabindex="-1"></a>models &lt;- list(</span>
<span id="cb165-18"><a href="data-products-1.html#cb165-18" aria-hidden="true" tabindex="-1"></a>  &quot;OLS 1&quot;     = lm(Donations ~ Literacy + Clergy, data = dat),</span>
<span id="cb165-19"><a href="data-products-1.html#cb165-19" aria-hidden="true" tabindex="-1"></a>  &quot;Poisson 1&quot; = glm(Donations ~ Literacy + Commerce, family = poisson, data = dat),</span>
<span id="cb165-20"><a href="data-products-1.html#cb165-20" aria-hidden="true" tabindex="-1"></a>  &quot;OLS 2&quot;     = lm(Crime_pers ~ Literacy + Clergy, data = dat),</span>
<span id="cb165-21"><a href="data-products-1.html#cb165-21" aria-hidden="true" tabindex="-1"></a>  &quot;Poisson 2&quot; = glm(Crime_pers ~ Literacy + Commerce, family = poisson, data = dat),</span>
<span id="cb165-22"><a href="data-products-1.html#cb165-22" aria-hidden="true" tabindex="-1"></a>  &quot;OLS 3&quot;     = lm(Crime_prop ~ Literacy + Clergy, data = dat)</span>
<span id="cb165-23"><a href="data-products-1.html#cb165-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb165-24"><a href="data-products-1.html#cb165-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-25"><a href="data-products-1.html#cb165-25" aria-hidden="true" tabindex="-1"></a>modelsummary(models)</span>
<span id="cb165-26"><a href="data-products-1.html#cb165-26" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb165-27"><a href="data-products-1.html#cb165-27" aria-hidden="true" tabindex="-1"></a>And an equation, for good measure:</span>
<span id="cb165-28"><a href="data-products-1.html#cb165-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-29"><a href="data-products-1.html#cb165-29" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb165-30"><a href="data-products-1.html#cb165-30" aria-hidden="true" tabindex="-1"></a>S(\omega) </span>
<span id="cb165-31"><a href="data-products-1.html#cb165-31" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\alpha g^2}{\omega^5} e^{[ -0.74\bigl\{\frac{\omega U_\omega 19.5}{g}\bigr\}^{\!-4}\,]} \\</span>
<span id="cb165-32"><a href="data-products-1.html#cb165-32" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\alpha g^2}{\omega^5} \exp\Bigl[ -0.74\Bigl\{\frac{\omega U_\omega 19.5}{g}\Bigr\}^{\!-4}\,\Bigr] </span>
<span id="cb165-33"><a href="data-products-1.html#cb165-33" aria-hidden="true" tabindex="-1"></a>\end{align*}</span></code></pre></div>
<p><a href="https://github.com/b-rodrigues/rap4mads/blob/master/img/ex12.pdf?raw=TRUE">This is what the output looks like (scroll down to page 2).</a>.</p>
<p>It is possible to author, many, many, different types of documents using Quarto. For more formats, consult this
<a href="https://quarto.org/docs/gallery/">page</a>. Quarto is still very new – it was officially anounced in July of 2022 by Posit– so
much more content will arrive. There are still many features of Quarto that we have not explored, so take your time to read
its documentation in detail.</p>
</div>
</div>
<div id="interactive-web-applications-with-shiny" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Interactive web applications with {shiny}<a href="data-products-1.html#interactive-web-applications-with-shiny" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>{shiny}</code> is a package developed by Posit to build interactive web applications. These apps can be quite “simple”
(for example, an app that shows a graph but in which the user can choose the variable to plot), but can be arbitrarily
complex. Some people even go as far as make <a href="https://shiny.rstudio.com/gallery/hex-memory.html">games with {shiny}</a>.
<a href="https://shiny.rstudio.com/py/">A version for Python</a> is also in alpha, and you can already experiment with it.</p>
<p>In this section, I will give a very, very short introduction to <code>{shiny}</code>. This is because <code>{shiny}</code> is so feature-rich,
that I could spend 20 hours teaching you and even then we would not have seen everything. That being said, we can with
only some cursory knowledge build some useful apps. These apps can run locally on your machine, but they’re really only
useful if deploy them on a server, so that users can then use these web apps on their browsers.</p>
<div id="the-basic-structure-of-a-shiny-app" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> The basic structure of a Shiny app<a href="data-products-1.html#the-basic-structure-of-a-shiny-app" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Shiny apps are always made of at least 2 parts: a <em>server</em> and a <em>ui</em>. In general, each of these parts are in separate
scripts called <code>server.R</code> and <code>ui.R</code>. It is possible to have another script, called <code>global.R</code>, where you can define
variables that you want to be available for both the server and the ui, and to every user of your app.</p>
<p>Let’s start by building a very basic app. This app will allow users to visualize unemployment data for Luxembourg.
For now, let’s say that we want users only to be able to select communes, but not variables. The example code
below is based on this <a href="https://shiny.rstudio.com/gallery/telephones-by-region.html">official example</a>
(this is how I recommend you learn by the way. Take a look at the different example there are and adapt them
to suit your needs! You can find the examples <a href="https://shiny.rstudio.com/gallery/#demos">here</a>).
Create a folder called something like <code>my_app</code> and then create three scripts in it:</p>
<ul>
<li><code>global.R</code></li>
<li><code>server.R</code></li>
<li><code>ui.R</code></li>
</ul>
<p>Let’s start with <code>global.R</code>:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="data-products-1.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb166-2"><a href="data-products-1.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb166-3"><a href="data-products-1.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb166-4"><a href="data-products-1.html#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="data-products-1.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;unemp&quot;</span>)</span></code></pre></div>
<p>In the <code>global.R</code> file, we load the required packages and data. This is now available everywhere. Let’s
continue with the <code>server.R</code> script:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="data-products-1.html#cb167-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(session, input, output) {</span>
<span id="cb167-2"><a href="data-products-1.html#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="data-products-1.html#cb167-3" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>(</span>
<span id="cb167-4"><a href="data-products-1.html#cb167-4" aria-hidden="true" tabindex="-1"></a>    unemp <span class="sc">%&gt;%</span></span>
<span id="cb167-5"><a href="data-products-1.html#cb167-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(place_name <span class="sc">%in%</span> input<span class="sc">$</span>place_name_selected)</span>
<span id="cb167-6"><a href="data-products-1.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb167-7"><a href="data-products-1.html#cb167-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-8"><a href="data-products-1.html#cb167-8" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>unemp_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb167-9"><a href="data-products-1.html#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="data-products-1.html#cb167-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filtered_data</span>()) <span class="sc">+</span></span>
<span id="cb167-11"><a href="data-products-1.html#cb167-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb167-12"><a href="data-products-1.html#cb167-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(year, unemployment_rate_in_percent, <span class="at">color =</span> place_name)) <span class="sc">+</span></span>
<span id="cb167-13"><a href="data-products-1.html#cb167-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Unemployment in&quot;</span>, <span class="fu">paste</span>(input<span class="sc">$</span>place_name_selected, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)))</span>
<span id="cb167-14"><a href="data-products-1.html#cb167-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-15"><a href="data-products-1.html#cb167-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-16"><a href="data-products-1.html#cb167-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb167-17"><a href="data-products-1.html#cb167-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Several things need to be commented here: first, the script contains a single function, called
<code>server()</code>. This function take three arguments, <code>session</code>, <code>input</code> and <code>output</code>. I won’t go into
details here, but you should know that you will never call the <code>server()</code> function yourself, and
that these arguments are required so the function can… function. I will leave a reference at the
end of this section with more details. The next important thing is that we defined an object called
<code>filtered_data</code>. This is a reactive object. What this means is that this object should get
recomputed every time the user interacts with it. But how does the user interact with it? By
choosing the <code>place_name</code> he or she wants to see! The predicate inside <code>filter()</code> is <code>place_name %in% input$place_name_selected</code>. Where does that <code>input$place_name_selected</code> come from? This comes
from the <code>ui</code> (that we have not written yet). But the idea is that the user will be able to chose
place names from a list, and this list will be called <code>place_name_selected</code> and will contain the
place names that the user wants to see.</p>
<p>Finally, we define a new object called <code>output$unemp_plot</code>. The goal of the <code>server()</code> function is
to compute things that will be part of the <code>output</code> list. This list, and the objects it contains,
get then rendered in the <code>ui</code>. <code>unemp_plot</code> is a ggplot graph that uses the reactive data set
we defined first. Notice the <code>()</code> after <code>filtered_data</code> inside the ggplot call. These are required;
this is how we say that the reactive object must be recomputed. If the plot does not get rendered,
the reactive data set does not get computed, since it never gets called.</p>
<p>Ok so now to the ui. Let’s take inspiration from the same example again:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="data-products-1.html#cb168-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="cf">function</span>(request){</span>
<span id="cb168-2"><a href="data-products-1.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidPage</span>(</span>
<span id="cb168-3"><a href="data-products-1.html#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="data-products-1.html#cb168-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Unemployment in Luxembourg&quot;</span>),</span>
<span id="cb168-5"><a href="data-products-1.html#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="data-products-1.html#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb168-7"><a href="data-products-1.html#cb168-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-8"><a href="data-products-1.html#cb168-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb168-9"><a href="data-products-1.html#cb168-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;place_name_selected&quot;</span>, <span class="st">&quot;Select place:&quot;</span>,</span>
<span id="cb168-10"><a href="data-products-1.html#cb168-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">choices=</span><span class="fu">unique</span>(unemp<span class="sc">$</span>place_name),</span>
<span id="cb168-11"><a href="data-products-1.html#cb168-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb168-12"><a href="data-products-1.html#cb168-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;Rumelange&quot;</span>, <span class="st">&quot;Dudelange&quot;</span>),</span>
<span id="cb168-13"><a href="data-products-1.html#cb168-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb168-14"><a href="data-products-1.html#cb168-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plugins =</span> <span class="fu">list</span>(<span class="st">&quot;remove_button&quot;</span>),</span>
<span id="cb168-15"><a href="data-products-1.html#cb168-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">create =</span> <span class="cn">TRUE</span>,</span>
<span id="cb168-16"><a href="data-products-1.html#cb168-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">persist =</span> <span class="cn">FALSE</span> <span class="co"># keep created choices in dropdown</span></span>
<span id="cb168-17"><a href="data-products-1.html#cb168-17" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb168-18"><a href="data-products-1.html#cb168-18" aria-hidden="true" tabindex="-1"></a>                    ),</span>
<span id="cb168-19"><a href="data-products-1.html#cb168-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb168-20"><a href="data-products-1.html#cb168-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">helpText</span>(<span class="st">&quot;Original data from STATEC&quot;</span>)</span>
<span id="cb168-21"><a href="data-products-1.html#cb168-21" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb168-22"><a href="data-products-1.html#cb168-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-23"><a href="data-products-1.html#cb168-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb168-24"><a href="data-products-1.html#cb168-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plotOutput</span>(<span class="st">&quot;unemp_plot&quot;</span>)</span>
<span id="cb168-25"><a href="data-products-1.html#cb168-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb168-26"><a href="data-products-1.html#cb168-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb168-27"><a href="data-products-1.html#cb168-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-28"><a href="data-products-1.html#cb168-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-29"><a href="data-products-1.html#cb168-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I’ve added some useful things to the ui. First of all, I made it a function of an argument,
<code>request</code>. This is useful for bookmarking the state of the variable. We’ll add a bookmark button
later. The ui is divided into two parts, a sidebar panel, and a main panel. The sidebar panel is
where you will typically add dropdown menus, checkboxes, radio buttons, etc, for the users to make
various selections. In the main panel, you will show the result of their selections. In the sidebar
panel I add a <code>selectizeInput()</code> to create a dynamic dropdown list using the <code>selectize</code> JS
library, included with <code>{shiny}</code>. The available choices are all the unique place names contained in
our data, I allow users to select multiple place names, by default two communes are selected and
using the <code>options</code> argument I need little “remove” buttons in the selected commune names. Finally,
in the main panel I use the <code>plotOutput()</code> function to render the plot. Notice that I use the name
of the plot defined in the server, “unemp_plot”. Finally, to run this, add a new script, called
<code>app.R</code> and add the following line in it:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="data-products-1.html#cb169-1" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runApp</span>(<span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p>You can now run this script in RStudio, or from any R console, and this should open a web browser
with your app.</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/shiny_1.mp4" type="video/mp4">
</video>
</div>
<p>Believe it or not, but this app contains almost every ingredient you need to know to build shiny apps.
But of course, there are many, many other widgets that you can use to give your users even more
ways to interact with applications.</p>
</div>
<div id="slightly-more-advanced-shiny" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Slightly more advanced shiny<a href="data-products-1.html#slightly-more-advanced-shiny" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s take a look at another, more complex example. Because this second example is much more
complex, let’s first take a look at a video of the app in action:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/shiny_2.mp4" type="video/mp4">
</video>
</div>
<p>The global file will be almost the same as before:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="data-products-1.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(myPackage)</span>
<span id="cb170-2"><a href="data-products-1.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb170-3"><a href="data-products-1.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb170-4"><a href="data-products-1.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(g2r)</span>
<span id="cb170-5"><a href="data-products-1.html#cb170-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-6"><a href="data-products-1.html#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;unemp&quot;</span>)</span>
<span id="cb170-7"><a href="data-products-1.html#cb170-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-8"><a href="data-products-1.html#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="fu">enableBookmarking</span>(<span class="at">store =</span> <span class="st">&quot;url&quot;</span>)</span></code></pre></div>
<p>The only difference is that I load the <code>{g2r}</code> package to create a nice interactive plot, and enable
bookmarking of the state of the app using <code>enableBookmarking(store = "url")</code>. Let’s move on to the ui:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="data-products-1.html#cb171-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="cf">function</span>(request){</span>
<span id="cb171-2"><a href="data-products-1.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidPage</span>(</span>
<span id="cb171-3"><a href="data-products-1.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="data-products-1.html#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Unemployment in Luxembourg&quot;</span>),</span>
<span id="cb171-5"><a href="data-products-1.html#cb171-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-6"><a href="data-products-1.html#cb171-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb171-7"><a href="data-products-1.html#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="data-products-1.html#cb171-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb171-9"><a href="data-products-1.html#cb171-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;place_name_selected&quot;</span>, <span class="st">&quot;Select place:&quot;</span>,</span>
<span id="cb171-10"><a href="data-products-1.html#cb171-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices=</span><span class="fu">unique</span>(unemp<span class="sc">$</span>place_name),</span>
<span id="cb171-11"><a href="data-products-1.html#cb171-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb171-12"><a href="data-products-1.html#cb171-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;Rumelange&quot;</span>, <span class="st">&quot;Dudelange&quot;</span>),</span>
<span id="cb171-13"><a href="data-products-1.html#cb171-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb171-14"><a href="data-products-1.html#cb171-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plugins =</span> <span class="fu">list</span>(<span class="st">&quot;remove_button&quot;</span>),</span>
<span id="cb171-15"><a href="data-products-1.html#cb171-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">create =</span> <span class="cn">TRUE</span>,</span>
<span id="cb171-16"><a href="data-products-1.html#cb171-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">persist =</span> <span class="cn">FALSE</span> <span class="co"># keep created choices in dropdown</span></span>
<span id="cb171-17"><a href="data-products-1.html#cb171-17" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb171-18"><a href="data-products-1.html#cb171-18" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb171-19"><a href="data-products-1.html#cb171-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb171-20"><a href="data-products-1.html#cb171-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To allow users to select the variable, we add a selectInput</span></span>
<span id="cb171-21"><a href="data-products-1.html#cb171-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># (not selectizeInput, like above)</span></span>
<span id="cb171-22"><a href="data-products-1.html#cb171-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># don’t forget to use input$variable_selected in the</span></span>
<span id="cb171-23"><a href="data-products-1.html#cb171-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># server function later!</span></span>
<span id="cb171-24"><a href="data-products-1.html#cb171-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectInput</span>(<span class="st">&quot;variable_selected&quot;</span>, <span class="st">&quot;Select variable to plot:&quot;</span>,</span>
<span id="cb171-25"><a href="data-products-1.html#cb171-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices =</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(<span class="fu">colnames</span>(unemp)), <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;place_name&quot;</span>, <span class="st">&quot;level&quot;</span>)),</span>
<span id="cb171-26"><a href="data-products-1.html#cb171-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">FALSE</span>,</span>
<span id="cb171-27"><a href="data-products-1.html#cb171-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="st">&quot;unemployment_rate_in_percent&quot;</span>,</span>
<span id="cb171-28"><a href="data-products-1.html#cb171-28" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb171-29"><a href="data-products-1.html#cb171-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb171-30"><a href="data-products-1.html#cb171-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Just for illustration purposes, these radioButtons will not be bound</span></span>
<span id="cb171-31"><a href="data-products-1.html#cb171-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to the actionButton.</span></span>
<span id="cb171-32"><a href="data-products-1.html#cb171-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;legend_position&quot;</span>,</span>
<span id="cb171-33"><a href="data-products-1.html#cb171-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">&quot;Choose legend position&quot;</span>,</span>
<span id="cb171-34"><a href="data-products-1.html#cb171-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;top&quot;</span>, <span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="st">&quot;right&quot;</span>),</span>
<span id="cb171-35"><a href="data-products-1.html#cb171-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">selected =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb171-36"><a href="data-products-1.html#cb171-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inline =</span> <span class="cn">TRUE</span>),</span>
<span id="cb171-37"><a href="data-products-1.html#cb171-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb171-38"><a href="data-products-1.html#cb171-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">&quot;render_plot&quot;</span>,</span>
<span id="cb171-39"><a href="data-products-1.html#cb171-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">&quot;Click here to generate plot&quot;</span>),</span>
<span id="cb171-40"><a href="data-products-1.html#cb171-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb171-41"><a href="data-products-1.html#cb171-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">helpText</span>(<span class="st">&quot;Original data from STATEC&quot;</span>),</span>
<span id="cb171-42"><a href="data-products-1.html#cb171-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb171-43"><a href="data-products-1.html#cb171-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bookmarkButton</span>()</span>
<span id="cb171-44"><a href="data-products-1.html#cb171-44" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb171-45"><a href="data-products-1.html#cb171-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-46"><a href="data-products-1.html#cb171-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb171-47"><a href="data-products-1.html#cb171-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We add a tabsetPanel with two tabs. The first tab show</span></span>
<span id="cb171-48"><a href="data-products-1.html#cb171-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the plot made using ggplot the second tab</span></span>
<span id="cb171-49"><a href="data-products-1.html#cb171-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shows the plot using g2r</span></span>
<span id="cb171-50"><a href="data-products-1.html#cb171-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabsetPanel</span>(</span>
<span id="cb171-51"><a href="data-products-1.html#cb171-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabPanel</span>(<span class="st">&quot;ggplot version&quot;</span>, <span class="fu">plotOutput</span>(<span class="st">&quot;unemp_plot&quot;</span>)),</span>
<span id="cb171-52"><a href="data-products-1.html#cb171-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabPanel</span>(<span class="st">&quot;g2r version&quot;</span>, <span class="fu">g2Output</span>(<span class="st">&quot;unemp_plot_g2r&quot;</span>))</span>
<span id="cb171-53"><a href="data-products-1.html#cb171-53" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb171-54"><a href="data-products-1.html#cb171-54" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb171-55"><a href="data-products-1.html#cb171-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb171-56"><a href="data-products-1.html#cb171-56" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb171-57"><a href="data-products-1.html#cb171-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-58"><a href="data-products-1.html#cb171-58" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>There are many new things. Everything is explained in the comments within the script itself so take
a look at them. What’s important to notice, is that I now added two buttons, an action button, and
a bookmark button. The action button will be used to draw the plots. This means that the user will
choose the options for the plot, and then the plot will only appear once the user clicks on the button.
This is quite useful in cases where computations take time to run, and you don’t want the every reactive
object to get recomputed as soon as the user interacts with the app. This way, only once every selection
has been made can the user give the green light to the app to compute everything.</p>
<p>At the bottom of the ui you’ll see that I’ve added a <code>tabsetPanel()</code> with some <code>tabPanel()</code>s. This
is where the graphs “live”. Let’s move on to the server script:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="data-products-1.html#cb172-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(session, input, output) {</span>
<span id="cb172-2"><a href="data-products-1.html#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="data-products-1.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because I want the plots to only render once the user clicks the </span></span>
<span id="cb172-4"><a href="data-products-1.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># actionButton, I need to move every interactive, or reactive, element into</span></span>
<span id="cb172-5"><a href="data-products-1.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># an eventReactive() function. eventReactive() waits for something to &quot;happen&quot;</span></span>
<span id="cb172-6"><a href="data-products-1.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in order to let the reactive variables run. If you don’t do that, then</span></span>
<span id="cb172-7"><a href="data-products-1.html#cb172-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when the user interacts with app, these reactive variables will run</span></span>
<span id="cb172-8"><a href="data-products-1.html#cb172-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># which we do not want.</span></span>
<span id="cb172-9"><a href="data-products-1.html#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="data-products-1.html#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data only gets filtered once the user clicks on the actionButton</span></span>
<span id="cb172-11"><a href="data-products-1.html#cb172-11" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">eventReactive</span>(input<span class="sc">$</span>render_plot, {</span>
<span id="cb172-12"><a href="data-products-1.html#cb172-12" aria-hidden="true" tabindex="-1"></a>    unemp <span class="sc">%&gt;%</span></span>
<span id="cb172-13"><a href="data-products-1.html#cb172-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(place_name <span class="sc">%in%</span> input<span class="sc">$</span>place_name_selected)</span>
<span id="cb172-14"><a href="data-products-1.html#cb172-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb172-15"><a href="data-products-1.html#cb172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-16"><a href="data-products-1.html#cb172-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-17"><a href="data-products-1.html#cb172-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The variable the user selects gets passed down to the plot only once the user</span></span>
<span id="cb172-18"><a href="data-products-1.html#cb172-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clicks on the actionButton.</span></span>
<span id="cb172-19"><a href="data-products-1.html#cb172-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If you don’t do this, what will happen is that the variable will then update the plot</span></span>
<span id="cb172-20"><a href="data-products-1.html#cb172-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># even when the user does not click on the actionButton</span></span>
<span id="cb172-21"><a href="data-products-1.html#cb172-21" aria-hidden="true" tabindex="-1"></a>  variable_selected <span class="ot">&lt;-</span> <span class="fu">eventReactive</span>(input<span class="sc">$</span>render_plot, {</span>
<span id="cb172-22"><a href="data-products-1.html#cb172-22" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>variable_selected</span>
<span id="cb172-23"><a href="data-products-1.html#cb172-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb172-24"><a href="data-products-1.html#cb172-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-25"><a href="data-products-1.html#cb172-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The plot title only gets generated once the user clicks on the actionButton</span></span>
<span id="cb172-26"><a href="data-products-1.html#cb172-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If you don’t do this, what will happen is that the title of the plot will get</span></span>
<span id="cb172-27"><a href="data-products-1.html#cb172-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># updated even when the user does not click on the actionButton</span></span>
<span id="cb172-28"><a href="data-products-1.html#cb172-28" aria-hidden="true" tabindex="-1"></a>  plot_title <span class="ot">&lt;-</span> <span class="fu">eventReactive</span>(input<span class="sc">$</span>render_plot, {</span>
<span id="cb172-29"><a href="data-products-1.html#cb172-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">variable_selected</span>(), <span class="st">&quot;for&quot;</span>, <span class="fu">paste</span>(input<span class="sc">$</span>place_name_selected, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>))</span>
<span id="cb172-30"><a href="data-products-1.html#cb172-30" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb172-31"><a href="data-products-1.html#cb172-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-32"><a href="data-products-1.html#cb172-32" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>unemp_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb172-33"><a href="data-products-1.html#cb172-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-34"><a href="data-products-1.html#cb172-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filtered_data</span>()) <span class="sc">+</span></span>
<span id="cb172-35"><a href="data-products-1.html#cb172-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb172-36"><a href="data-products-1.html#cb172-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Because the selected variable is a string, we need to convert it to a symbol</span></span>
<span id="cb172-37"><a href="data-products-1.html#cb172-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># using rlang::sym and evaluate it using !!. This is because the aes() function</span></span>
<span id="cb172-38"><a href="data-products-1.html#cb172-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># expects bare variable names, and not strings.</span></span>
<span id="cb172-39"><a href="data-products-1.html#cb172-39" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Because this is something that developers have to use often in shiny apps,</span></span>
<span id="cb172-40"><a href="data-products-1.html#cb172-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># there is a version of aes() that works with strings, called aes_string()</span></span>
<span id="cb172-41"><a href="data-products-1.html#cb172-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># You can use both approaches interchangeably.</span></span>
<span id="cb172-42"><a href="data-products-1.html#cb172-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">#geom_line(aes(year, !!rlang::sym(variable_selected()), color = place_name)) +</span></span>
<span id="cb172-43"><a href="data-products-1.html#cb172-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="st">&quot;year&quot;</span>, <span class="fu">variable_selected</span>(), <span class="at">color =</span> <span class="st">&quot;place_name&quot;</span>)) <span class="sc">+</span></span>
<span id="cb172-44"><a href="data-products-1.html#cb172-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">plot_title</span>()) <span class="sc">+</span></span>
<span id="cb172-45"><a href="data-products-1.html#cb172-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> input<span class="sc">$</span>legend_position)</span>
<span id="cb172-46"><a href="data-products-1.html#cb172-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-47"><a href="data-products-1.html#cb172-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-48"><a href="data-products-1.html#cb172-48" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb172-49"><a href="data-products-1.html#cb172-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-50"><a href="data-products-1.html#cb172-50" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>unemp_plot_g2r <span class="ot">&lt;-</span> <span class="fu">renderG2</span>({</span>
<span id="cb172-51"><a href="data-products-1.html#cb172-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-52"><a href="data-products-1.html#cb172-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">g2</span>(<span class="at">data =</span> <span class="fu">filtered_data</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb172-53"><a href="data-products-1.html#cb172-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># g2r’s asp() requires bare variable names</span></span>
<span id="cb172-54"><a href="data-products-1.html#cb172-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fig_line</span>(<span class="fu">asp</span>(year, <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(<span class="fu">variable_selected</span>()), <span class="at">color =</span> place_name)) <span class="sc">%&gt;%</span></span>
<span id="cb172-55"><a href="data-products-1.html#cb172-55" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For some reason, the title does not show...</span></span>
<span id="cb172-56"><a href="data-products-1.html#cb172-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">subject</span>(<span class="fu">plot_title</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb172-57"><a href="data-products-1.html#cb172-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">legend_color</span>(<span class="at">position =</span> input<span class="sc">$</span>legend_position)</span>
<span id="cb172-58"><a href="data-products-1.html#cb172-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-59"><a href="data-products-1.html#cb172-59" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb172-60"><a href="data-products-1.html#cb172-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>What’s new here, is that I now must redefine the reactive objects in such a way that they only get
run once the user clicks the button. This is why every reactive object (but one, the position of the
legend) is now wrapped by <code>eventReactive()</code>. <code>eventReactive()</code> waits for a trigger, in this case
the clicking of the action button, to run the reactive object. <code>eventReactive()</code> takes the action button
ID as an input. I’ve also defined the plot title as a reactive value, not only the dataset as before,
because if I didn’t do it, then the title of the plot would get updated as the user would choose
other communes, but the contents of the plot, that depend on the data, would not get updated. To avoid
the title and the plot to get desynched, I need to also wrap it around <code>eventReactive()</code>. You can see
this behaviour by changing the legend position. The legend position gets updated without the user needing
to click the button. This is because I have not wrapped the legend position inside <code>eventReactive()</code>.</p>
<p>Finally, I keep the <code>{ggplot2}</code> graph, but also remake it using <code>{g2r}</code>, to illustrate how it works
inside a Shiny app.</p>
<p>To conclude this section, we will take a look at one last app. This app will allow users to
do data aggregation on relatively large dataset, so computations will take some time. The app
will illustrate how to best deal with this.</p>
</div>
<div id="basic-optimization-of-shiny-apps" class="section level3 hasAnchor" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> Basic optimization of Shiny apps<a href="data-products-1.html#basic-optimization-of-shiny-apps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The app we will build now requires what is sometimes referred to <em>medium</em> size data. <em>Medium</em> size
data is data that is far from being big data, but already big enough that handling it requires
some thought, especially in this scenario. What we want to do is build an app that will allow
users to do some aggregations on this data. Because the size of the data is not trivial, these
computations will take some time to run. So we need to think about certain strategies to avoid
frustrating our users. The file we will be using can be downloaded from
<a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/HG7NV7">here</a>.
We’re not going to use the exact same data set though, I have prepared a smaller version that
will be more than enough for our purposes. But the strategies that we are going to implement
here will also work for the original, much larger, dataset. You can get the smaller version
<a href="https://mega.nz/file/l1IxHYIT#mZkeQOVpMc9XymMNtDY687sHEZHoIvDcUOm-4AwK6OI">here</a>.
Uncompressed it’ll be a 2.4GB file. Not big data in any sense, but big enough to be
annoying to handle without the use of some optimization strategies.</p>
<p>One such strategy is only letting the computations run once the user gives the green light by clicking
on an action button. This is what we have seen in the previous example. The next obvious strategy
is to use packages that are optimized for speed. It turns out that the functions we have seen
until now, from packages like <code>{dplyr}</code> and the like, are not the fastest. Their ease of use and
expressiveness come at a speed cost. So we will need to switch to something faster. We will do the same
to read in the data.</p>
<p>This faster solution is the <code>{arrow}</code> package, which is an interface to the <a href="https://arrow.apache.org/faq/">Arrow software developed by Apache</a>.</p>
<p>The final strategy is to enable caching in the app.</p>
<p>So first, install the <code>{arrow}</code> package by running <code>install.packages("arrow")</code>. This will compile
<code>libarrow</code> from source on Linux and might take some time, so perhaps go grab a coffee.</p>
<p>Before building the app, let me perform a very simple benchmark. The script below reads in the data,
then performs some aggregations. This is done using standard <code>{tidyverse}</code> functions, but also
using <code>{arrow}</code>:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="data-products-1.html#cb173-1" aria-hidden="true" tabindex="-1"></a>start_tidy <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb173-2"><a href="data-products-1.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># {vroom} is able to read in larger files than {readr}</span></span>
<span id="cb173-3"><a href="data-products-1.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I could not get this file into R using readr::read_csv</span></span>
<span id="cb173-4"><a href="data-products-1.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># my RAM would get maxed out</span></span>
<span id="cb173-5"><a href="data-products-1.html#cb173-5" aria-hidden="true" tabindex="-1"></a>  air <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">&quot;data/combined&quot;</span>)</span>
<span id="cb173-6"><a href="data-products-1.html#cb173-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-7"><a href="data-products-1.html#cb173-7" aria-hidden="true" tabindex="-1"></a>  mean_dep_delay <span class="ot">&lt;-</span> air <span class="sc">|&gt;</span></span>
<span id="cb173-8"><a href="data-products-1.html#cb173-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(Year, Month, DayofMonth) <span class="sc">|&gt;</span></span>
<span id="cb173-9"><a href="data-products-1.html#cb173-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(DepDelay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb173-10"><a href="data-products-1.html#cb173-10" aria-hidden="true" tabindex="-1"></a>end_tidy <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb173-11"><a href="data-products-1.html#cb173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-12"><a href="data-products-1.html#cb173-12" aria-hidden="true" tabindex="-1"></a>time_tidy <span class="ot">&lt;-</span> end_tidy <span class="sc">-</span> start_tidy</span>
<span id="cb173-13"><a href="data-products-1.html#cb173-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-14"><a href="data-products-1.html#cb173-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-15"><a href="data-products-1.html#cb173-15" aria-hidden="true" tabindex="-1"></a>start_arrow <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb173-16"><a href="data-products-1.html#cb173-16" aria-hidden="true" tabindex="-1"></a>  air <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">open_dataset</span>(<span class="st">&quot;data/combined&quot;</span>, <span class="at">format =</span> <span class="st">&quot;csv&quot;</span>)</span>
<span id="cb173-17"><a href="data-products-1.html#cb173-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-18"><a href="data-products-1.html#cb173-18" aria-hidden="true" tabindex="-1"></a>  mean_dep_delay <span class="ot">&lt;-</span> air <span class="sc">|&gt;</span></span>
<span id="cb173-19"><a href="data-products-1.html#cb173-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(Year, Month, DayofMonth) <span class="sc">|&gt;</span></span>
<span id="cb173-20"><a href="data-products-1.html#cb173-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(DepDelay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb173-21"><a href="data-products-1.html#cb173-21" aria-hidden="true" tabindex="-1"></a>end_arrow <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb173-22"><a href="data-products-1.html#cb173-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-23"><a href="data-products-1.html#cb173-23" aria-hidden="true" tabindex="-1"></a>end_tidy <span class="sc">-</span> start_tidy</span>
<span id="cb173-24"><a href="data-products-1.html#cb173-24" aria-hidden="true" tabindex="-1"></a>end_arrow <span class="sc">-</span> start_arrow</span></code></pre></div>
<p>The “tidy” approach took 17 seconds, while the arrow approach took 6 seconds. This is an impressive
improvement, but put yourself in the shoes of a user who has to wait 6 seconds for each query. That
would get very annoying, very quickly. So the other strategy that we will use is to provide some visual
cue that computations are running, and then we will go one step further and use caching of results
in the Shiny app.</p>
<p>But before we continue, you may be confused by the code above. After all, I told you before that
functions from <code>{dplyr}</code> and the like were not the fastest, and yet, I am using them in the arrow
approach as well, and they now run almost 3 times as fast. What’s going on? What’s happening here,
is that the <code>air</code> object that we read using <code>arrow::open_dataset</code> is not a dataframe, but an <code>arrow</code>
dataset. These are special, and work in a different way. But that’s not what’s important: what’s important
is that the <code>{dplyr}</code> api can be used to work with these <code>arrow</code> datasets. This means that functions
from <code>{dplyr}</code> change the way they work depending on the type of the object their dealing with.
If it’s a good old regular data frame, some C++ code gets called to perform the computations. If it’s
an <code>arrow</code> dataset, <code>libarrow</code> and its black magic get called instead to perform the computations.
If you’re familiar with the concept of
<a href="https://en.wikipedia.org/wiki/Polymorphism_(computer_science)">polymorphism</a> this is it
(think of <code>+</code> in Python: <code>1+1</code> returns <code>2</code>, <code>"a"+"b"</code> returns <code>"a+b"</code>. A different computation
gets performed depending on the type of the function’s inputs).</p>
<p>Let’s now build a basic version of the app, only
using <code>{arrow}</code> functions for speed. This is the global file:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="data-products-1.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb174-2"><a href="data-products-1.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb174-3"><a href="data-products-1.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb174-4"><a href="data-products-1.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb174-5"><a href="data-products-1.html#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="data-products-1.html#cb174-6" aria-hidden="true" tabindex="-1"></a>air <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">open_dataset</span>(<span class="st">&quot;data/combined&quot;</span>, <span class="at">format =</span> <span class="st">&quot;csv&quot;</span>)</span></code></pre></div>
<p>The ui will be quite simple:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="data-products-1.html#cb175-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="cf">function</span>(request){</span>
<span id="cb175-2"><a href="data-products-1.html#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidPage</span>(</span>
<span id="cb175-3"><a href="data-products-1.html#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="data-products-1.html#cb175-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Air On Time data&quot;</span>),</span>
<span id="cb175-5"><a href="data-products-1.html#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="data-products-1.html#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb175-7"><a href="data-products-1.html#cb175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-8"><a href="data-products-1.html#cb175-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb175-9"><a href="data-products-1.html#cb175-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;group_by_selected&quot;</span>, <span class="st">&quot;Variables to group by:&quot;</span>,</span>
<span id="cb175-10"><a href="data-products-1.html#cb175-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Month&quot;</span>, <span class="st">&quot;DayofMonth&quot;</span>, <span class="st">&quot;Origin&quot;</span>, <span class="st">&quot;Dest&quot;</span>),</span>
<span id="cb175-11"><a href="data-products-1.html#cb175-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb175-12"><a href="data-products-1.html#cb175-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Month&quot;</span>),</span>
<span id="cb175-13"><a href="data-products-1.html#cb175-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb175-14"><a href="data-products-1.html#cb175-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plugins =</span> <span class="fu">list</span>(<span class="st">&quot;remove_button&quot;</span>),</span>
<span id="cb175-15"><a href="data-products-1.html#cb175-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">create =</span> <span class="cn">TRUE</span>,</span>
<span id="cb175-16"><a href="data-products-1.html#cb175-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">persist =</span> <span class="cn">FALSE</span> <span class="co"># keep created choices in dropdown</span></span>
<span id="cb175-17"><a href="data-products-1.html#cb175-17" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb175-18"><a href="data-products-1.html#cb175-18" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb175-19"><a href="data-products-1.html#cb175-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb175-20"><a href="data-products-1.html#cb175-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;var_to_average&quot;</span>, <span class="st">&quot;Select variable to average by groups:&quot;</span>,</span>
<span id="cb175-21"><a href="data-products-1.html#cb175-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;ArrDelay&quot;</span>, <span class="st">&quot;DepDelay&quot;</span>, <span class="st">&quot;Distance&quot;</span>),</span>
<span id="cb175-22"><a href="data-products-1.html#cb175-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">FALSE</span>,</span>
<span id="cb175-23"><a href="data-products-1.html#cb175-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="st">&quot;DepDelay&quot;</span>,</span>
<span id="cb175-24"><a href="data-products-1.html#cb175-24" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb175-25"><a href="data-products-1.html#cb175-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb175-26"><a href="data-products-1.html#cb175-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">&quot;run_aggregation&quot;</span>,</span>
<span id="cb175-27"><a href="data-products-1.html#cb175-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">&quot;Click here to run aggregation&quot;</span>),</span>
<span id="cb175-28"><a href="data-products-1.html#cb175-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb175-29"><a href="data-products-1.html#cb175-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bookmarkButton</span>()</span>
<span id="cb175-30"><a href="data-products-1.html#cb175-30" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb175-31"><a href="data-products-1.html#cb175-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-32"><a href="data-products-1.html#cb175-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb175-33"><a href="data-products-1.html#cb175-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">DTOutput</span>(<span class="st">&quot;result&quot;</span>)</span>
<span id="cb175-34"><a href="data-products-1.html#cb175-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb175-35"><a href="data-products-1.html#cb175-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb175-36"><a href="data-products-1.html#cb175-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb175-37"><a href="data-products-1.html#cb175-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-38"><a href="data-products-1.html#cb175-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And finally the server:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="data-products-1.html#cb176-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(session, input, output) {</span>
<span id="cb176-2"><a href="data-products-1.html#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="data-products-1.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Numbers get crunched only when the user clicks on the action button</span></span>
<span id="cb176-4"><a href="data-products-1.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  grouped_data <span class="ot">&lt;-</span> <span class="fu">eventReactive</span>(input<span class="sc">$</span>run_aggregation, {</span>
<span id="cb176-5"><a href="data-products-1.html#cb176-5" aria-hidden="true" tabindex="-1"></a>    air <span class="sc">%&gt;%</span></span>
<span id="cb176-6"><a href="data-products-1.html#cb176-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(input<span class="sc">$</span>group_by_selected)) <span class="sc">%&gt;%</span></span>
<span id="cb176-7"><a href="data-products-1.html#cb176-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">result =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>var_to_average),</span>
<span id="cb176-8"><a href="data-products-1.html#cb176-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb176-9"><a href="data-products-1.html#cb176-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb176-10"><a href="data-products-1.html#cb176-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb176-11"><a href="data-products-1.html#cb176-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-12"><a href="data-products-1.html#cb176-12" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>result <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb176-13"><a href="data-products-1.html#cb176-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grouped_data</span>()</span>
<span id="cb176-14"><a href="data-products-1.html#cb176-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb176-15"><a href="data-products-1.html#cb176-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-16"><a href="data-products-1.html#cb176-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Because <code>group_by()</code> and <code>mean()</code> expect bare variable names, I convert them from strings to
symbols using <code>rlang::syms()</code> and <code>rlang::sym()</code>. The difference between the two is that
<code>rlang::syms()</code> is required when a list of strings gets passed down to the function (remember
that the user must select several variables to group by), and this is also why <code>!!!</code> are needed
(to unquote the list of symbols). Finally, the computed data must be converted back to a
data frame using <code>as.data.frame()</code>. This is actually when the computations happen. <code>{arrow}</code> collects
all the aggregations but does not perform anything until absolutely required. Let’s see the app
in action:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/shiny_3.mp4" type="video/mp4">
</video>
</div>
<p>As you can see, in terms of User Experience (UX) this is quite poor. When the user clicks on the button
nothing seems to be going on for several seconds, until the table appears. Then, when the user
changes some options and clicks again on the action button, it looks like the app is crashing.</p>
<p>Let’s add some visual cues to indicate to the user that something is happening when the button gets
clicked. For this, we are going to use the <code>{shinycssloaders}</code> package:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="data-products-1.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;shinycssloaders&quot;</span>)</span></code></pre></div>
<p>and simply change the ui to this (and don’t forget to load <code>{shinycssloaders}</code> in the global script!):</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="data-products-1.html#cb178-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="cf">function</span>(request){</span>
<span id="cb178-2"><a href="data-products-1.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidPage</span>(</span>
<span id="cb178-3"><a href="data-products-1.html#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="data-products-1.html#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Air On Time data&quot;</span>),</span>
<span id="cb178-5"><a href="data-products-1.html#cb178-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-6"><a href="data-products-1.html#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb178-7"><a href="data-products-1.html#cb178-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-8"><a href="data-products-1.html#cb178-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="cb178-9"><a href="data-products-1.html#cb178-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;group_by_selected&quot;</span>, <span class="st">&quot;Variables to group by:&quot;</span>,</span>
<span id="cb178-10"><a href="data-products-1.html#cb178-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Month&quot;</span>, <span class="st">&quot;DayofMonth&quot;</span>, <span class="st">&quot;Origin&quot;</span>, <span class="st">&quot;Dest&quot;</span>),</span>
<span id="cb178-11"><a href="data-products-1.html#cb178-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb178-12"><a href="data-products-1.html#cb178-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Month&quot;</span>),</span>
<span id="cb178-13"><a href="data-products-1.html#cb178-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb178-14"><a href="data-products-1.html#cb178-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plugins =</span> <span class="fu">list</span>(<span class="st">&quot;remove_button&quot;</span>),</span>
<span id="cb178-15"><a href="data-products-1.html#cb178-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">create =</span> <span class="cn">TRUE</span>,</span>
<span id="cb178-16"><a href="data-products-1.html#cb178-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">persist =</span> <span class="cn">FALSE</span> <span class="co"># keep created choices in dropdown</span></span>
<span id="cb178-17"><a href="data-products-1.html#cb178-17" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb178-18"><a href="data-products-1.html#cb178-18" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb178-19"><a href="data-products-1.html#cb178-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb178-20"><a href="data-products-1.html#cb178-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectizeInput</span>(<span class="st">&quot;var_to_average&quot;</span>, <span class="st">&quot;Select variable to average by groups:&quot;</span>,</span>
<span id="cb178-21"><a href="data-products-1.html#cb178-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;ArrDelay&quot;</span>, <span class="st">&quot;DepDelay&quot;</span>, <span class="st">&quot;Distance&quot;</span>),</span>
<span id="cb178-22"><a href="data-products-1.html#cb178-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiple =</span> <span class="cn">FALSE</span>,</span>
<span id="cb178-23"><a href="data-products-1.html#cb178-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">selected =</span> <span class="st">&quot;DepDelay&quot;</span>,</span>
<span id="cb178-24"><a href="data-products-1.html#cb178-24" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb178-25"><a href="data-products-1.html#cb178-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb178-26"><a href="data-products-1.html#cb178-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">&quot;run_aggregation&quot;</span>,</span>
<span id="cb178-27"><a href="data-products-1.html#cb178-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">&quot;Click here to run aggregation&quot;</span>),</span>
<span id="cb178-28"><a href="data-products-1.html#cb178-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hr</span>(),</span>
<span id="cb178-29"><a href="data-products-1.html#cb178-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bookmarkButton</span>()</span>
<span id="cb178-30"><a href="data-products-1.html#cb178-30" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb178-31"><a href="data-products-1.html#cb178-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-32"><a href="data-products-1.html#cb178-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<span id="cb178-33"><a href="data-products-1.html#cb178-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We add a tabsetPanel with two tabs. The first tab show the plot made using ggplot</span></span>
<span id="cb178-34"><a href="data-products-1.html#cb178-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the second tab shows the plot using g2r</span></span>
<span id="cb178-35"><a href="data-products-1.html#cb178-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">DTOutput</span>(<span class="st">&quot;result&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb178-36"><a href="data-products-1.html#cb178-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">withSpinner</span>()</span>
<span id="cb178-37"><a href="data-products-1.html#cb178-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb178-38"><a href="data-products-1.html#cb178-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb178-39"><a href="data-products-1.html#cb178-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb178-40"><a href="data-products-1.html#cb178-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-41"><a href="data-products-1.html#cb178-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The only difference with before is that now the <code>DTOutput()</code> right at the end gets passed down
to <code>withSpinner()</code>. There are several spinners that you can choose, but let’s simply use the
default one. This is how the app looks now:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/shiny_4.mp4" type="video/mp4">
</video>
</div>
<p>Now the user gets a visual cue that something is happening. This makes waiting more bearable,
but even better than waiting with a spinner is no waiting at all. For this, we are going to enable caching
of results. There are several ways that you can cache results inside your app. You can enable
the cache on a per-user and per-session basis, or only on a per-user basis. But I think that
in our case here, the ideal caching strategy is to keep the cache persistent, and available
across sessions. This means that each computation done by any user will get cached and available
to any other user. In order to achieve this, you simply have to install the <code>{cachem}</code> packages
add the following lines to the global script:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="data-products-1.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyOptions</span>(<span class="at">cache =</span> cachem<span class="sc">::</span><span class="fu">cache_disk</span>(<span class="st">&quot;./app-cache&quot;</span>,</span>
<span id="cb179-2"><a href="data-products-1.html#cb179-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">max_age =</span> <span class="cn">Inf</span>))</span></code></pre></div>
<p>By setting the <code>max_age</code> argument to <code>Inf</code>, the cache will never get pruned. The maximum size
of the cache, by default is 1GB. You can of course increase it.</p>
<p>Now, you must also edit the server file like so:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="data-products-1.html#cb180-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(session, input, output) {</span>
<span id="cb180-2"><a href="data-products-1.html#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="data-products-1.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Numbers get crunched only when the user clicks on the action button</span></span>
<span id="cb180-4"><a href="data-products-1.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  grouped_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb180-5"><a href="data-products-1.html#cb180-5" aria-hidden="true" tabindex="-1"></a>    air <span class="sc">%&gt;%</span></span>
<span id="cb180-6"><a href="data-products-1.html#cb180-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(input<span class="sc">$</span>group_by_selected)) <span class="sc">%&gt;%</span></span>
<span id="cb180-7"><a href="data-products-1.html#cb180-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">result =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(input<span class="sc">$</span>var_to_average),</span>
<span id="cb180-8"><a href="data-products-1.html#cb180-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb180-9"><a href="data-products-1.html#cb180-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb180-10"><a href="data-products-1.html#cb180-10" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb180-11"><a href="data-products-1.html#cb180-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bindCache</span>(input<span class="sc">$</span>group_by_selected,</span>
<span id="cb180-12"><a href="data-products-1.html#cb180-12" aria-hidden="true" tabindex="-1"></a>              input<span class="sc">$</span>var_to_average) <span class="sc">%&gt;%</span></span>
<span id="cb180-13"><a href="data-products-1.html#cb180-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>run_aggregation)</span>
<span id="cb180-14"><a href="data-products-1.html#cb180-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-15"><a href="data-products-1.html#cb180-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>result <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb180-16"><a href="data-products-1.html#cb180-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grouped_data</span>()</span>
<span id="cb180-17"><a href="data-products-1.html#cb180-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb180-18"><a href="data-products-1.html#cb180-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-19"><a href="data-products-1.html#cb180-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We’ve had to change <code>eventReactive()</code> to <code>reactive()</code>, just like in the app where we don’t use
an action button to run computations. Then, we pass the reactive object to <code>bindCache()</code>.
<code>bindCache()</code> also takes the <code>inputs</code>
as arguments. These are used to generate cache keys to retrieve the correct objects from cache.
Finally, we pass all this to <code>bindEvent()</code>. This function takes the input referencing the
action button. This is how we can now bind the computations to the button once again. Let’s
test our app now. You will notice that the first time we choose certain options, the computations
will take time, as before. But if we perform the same computations again, then the results will be shown
instantly:</p>
<div style="text-align:center;">
<video width="640" height="480" controls>
<source src="img/shiny_5.mp4" type="video/mp4">
</video>
</div>
<p>As you can see, once I go back to a computation that was done in the past, the table appears
instantly. At the end of the video I open a terminal and navigate to the directory of the app,
and show you the cache. There are several <code>.Rds</code> objects, these are the final data frames that
get computed by the app. If the user wants to rerun a previous computation, the correct data frame
gets retrieved, making it look like the computation happened instantly, and with another added
benefit: as discussed above, the cache is persistent between sessions, so even if the user
closes the browser and comes back later, the cache is still there, and other users will also
benefit from the cache.</p>
</div>
<div id="deploying-your-shiny-app" class="section level3 hasAnchor" number="8.4.4">
<h3><span class="header-section-number">8.4.4</span> Deploying your shiny app<a href="data-products-1.html#deploying-your-shiny-app" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The easiest way is certainly to use shinyapps.io. I won’t go into details, but you can read
more about it <a href="https://shiny.rstudio.com/articles/shinyapps.html">here</a>. You could also
get a Virtual Private Server on a website like <a href="https://vultr.com">Vultr</a> or
<a href="https://www.digitalocean.com/">DigitalOcean</a>. When signing up with these services you get some
free credit to test things out. If you use my
<a href="https://www.vultr.com/?ref=9276120-8H">Vultr referral link</a> you get 100USD to test the platform.
This is more than enough to get a basic VPS with Ubuntu on it. You can then try to install
everything needed to deploy Shiny apps from your VPS. You could follow <a href="https://www.marinedatascience.co/blog/2019/04/28/run-shiny-server-on-your-own-digitalocean-droplet-part-1/">this
guide</a>
to deploy from DigitalOcean, which should generalize well to other services like Vultr. Doing this
will teach you a lot, and I would highly recommend you do it.</p>
</div>
<div id="references" class="section level3 hasAnchor" number="8.4.5">
<h3><span class="header-section-number">8.4.5</span> References<a href="data-products-1.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://mastering-shiny.org/basic-reactivity.html?q=input#the-server-function">The server function</a></li>
<li><a href="https://shiny.rstudio.com/articles/caching.html">Using caching in Shiny to maximize performance</a></li>
<li><a href="https://engineering-shiny.org/">Engineering Production-Grade Shiny Apps</a></li>
</ul>
</div>
</div>
<div id="how-to-build-data-products-using-targets" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> How to build data products using <code>{targets}</code><a href="data-products-1.html#how-to-build-data-products-using-targets" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setting-up-pipelines-with-targets.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="self-contained-raps-with-docker.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/b-rodrigues/rap4mads/edit/master/08-products.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/b-rodrigues/rap4mads/blob/master/08-products.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
