<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 A package for a project | Reproducible Analytical Pipelines - Master’s of Data Science</title>
  <meta name="description" content="Chapter 5 A package for a project | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 A package for a project | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 A package for a project | Reproducible Analytical Pipelines - Master’s of Data Science" />
  
  
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-10-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="git.html"/>
<link rel="next" href="unit-tests.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAP4MADS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducible-analytical-pipelines"><i class="fa fa-check"></i><b>1.2</b> Reproducible analytical pipelines?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-products"><i class="fa fa-check"></i><b>1.3</b> Data products?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.4</b> Machine learning?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-r-why-not-insert-your-favourite-programming-language"><i class="fa fa-check"></i><b>1.5</b> Why R? Why not [insert your favourite programming language]</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i><b>1.6</b> Pre-requisites</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-in-data-with-r"><i class="fa fa-check"></i><b>2.1</b> Reading in data with R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-little-aside-on-pipes"><i class="fa fa-check"></i><b>2.2</b> A little aside on pipes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exploring-and-cleaning-data-with-r"><i class="fa fa-check"></i><b>2.3</b> Exploring and cleaning data with R</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>2.4</b> Data visualization</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html"><i class="fa fa-check"></i><b>3</b> A primer on functional programming</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#defining-your-own-functions"><i class="fa fa-check"></i><b>3.2</b> Defining your own functions</a></li>
<li class="chapter" data-level="3.3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#installing-git"><i class="fa fa-check"></i><b>4.2</b> Installing Git</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#setting-up-a-repo"><i class="fa fa-check"></i><b>4.3</b> Setting up a repo</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#cloning-the-repository-onto-your-computer"><i class="fa fa-check"></i><b>4.4</b> Cloning the repository onto your computer</a></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#your-first-commit"><i class="fa fa-check"></i><b>4.5</b> Your first commit</a></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#collaborating"><i class="fa fa-check"></i><b>4.6</b> Collaborating</a></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#contributing-to-someone-elses-repository"><i class="fa fa-check"></i><b>4.7</b> Contributing to someone else’s repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html"><i class="fa fa-check"></i><b>5</b> A package for a project</a>
<ul>
<li class="chapter" data-level="5.1" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#getting-started"><i class="fa fa-check"></i><b>5.2</b> Getting started</a></li>
<li class="chapter" data-level="5.3" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#adding-functions"><i class="fa fa-check"></i><b>5.3</b> Adding functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#functions-dependencies"><i class="fa fa-check"></i><b>5.3.1</b> Functions dependencies</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#documentation"><i class="fa fa-check"></i><b>5.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#documenting-functions"><i class="fa fa-check"></i><b>5.4.1</b> Documenting functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#documenting-the-package"><i class="fa fa-check"></i><b>5.4.2</b> Documenting the package</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="a-package-for-a-project.html"><a href="a-package-for-a-project.html#testing-your-package"><i class="fa fa-check"></i><b>5.5</b> Testing your package</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>6</b> Unit tests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unit-tests.html"><a href="unit-tests.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="unit-tests.html"><a href="unit-tests.html#unit-testing-with-testthat"><i class="fa fa-check"></i><b>6.2</b> Unit testing with <code>{testthat}</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="setting-up-an-actual-pipeline-with-targets.html"><a href="setting-up-an-actual-pipeline-with-targets.html"><i class="fa fa-check"></i><b>7</b> Setting up an actual pipeline with <code>{targets}</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="setting-up-an-actual-pipeline-with-targets.html"><a href="setting-up-an-actual-pipeline-with-targets.html#a-first-toy-example"><i class="fa fa-check"></i><b>7.1</b> A first toy example</a></li>
<li class="chapter" data-level="7.2" data-path="setting-up-an-actual-pipeline-with-targets.html"><a href="setting-up-an-actual-pipeline-with-targets.html#using-your-package-in-a-targets-pipeline"><i class="fa fa-check"></i><b>7.2</b> Using your package in a <code>{targets}</code> pipeline</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>8</b> Rmarkdown</a>
<ul>
<li class="chapter" data-level="8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#html-output"><i class="fa fa-check"></i><b>8.1</b> HTML output</a></li>
<li class="chapter" data-level="8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#word-and-pptx-outputs"><i class="fa fa-check"></i><b>8.2</b> Word and PPTX outputs</a></li>
<li class="chapter" data-level="8.3" data-path="rmarkdown.html"><a href="rmarkdown.html#flexdashboard-no-shiny"><i class="fa fa-check"></i><b>8.3</b> Flexdashboard (no shiny)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="going-beyond-static-outputs-with-shiny.html"><a href="going-beyond-static-outputs-with-shiny.html"><i class="fa fa-check"></i><b>9</b> Going beyond static outputs with Shiny</a></li>
<li class="chapter" data-level="10" data-path="what-else-should-you-learn.html"><a href="what-else-should-you-learn.html"><i class="fa fa-check"></i><b>10</b> What else should you learn?</a></li>
<li class="divider"></li>
<li><a href="https://github.com/b-rodrigues/rap4mads" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Analytical Pipelines - Master’s of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-package-for-a-project" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> A package for a project<a href="a-package-for-a-project.html#a-package-for-a-project" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-3" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction<a href="a-package-for-a-project.html#introduction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this chapter we’re going to develop a package that will contain a couple of functions.
Don’t focus too much on what these functions do or don’t do, that’s not really important.
What matters is that you understand how to build your own package, and why that’s useful.</p>
<p>Actually, we can start by why that’s useful right now.</p>
<p>R, as you know, has many many packages. When you type something like</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="a-package-for-a-project.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<p>This install the <code>{dplyr}</code> package. The package gets downloaded from a repository called
CRAN - The Comprehensive R Archive Network (or from one of its mirrors). Developers thus
work on their packages and once they feel the package is ready for productions they submit
it to CRAN. There are very strict rules to respect to publish on CRAN; but if the developers
respects these rules, and the package does something <em>non-trivial</em> (that’s not really defined
but the idea is that your package cannot simply be a collection of your implementation
of common mathematical functions for example), it’ll get published.</p>
<p>CRAN is actually quite a miracle; it works really well, and it’s been working well for years,
even decades, as CRAN was founded in <a href="https://stat.ethz.ch/pipermail/r-announce/1997/000001.html">1997</a>.
Installing packages on R is rarely frustrating, and when it is, it is rarely, if not never,
CRAN’s fault (there are some packages that require your operating system to have certain
libraries or programs installed beforehand, and these can be frustrating to install, like <code>java</code>
or certain libraries used for geospatial statistics).</p>
<p>But while from the point of view from the user, CRAN is great, there are sometimes some
frictions between package developers and CRAN maintainers. I’ll spare you the drama, but just
know that contributing to CRAN can be sometimes frustrating.</p>
<p>This does not concern us however, because we are going to learn how to develop a package but
we are not going to publish it to CRAN. Instead, we will be using github.com as a replacement
for CRAN. This has the advantage that we do not have to be so strict and disciplined when
writing our package, and other users can install the package almost just as easily from
github.com, with the following command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="a-package-for-a-project.html#cb2-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;github_username/some_package&quot;</span>)</span></code></pre></div>
<p>It is also possible to build the package and send it as a file per email for example, and then
install a local copy. This is more cumbersome, that’s why we’re going to use github.com as a
repository.</p>
</div>
<div id="getting-started" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Getting started<a href="a-package-for-a-project.html#getting-started" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s first start by opening RStudio, and starting a new project:</p>
<video width="640" height="480" controls>
<source src="img/new_package.mp4" type="video/mp4">
</video>
<p>Following these steps creates a folder in the specified path that already contains
some scaffolding for our package. This also opens a new RStudio session with the
default script <code>hello.R</code> opened:</p>
<p><img src="img/pack_1.png" width="1089" /></p>
<p>We can remove this script, but do take note of the following sentence:</p>
<pre><code># You can learn more about package authoring with RStudio at:
#
#   http://r-pkgs.had.co.nz/
#</code></pre>
<p>If this course succeeded in turning you into an avid R programmer, you might want to contribute
to the language by submitting some nice packages. You could at that point refer to this link
to learn the many, many subtleties of package development. But for our purposes, this chapter
will suffice.</p>
<p>Ok, so now let’s take a look inside the folder you just created and take a look at the package’s
structure. You can do so easily from within RStudio:</p>
<p><img src="img/pack_2.png" width="1086" /></p>
<p>But you can also navigate to the folder from inside a file explorer. The folder that will
matter to us the most for now is the <code>R</code> folder. This folder will contain your scripts, which
will contain your package’s functions. Let’s start by adding a new script.</p>
</div>
<div id="adding-functions" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Adding functions<a href="a-package-for-a-project.html#adding-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To add a new script, simply create a new script, and while we’re at it, let’s add some code to it:</p>
<video width="640" height="480" controls>
<source src="img/pack_adding_script.mp4" type="video/mp4">
</video>
<p>and that’s it! Well, this example is incredibly easy; there will be more subtleties later on,
but these are the basics: simply write your script as usual. Now let’s load the package with
<code>CTRL-SHIFT-L</code>. Loading the package makes it available in your current R session:</p>
<p><img src="img/pack_3.png" width="578" /></p>
<p>As you can see, the package is loaded, and RStudio’s autocomplete even suggest the function’s name
already. So now that we have already a function, let’s push our code to github.com (you remember that
we checked the box <code>Create a git repository</code> when we started the project?). For this,
let’s go back to github.com and create a new repository. Give it the same name as your package
on your computer, just to avoid confusion. Once the repo is created, you will see this familiar
screen:</p>
<p><img src="img/pack_4.png" width="915" /></p>
<p>We will start from an existing repository, because our repository already exists. So we can
use the terminal to enter the commands suggested here. We can also use the terminal
from RStudio:</p>
<video width="640" height="480" controls>
<source src="img/adding_remote.mp4" type="video/mp4">
</video>
<p>The steps above are a way to link your local repository to the remote repository living
on github.com. Without these initial steps, there is no way to link your package project
to github.com!</p>
<p>Let’s now write another function, which will depend on functions from other packages.</p>
<div id="functions-dependencies" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Functions dependencies<a href="a-package-for-a-project.html#functions-dependencies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the same script, add the following code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="a-package-for-a-project.html#cb4-1" aria-hidden="true" tabindex="-1"></a>only_automatics <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset){</span>
<span id="cb4-2"><a href="a-package-for-a-project.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="a-package-for-a-project.html#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb4-4"><a href="a-package-for-a-project.html#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This creates a function that takes a dataset as an argument, and filters the <code>am</code> variable.
This function is not great: it is not documented, so the user might not know that the dataset
that is meant here is the <code>mtcars</code> dataset (which is included with R by default). So we will
need to document this. Also, the variable <code>am</code> is hardcoded, that’s not good either. What if
the user wants to filter another variable with another value? We will solve these issues later
on. But there is a worse problem here. The <code>filter()</code> function that the developer intended to
use here is <code>dplyr::filter()</code>, so the one from the <code>{dplyr}</code> package. However, there are several
functions called <code>filter()</code>. If you start typing <code>filter</code> inside a fresh R session, here is
what the autocomplete suggests to you:</p>
<p><img src="img/pack_5.png" width="460" /></p>
<p>So there’s a <code>filter()</code> function from the <code>{stats}</code> package (which gets loaded automatically
with every new R session), and there’s a capital F <code>Filter()</code> function from the <code>{base}</code>
package (R is case sensitive, so <code>filter()</code> and <code>Filter()</code> are different functions).
So how can the developer specify the correct <code>filter()</code> function? Simply by using the following
notation: <code>dplyr::filter()</code> (which we have already encountered). So let’s rewrite the function
correctly:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="a-package-for-a-project.html#cb5-1" aria-hidden="true" tabindex="-1"></a>only_automatics <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset){</span>
<span id="cb5-2"><a href="a-package-for-a-project.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="a-package-for-a-project.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb5-4"><a href="a-package-for-a-project.html#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Great, so now <code>only_automatics()</code> at least knows which <code>filter</code> function to use, but this function
could be improved a lot more. In general, what you want is to have a function that is general enough
that it could work with any variable (if the dataset is supposed to be fixed), or that could work
with any combination of dataset and variable. Let’s make our function a bit more general,
by making it work on any variable from any dataset</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="a-package-for-a-project.html#cb6-1" aria-hidden="true" tabindex="-1"></a>my_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, condition){</span>
<span id="cb6-2"><a href="a-package-for-a-project.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="a-package-for-a-project.html#cb6-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(condition)</span>
<span id="cb6-4"><a href="a-package-for-a-project.html#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I renamed the function to <code>my_filter()</code> because now this function can work on any dataset and
with any predicate condition (of course this function is not really useful, since it’s only a
wrapper around <code>filter()</code>. But that’s not important). Let’s save the script and reload the
package with <code>CRTL-SHIFT-L</code> and try out the function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="a-package-for-a-project.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_filter</span>(mtcars, am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>You will get this output:</p>
<pre><code>Error in `dplyr::filter()` at myPackage/R/functions.R:6:4:
! Problem while computing `..1 = condition`.
Caused by error in `mask$eval_all_filter()`:
! object &#39;am&#39; not found
Run `rlang::last_error()` to see where the error occurred.</code></pre>
<p>so what’s going on? R complains that it cannot find <code>am</code>.
What is wrong with our function? After all, if I call the following, it works:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="a-package-for-a-project.html#cb9-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="a-package-for-a-project.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora  15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<p>So what gives? What’s going on here, is that R doesn’t know that it has look
for <code>am</code> inside the <code>mtcars</code> dataset. R is looking for a variable called <code>am</code>
in the global environment, which does not exist. <code>dplyr::filter()</code> is programmed
in a way that tells R to look for <code>am</code> inside <code>mtcars</code> and not in the global
environment (or whatever parent environment the function gets called from).
We need to program our function in the same way. To do this, simply enclose
references to columns of dataframes inside <code>{{}}</code>, like so:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="a-package-for-a-project.html#cb11-1" aria-hidden="true" tabindex="-1"></a>my_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, condition){</span>
<span id="cb11-2"><a href="a-package-for-a-project.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="a-package-for-a-project.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>({{condition}})</span>
<span id="cb11-4"><a href="a-package-for-a-project.html#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, R knows where to look. So reload the package with <code>CTRL-SHIFT-L</code> and
try again:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="a-package-for-a-project.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_filter</span>(mtcars, am <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora  15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<p><code>{{}}</code> is not a feature available in a base installation of R, but is provided
by packages from the <code>tidyverse</code> (like <code>{dplyr}</code>, <code>{tidyr}</code>, etc). If you write functions
that depend on <code>{dplyr}</code> functions like <code>filter()</code>, <code>select()</code> etc, you’ll have to know
keep using <code>{{}}</code>.</p>
<p>Let’s now write a more useful function. Remember the datasets about unemployment in Luxembourg?
I’m thinking about the ones <a href="https://rap4mads.eu/introduction-to-r.html#reading-in-data-with-r">here</a>,
<code>unemp_2013.csv</code>, <code>unemp_2014.csv</code>, etc.</p>
</div>
</div>
<div id="documentation" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Documentation<a href="a-package-for-a-project.html#documentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="documenting-functions" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Documenting functions<a href="a-package-for-a-project.html#documenting-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="documenting-the-package" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Documenting the package<a href="a-package-for-a-project.html#documenting-the-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="testing-your-package" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Testing your package<a href="a-package-for-a-project.html#testing-your-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="git.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="unit-tests.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/b-rodrigues/rap4mads/edit/master/05-package-dev.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/b-rodrigues/rap4mads/blob/master/05-package-dev.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
