[["setting-up-pipelines-with-targets.html", "Chapter 7 Setting up pipelines with {targets} 7.1 Introduction 7.2 Build automation with R 7.3 An aside on {renv} 7.4 Our actual first pipeline 7.5 Running someone else’s pipeline 7.6 Why we need more", " Chapter 7 Setting up pipelines with {targets} What you’ll have learned by the end of the chapter: how to set up an (almost) reproducible pipeline. 7.1 Introduction {targets} is a build automation tool for the R programming language. Build, in the context of this course means the creation of a data product. As mentioned in the introduction, this data product can be anything from predictions from a model to interactive web applications. Automation means that this build automation tool will take the burden off our shoulders when it’ll be time to run the build pipeline. Using such a tool, programmers don’t need to think about which parts of the code to rerun if they introduce a change somewhere. Only the parts affected by the change will run. These tools also run the pipeline in parallel, because they identify independent pats of the pipeline which are then run simultaneously. Build automation tools have many benefits, and because they work in a certain way, they also force you to work in a more structured way. 7.2 Build automation with R As an introduction, there really is not a better source than the {targets} manual itself, and in particular the walkthrough section. After reading this section, we have the basic knowledge to build our first pipeline. The goal of this pipeline will be to simply create a plot using the unemployment data we’ve been working on. Let’s create a new project in RStudio, but make sure that you check the following boxes: You should see the following message in the R console: * Initializing project ... * Discovering package dependencies ... Done! * Copying packages into the cache ... Done! The following package(s) will be updated in the lockfile: # CRAN =============================== - renv [* -&gt; 0.16.0] The version of R recorded in the lockfile will be updated: - R [*] -&gt; [4.2.1] * Lockfile written to &#39;~/six_to/first_pipeline/renv.lock&#39;. This is something that we have not discussed yet, so before we move on, let’s have a little aside on what {renv} is. 7.3 An aside on {renv} Any of your projects, whether they’re simple scripts to analyze some data or more complex reproducible analytical pipelines depend on the packages that you use for the analysis. And these packages evolve and change. It can very well happen that a function that you use from package {xyz} version 1 won’t be available anymore in version 2. Or maybe it’s still available but it works slightly different. It can be something as trivial as the arguments of the function have been renamed. The consequence is that when you’ll try to rerun your code, it won’t work at all, or worse, it’ll work, but produce a result that is not comparable to old results anymore, because the function got changed and the underlying algorithm isn’t the same anymore. So we need a certain stability, and ideally keep reusing the same packages for the same project. If you want to update a project to use new packages version, this can of course also be done, but it has to be conscious choice and you will have to make sure that the updated pipeline (using the updated packages) is able to reproduce old results before putting it into production. {renv} creates separate package libraries, one per project. The idea is quite simple; start your project with {renv} enabled (if you’re using RStudio, you can check the box “Use renv with this project” when starting a new project, if you’re not using RStudio, you can run renv::init()). This will create a file in the root of your project called renv.lock. You can open this file in a text editor, and you should see that the R version you’re currently using is recorded (and the version of {renv} itself). It should look something like this: { &quot;R&quot;: { &quot;Version&quot;: &quot;4.2.1&quot;, &quot;Repositories&quot;: [ { &quot;Name&quot;: &quot;CRAN&quot;, &quot;URL&quot;: &quot;http://cran.rstudio.com&quot; } ] }, &quot;Packages&quot;: { &quot;renv&quot;: { &quot;Package&quot;: &quot;renv&quot;, &quot;Version&quot;: &quot;0.16.0&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;c9e8442ab69bc21c9697ecf856c1e6c7&quot;, &quot;Requirements&quot;: [] } } } You can then work as usual. It doesn’t matter if you’re simply writing a script with an analysis, or doing something more complex like a RAP. You will likely need to re-install packages though; remember, {renv} sets up a library per project! Once you’re done and satisfied, run renv::snapshot(). As you might have guessed from the name this will take a snapshot of the project and write the current status to the renv.lock file: &gt; renv::snapshot() The following package(s) will be updated in the lockfile: # CRAN =============================== - R6 [* -&gt; 2.5.1] - cli [* -&gt; 3.4.1] - dplyr [* -&gt; 1.0.10] - fansi [* -&gt; 1.0.3] - generics [* -&gt; 0.1.3] - glue [* -&gt; 1.6.2] - lifecycle [* -&gt; 1.0.3] - magrittr [* -&gt; 2.0.3] - pillar [* -&gt; 1.8.1] - pkgconfig [* -&gt; 2.0.3] - rlang [* -&gt; 1.0.6] - tibble [* -&gt; 3.1.8] - tidyselect [* -&gt; 1.2.0] - utf8 [* -&gt; 1.2.2] - vctrs [* -&gt; 0.4.2] - withr [* -&gt; 2.5.0] Do you want to proceed? [y/N]: In it, you will see that the libraries needed to run the project are also recorded. The renv.lock will now look like this: { &quot;R&quot;: { &quot;Version&quot;: &quot;4.2.1&quot;, &quot;Repositories&quot;: [ { &quot;Name&quot;: &quot;CRAN&quot;, &quot;URL&quot;: &quot;http://cran.rstudio.com&quot; } ] }, &quot;Packages&quot;: { &quot;R6&quot;: { &quot;Package&quot;: &quot;R6&quot;, &quot;Version&quot;: &quot;2.5.1&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;470851b6d5d0ac559e9d01bb352b4021&quot;, &quot;Requirements&quot;: [] }, &quot;cli&quot;: { &quot;Package&quot;: &quot;cli&quot;, &quot;Version&quot;: &quot;3.4.1&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;0d297d01734d2bcea40197bd4971a764&quot;, &quot;Requirements&quot;: [] }, &quot;dplyr&quot;: { &quot;Package&quot;: &quot;dplyr&quot;, &quot;Version&quot;: &quot;1.0.10&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;539412282059f7f0c07295723d23f987&quot;, &quot;Requirements&quot;: [ &quot;R6&quot;, &quot;generics&quot;, &quot;glue&quot;, &quot;lifecycle&quot;, &quot;magrittr&quot;, &quot;pillar&quot;, &quot;rlang&quot;, &quot;tibble&quot;, &quot;tidyselect&quot;, &quot;vctrs&quot; ] }, &quot;fansi&quot;: { &quot;Package&quot;: &quot;fansi&quot;, &quot;Version&quot;: &quot;1.0.3&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;83a8afdbe71839506baa9f90eebad7ec&quot;, &quot;Requirements&quot;: [] }, &quot;generics&quot;: { &quot;Package&quot;: &quot;generics&quot;, &quot;Version&quot;: &quot;0.1.3&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;15e9634c0fcd294799e9b2e929ed1b86&quot;, &quot;Requirements&quot;: [] }, &quot;glue&quot;: { &quot;Package&quot;: &quot;glue&quot;, &quot;Version&quot;: &quot;1.6.2&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;4f2596dfb05dac67b9dc558e5c6fba2e&quot;, &quot;Requirements&quot;: [] }, &quot;lifecycle&quot;: { &quot;Package&quot;: &quot;lifecycle&quot;, &quot;Version&quot;: &quot;1.0.3&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;001cecbeac1cff9301bdc3775ee46a86&quot;, &quot;Requirements&quot;: [ &quot;cli&quot;, &quot;glue&quot;, &quot;rlang&quot; ] }, &quot;magrittr&quot;: { &quot;Package&quot;: &quot;magrittr&quot;, &quot;Version&quot;: &quot;2.0.3&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;7ce2733a9826b3aeb1775d56fd305472&quot;, &quot;Requirements&quot;: [] }, &quot;pillar&quot;: { &quot;Package&quot;: &quot;pillar&quot;, &quot;Version&quot;: &quot;1.8.1&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;f2316df30902c81729ae9de95ad5a608&quot;, &quot;Requirements&quot;: [ &quot;cli&quot;, &quot;fansi&quot;, &quot;glue&quot;, &quot;lifecycle&quot;, &quot;rlang&quot;, &quot;utf8&quot;, &quot;vctrs&quot; ] }, &quot;pkgconfig&quot;: { &quot;Package&quot;: &quot;pkgconfig&quot;, &quot;Version&quot;: &quot;2.0.3&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;01f28d4278f15c76cddbea05899c5d6f&quot;, &quot;Requirements&quot;: [] }, &quot;renv&quot;: { &quot;Package&quot;: &quot;renv&quot;, &quot;Version&quot;: &quot;0.16.0&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;c9e8442ab69bc21c9697ecf856c1e6c7&quot;, &quot;Requirements&quot;: [] }, &quot;rlang&quot;: { &quot;Package&quot;: &quot;rlang&quot;, &quot;Version&quot;: &quot;1.0.6&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;4ed1f8336c8d52c3e750adcdc57228a7&quot;, &quot;Requirements&quot;: [] }, &quot;tibble&quot;: { &quot;Package&quot;: &quot;tibble&quot;, &quot;Version&quot;: &quot;3.1.8&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;56b6934ef0f8c68225949a8672fe1a8f&quot;, &quot;Requirements&quot;: [ &quot;fansi&quot;, &quot;lifecycle&quot;, &quot;magrittr&quot;, &quot;pillar&quot;, &quot;pkgconfig&quot;, &quot;rlang&quot;, &quot;vctrs&quot; ] }, &quot;tidyselect&quot;: { &quot;Package&quot;: &quot;tidyselect&quot;, &quot;Version&quot;: &quot;1.2.0&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;79540e5fcd9e0435af547d885f184fd5&quot;, &quot;Requirements&quot;: [ &quot;cli&quot;, &quot;glue&quot;, &quot;lifecycle&quot;, &quot;rlang&quot;, &quot;vctrs&quot;, &quot;withr&quot; ] }, &quot;utf8&quot;: { &quot;Package&quot;: &quot;utf8&quot;, &quot;Version&quot;: &quot;1.2.2&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;c9c462b759a5cc844ae25b5942654d13&quot;, &quot;Requirements&quot;: [] }, &quot;vctrs&quot;: { &quot;Package&quot;: &quot;vctrs&quot;, &quot;Version&quot;: &quot;0.4.2&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;0e3dfc070b2a8f0478fcdf86fb33355d&quot;, &quot;Requirements&quot;: [ &quot;cli&quot;, &quot;glue&quot;, &quot;rlang&quot; ] }, &quot;withr&quot;: { &quot;Package&quot;: &quot;withr&quot;, &quot;Version&quot;: &quot;2.5.0&quot;, &quot;Source&quot;: &quot;Repository&quot;, &quot;Repository&quot;: &quot;CRAN&quot;, &quot;Hash&quot;: &quot;c0e49a9760983e81e55cdd9be92e7182&quot;, &quot;Requirements&quot;: [] } } } On your end, you’re done. You can push this project to github.com for instance, and someone else who wishes to run this project will have to simply: Clone the repository; Run renv::restore() to install all the required libraries. And that’s it! This person, who might be future you, will now be able to re-run the project with the required libraries and the right versions. In a coming section we are actually going to do just that, but for now, let’s go back to {targets}. 7.4 Our actual first pipeline 7.5 Running someone else’s pipeline &gt; renv::restore() Welcome to renv! It looks like this is your first time using renv. This is a one-time message, briefly describing some of renv&#39;s functionality. renv maintains a local cache of data on the filesystem, located at: - &quot;~/.cache/R/renv&quot; This path can be customized: please see the documentation in `?renv::paths`. renv will also write to files within the active project folder, including: - A folder &#39;renv&#39; in the project directory, and - A lockfile called &#39;renv.lock&#39; in the project directory. In particular, projects using renv will normally use a private, per-project R library, in which new packages will be installed. This project library is isolated from other R libraries on your system. In addition, renv will update files within your project directory, including: - .gitignore - .Rbuildignore - .Rprofile Please read the introduction vignette with `vignette(&quot;renv&quot;)` for more information. You can browse the package documentation online at https://rstudio.github.io/renv/. 7.6 Why we need more "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
