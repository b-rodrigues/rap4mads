<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Unit tests | Reproducible Analytical Pipelines - Master’s of Data Science</title>
  <meta name="description" content="Chapter 6 Unit tests | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Unit tests | Reproducible Analytical Pipelines - Master’s of Data Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Unit tests | Reproducible Analytical Pipelines - Master’s of Data Science" />
  
  
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-10-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="package-development.html"/>
<link rel="next" href="setting-up-pipelines-with-targets.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAP4MADS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducible-analytical-pipelines"><i class="fa fa-check"></i><b>1.2</b> Reproducible analytical pipelines?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-products"><i class="fa fa-check"></i><b>1.3</b> Data products?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.4</b> Machine learning?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-r-why-not-insert-your-favourite-programming-language"><i class="fa fa-check"></i><b>1.5</b> Why R? Why not [insert your favourite programming language]</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#pre-requisites"><i class="fa fa-check"></i><b>1.6</b> Pre-requisites</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.7</b> Grading</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#jargon"><i class="fa fa-check"></i><b>1.8</b> Jargon</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#further-reading"><i class="fa fa-check"></i><b>1.9</b> Further reading</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.10</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-in-data-with-r"><i class="fa fa-check"></i><b>2.1</b> Reading in data with R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-little-aside-on-pipes"><i class="fa fa-check"></i><b>2.2</b> A little aside on pipes</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exploring-and-cleaning-data-with-r"><i class="fa fa-check"></i><b>2.3</b> Exploring and cleaning data with R</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>2.4</b> Data visualization</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#further-reading-1"><i class="fa fa-check"></i><b>2.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html"><i class="fa fa-check"></i><b>3</b> A primer on functional programming</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#defining-your-own-functions"><i class="fa fa-check"></i><b>3.2</b> Defining your own functions</a></li>
<li class="chapter" data-level="3.3" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a></li>
<li class="chapter" data-level="3.4" data-path="a-primer-on-functional-programming.html"><a href="a-primer-on-functional-programming.html#further-reading-2"><i class="fa fa-check"></i><b>3.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>4</b> Git</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git.html"><a href="git.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="git.html"><a href="git.html#installing-git"><i class="fa fa-check"></i><b>4.2</b> Installing Git</a></li>
<li class="chapter" data-level="4.3" data-path="git.html"><a href="git.html#setting-up-a-repo"><i class="fa fa-check"></i><b>4.3</b> Setting up a repo</a></li>
<li class="chapter" data-level="4.4" data-path="git.html"><a href="git.html#cloning-the-repository-onto-your-computer"><i class="fa fa-check"></i><b>4.4</b> Cloning the repository onto your computer</a></li>
<li class="chapter" data-level="4.5" data-path="git.html"><a href="git.html#your-first-commit"><i class="fa fa-check"></i><b>4.5</b> Your first commit</a></li>
<li class="chapter" data-level="4.6" data-path="git.html"><a href="git.html#collaborating"><i class="fa fa-check"></i><b>4.6</b> Collaborating</a></li>
<li class="chapter" data-level="4.7" data-path="git.html"><a href="git.html#branches"><i class="fa fa-check"></i><b>4.7</b> Branches</a></li>
<li class="chapter" data-level="4.8" data-path="git.html"><a href="git.html#contributing-to-someone-elses-repository"><i class="fa fa-check"></i><b>4.8</b> Contributing to someone else’s repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>5</b> Package development</a>
<ul>
<li class="chapter" data-level="5.1" data-path="package-development.html"><a href="package-development.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="package-development.html"><a href="package-development.html#getting-started"><i class="fa fa-check"></i><b>5.2</b> Getting started</a></li>
<li class="chapter" data-level="5.3" data-path="package-development.html"><a href="package-development.html#adding-functions"><i class="fa fa-check"></i><b>5.3</b> Adding functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="package-development.html"><a href="package-development.html#functions-dependencies"><i class="fa fa-check"></i><b>5.3.1</b> Functions dependencies</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="package-development.html"><a href="package-development.html#documentation"><i class="fa fa-check"></i><b>5.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="package-development.html"><a href="package-development.html#documenting-functions"><i class="fa fa-check"></i><b>5.4.1</b> Documenting functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="package-development.html"><a href="package-development.html#documenting-the-package"><i class="fa fa-check"></i><b>5.4.2</b> Documenting the package</a></li>
<li class="chapter" data-level="5.4.3" data-path="package-development.html"><a href="package-development.html#checking-your-package"><i class="fa fa-check"></i><b>5.4.3</b> Checking your package</a></li>
<li class="chapter" data-level="5.4.4" data-path="package-development.html"><a href="package-development.html#installing-your-package"><i class="fa fa-check"></i><b>5.4.4</b> Installing your package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>6</b> Unit tests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unit-tests.html"><a href="unit-tests.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="unit-tests.html"><a href="unit-tests.html#testing-your-package"><i class="fa fa-check"></i><b>6.2</b> Testing your package</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="unit-tests.html"><a href="unit-tests.html#is-the-function-returning-an-expected-value-for-a-given-input"><i class="fa fa-check"></i><b>6.2.1</b> Is the function returning an expected value for a given input?</a></li>
<li class="chapter" data-level="6.2.2" data-path="unit-tests.html"><a href="unit-tests.html#can-the-function-deal-with-all-kinds-of-input"><i class="fa fa-check"></i><b>6.2.2</b> Can the function deal with all kinds of input?</a></li>
<li class="chapter" data-level="6.2.3" data-path="unit-tests.html"><a href="unit-tests.html#back-to-developing-again"><i class="fa fa-check"></i><b>6.2.3</b> Back to developing again</a></li>
<li class="chapter" data-level="6.2.4" data-path="unit-tests.html"><a href="unit-tests.html#and-back-to-testing"><i class="fa fa-check"></i><b>6.2.4</b> And back to testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html"><i class="fa fa-check"></i><b>7</b> Setting up pipelines with <code>{targets}</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#build-automation-with-r"><i class="fa fa-check"></i><b>7.2</b> Build automation with R</a></li>
<li class="chapter" data-level="7.3" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#an-aside-on-renv"><i class="fa fa-check"></i><b>7.3</b> An aside on <code>{renv}</code></a></li>
<li class="chapter" data-level="7.4" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#our-actual-first-pipeline"><i class="fa fa-check"></i><b>7.4</b> Our actual first pipeline</a></li>
<li class="chapter" data-level="7.5" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-someone-elses-pipeline"><i class="fa fa-check"></i><b>7.5</b> Running someone else’s pipeline</a></li>
<li class="chapter" data-level="7.6" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#running-any-code-with-older-packages"><i class="fa fa-check"></i><b>7.6</b> Running any code with older packages</a></li>
<li class="chapter" data-level="7.7" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#why-we-need-more"><i class="fa fa-check"></i><b>7.7</b> Why we need more</a></li>
<li class="chapter" data-level="7.8" data-path="setting-up-pipelines-with-targets.html"><a href="setting-up-pipelines-with-targets.html#further-reading-3"><i class="fa fa-check"></i><b>7.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-products-1.html"><a href="data-products-1.html"><i class="fa fa-check"></i><b>8</b> Data products</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-products-1.html"><a href="data-products-1.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="data-products-1.html"><a href="data-products-1.html#a-first-taste-of-quarto"><i class="fa fa-check"></i><b>8.2</b> A first taste of Quarto</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-products-1.html"><a href="data-products-1.html#python-and-julia-code-chunks"><i class="fa fa-check"></i><b>8.2.1</b> Python and Julia code chunks</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-products-1.html"><a href="data-products-1.html#other-output-formats"><i class="fa fa-check"></i><b>8.3</b> Other output formats</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-products-1.html"><a href="data-products-1.html#word"><i class="fa fa-check"></i><b>8.3.1</b> Word</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-products-1.html"><a href="data-products-1.html#presentations"><i class="fa fa-check"></i><b>8.3.2</b> Presentations</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-products-1.html"><a href="data-products-1.html#pdf"><i class="fa fa-check"></i><b>8.3.3</b> PDF</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-products-1.html"><a href="data-products-1.html#interactive-web-applications-with-shiny"><i class="fa fa-check"></i><b>8.4</b> Interactive web applications with {shiny}</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-products-1.html"><a href="data-products-1.html#the-basic-structure-of-a-shiny-app"><i class="fa fa-check"></i><b>8.4.1</b> The basic structure of a Shiny app</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-products-1.html"><a href="data-products-1.html#references"><i class="fa fa-check"></i><b>8.4.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-products-1.html"><a href="data-products-1.html#how-to-build-data-products-using-targets"><i class="fa fa-check"></i><b>8.5</b> How to build data products using <code>{targets}</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="self-contained-raps-with-docker.html"><a href="self-contained-raps-with-docker.html"><i class="fa fa-check"></i><b>9</b> Self-contained RAPs with Docker</a></li>
<li class="chapter" data-level="10" data-path="cicd-with-github-actions.html"><a href="cicd-with-github-actions.html"><i class="fa fa-check"></i><b>10</b> CI/CD with Github Actions</a></li>
<li class="chapter" data-level="11" data-path="what-else-should-you-learn.html"><a href="what-else-should-you-learn.html"><i class="fa fa-check"></i><b>11</b> What else should you learn?</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a>
<ul>
<li class="chapter" data-level="12.1" data-path="conclusion.html"><a href="conclusion.html#why-bother"><i class="fa fa-check"></i><b>12.1</b> Why bother</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/b-rodrigues/rap4mads" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Analytical Pipelines - Master’s of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unit-tests" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Unit tests<a href="unit-tests.html#unit-tests" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div style="text-align:center;">
<p><img src="img/pcr_test.png" width="512" /></p>
</div>
<p>What you’ll have learned by the end of the chapter: what unit tests are, how to write them, and how
to test your package thoroughly.</p>
<div id="introduction-4" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction<a href="unit-tests.html#introduction-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It might not have seemed like it, but developing our own package was actually the first step in
writing reproducible code. Packaged code is easy to share, and much easier to run than code that
lives inside scripts. When you share code, be it with future you or others, you have a
responsibility to ship high quality code. Unit tests are one way to ensure that your code works as
intented, but it is not a panacea. But if you write short, well-documented functions, and you
package them, and test them thoroughly, you are on the right track for success.</p>
<p>But what are unit tests? Unit tests are pieces of code that test other pieces of code (called units
in this context). It turns out that functions are units of code, and that makes testing them quite
easy. I hope that you are starting to see the pieces coming all together: I introduced you to
functional programming and insisted that you write your code as a sequence of functions calls,
because it makes it easier to package and document everything. And now that your code lives inside
a package, as a series of functions, it will be very easy to test these functions (or units of
code).</p>
</div>
<div id="testing-your-package" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Testing your package<a href="unit-tests.html#testing-your-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because our code is packaged, starting to write unit tests will be very easy. For this, open RStudio
and make sure your package’s project is opened:</p>
<p><img src="img/pack_7.png" width="764" /></p>
<p>In order to set up the required files and folders for unit testing, run the following line in the R
console:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="unit-tests.html#cb106-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">&quot;clean_unemp&quot;</span>)</span></code></pre></div>
<p>You should see a folder called <code>tests</code> appear inside the package. Inside <code>tests</code>, there is another
folder called <code>testthat</code>, and inside this folder you should find a file called
<code>test-clean_unemp.R</code>. This file should contain an example:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="unit-tests.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;multiplication works&quot;</span>, {</span>
<span id="cb107-2"><a href="unit-tests.html#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb107-3"><a href="unit-tests.html#cb107-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>This is quite self-explanatory; <code>test_that()</code> is the function that we are going to use to write
tests. It takes a string as an argument, and a test. For the string write an explanatory name. This
will make it easier to find the test if it fails. <code>expect_equal()</code> is a function that tests the
equality between its arguments. On one side we have <code>2 * 2</code>, and on the other, <code>4</code>. All our tests
will look somewhat like this. There are many <code>expect_</code> functions, that allow you to test for many
conditions. You can take a look at <code>{testthat}</code>’s <a href="https://testthat.r-lib.org/reference/index.html">function
reference</a> for a complete list.</p>
<p>So, what should we test? Well, here are several ideas:</p>
<ul>
<li>Is the function returning an expected value for a given input?</li>
<li>Can the function deal with all kinds of input? What happens if an unexpected input is provided?</li>
<li>Is the function failing as expected for certain inputs?</li>
<li>Is the function dealing with corner cases as intended?</li>
</ul>
<p>Let’s try to write some tests for our <code>clean_unemp()</code> function now, and start to consider each of these questions.</p>
<div id="is-the-function-returning-an-expected-value-for-a-given-input" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Is the function returning an expected value for a given input?<a href="unit-tests.html#is-the-function-returning-an-expected-value-for-a-given-input" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s start by testing if our function actually returns data for the Grand-Duchy of Luxembourg if
the user provides a correct regular expression. Add these lines to the script (and remove the
example test while you’re at it):</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="unit-tests.html#cb108-1" aria-hidden="true" tabindex="-1"></a>unemp_2013 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2013.csv&quot;</span>)</span>
<span id="cb108-2"><a href="unit-tests.html#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="unit-tests.html#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting the grand duchy works&quot;</span>, {</span>
<span id="cb108-4"><a href="unit-tests.html#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="unit-tests.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb108-6"><a href="unit-tests.html#cb108-6" aria-hidden="true" tabindex="-1"></a>                      unemp_2013,</span>
<span id="cb108-7"><a href="unit-tests.html#cb108-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">grepl</span>(<span class="st">&quot;Grand-D.*&quot;</span>, commune),</span>
<span id="cb108-8"><a href="unit-tests.html#cb108-8" aria-hidden="true" tabindex="-1"></a>                      active_population)</span>
<span id="cb108-9"><a href="unit-tests.html#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="unit-tests.html#cb108-10" aria-hidden="true" tabindex="-1"></a>expected_value <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(</span>
<span id="cb108-11"><a href="unit-tests.html#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>, </span>
<span id="cb108-12"><a href="unit-tests.html#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;commune&quot;</span> <span class="ot">=</span> <span class="st">&quot;Grand-Duche de Luxembourg&quot;</span>, </span>
<span id="cb108-13"><a href="unit-tests.html#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">242694</span>))</span>
<span id="cb108-14"><a href="unit-tests.html#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="unit-tests.html#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb108-16"><a href="unit-tests.html#cb108-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>So what’s going on here? First, I need to get the data. I load the data outside of the test, so
it’ll be available to every test afterwards as well. Then, inside the test, I need to define two
more variables: the actual value returned by the function, and the value that we expect. I need to
create this value by hand, and I do so using the <code>tibble::as_tibble()</code> function. This function
takes a list as an argument and converts it to a tibble. I did not explain what tibbles are yet:
tibbles are basically the same as a data frame, but have a nicer print method, and other niceties.
In practice, you don’t need to think about tibbles too much, but here you need to be careful:
<code>clean_unemp()</code> returns a tibble, because that’s what <code>{dplyr}</code> functions return by default. So if
in your test you compare a tibble to a data.frame, your test will fail, because their classes are
not equal. So I need to define my expected value as a tibble for the test to pass.</p>
<p>You can now save the script, and press <code>CTRL-SHIFT-T</code> to run the test. The test should pass, if
not, there’s either something wrong with your function, with the inputs you provided to it, or with
the expected value. You can keep adding tests to this script, to cover every possible use case:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="unit-tests.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting cantons works&quot;</span>, {</span>
<span id="cb109-2"><a href="unit-tests.html#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="unit-tests.html#cb109-3" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb109-4"><a href="unit-tests.html#cb109-4" aria-hidden="true" tabindex="-1"></a>                      unemp_2013,</span>
<span id="cb109-5"><a href="unit-tests.html#cb109-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune),</span>
<span id="cb109-6"><a href="unit-tests.html#cb109-6" aria-hidden="true" tabindex="-1"></a>                      active_population)</span>
<span id="cb109-7"><a href="unit-tests.html#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="unit-tests.html#cb109-8" aria-hidden="true" tabindex="-1"></a>expected_value <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;test_data_cantons.csv&quot;</span>)</span>
<span id="cb109-9"><a href="unit-tests.html#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="unit-tests.html#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb109-11"><a href="unit-tests.html#cb109-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>In the test above, I cannot write the expected value by hand. So what I did instead was run my
function in a terminal, and save the output in a csv file. I used the following code for this:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="unit-tests.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(unemp_2013,</span>
<span id="cb110-2"><a href="unit-tests.html#cb110-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune),</span>
<span id="cb110-3"><a href="unit-tests.html#cb110-3" aria-hidden="true" tabindex="-1"></a>            active_population) <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="unit-tests.html#cb110-4" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="st">&quot;tests/testthat/test_data_cantons.csv&quot;</span>)</span></code></pre></div>
<p>I inspected this output to make sure everything was correct. I can now keep this csv file and test
my function against it. Should my function fail when tested against it, I know that something is
wrong. We can do the same for communes. First, save the “ground truth” in a csv file:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="unit-tests.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(unemp_2013,</span>
<span id="cb111-2"><a href="unit-tests.html#cb111-2" aria-hidden="true" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;(Canton|Grand-D.*)&quot;</span>, commune),</span>
<span id="cb111-3"><a href="unit-tests.html#cb111-3" aria-hidden="true" tabindex="-1"></a>            active_population) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="unit-tests.html#cb111-4" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="st">&quot;tests/testthat/test_data_communes.csv&quot;</span>)</span></code></pre></div>
<p>Then, we can use this csv file in our tests:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="unit-tests.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting communes works&quot;</span>, {</span>
<span id="cb112-2"><a href="unit-tests.html#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="unit-tests.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb112-4"><a href="unit-tests.html#cb112-4" aria-hidden="true" tabindex="-1"></a>                      unemp_2013,</span>
<span id="cb112-5"><a href="unit-tests.html#cb112-5" aria-hidden="true" tabindex="-1"></a>                      <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;(Canton|Grand-D.*)&quot;</span>, commune),</span>
<span id="cb112-6"><a href="unit-tests.html#cb112-6" aria-hidden="true" tabindex="-1"></a>                      active_population)</span>
<span id="cb112-7"><a href="unit-tests.html#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="unit-tests.html#cb112-8" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;test_data_communes.csv&quot;</span>)</span>
<span id="cb112-9"><a href="unit-tests.html#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="unit-tests.html#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb112-11"><a href="unit-tests.html#cb112-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>We could even add a test for a specific commune:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="unit-tests.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting one commune works&quot;</span>, {</span>
<span id="cb113-2"><a href="unit-tests.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="unit-tests.html#cb113-3" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb113-4"><a href="unit-tests.html#cb113-4" aria-hidden="true" tabindex="-1"></a>                      unemp_2013,</span>
<span id="cb113-5"><a href="unit-tests.html#cb113-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">grepl</span>(<span class="st">&quot;Kayl&quot;</span>, commune),</span>
<span id="cb113-6"><a href="unit-tests.html#cb113-6" aria-hidden="true" tabindex="-1"></a>                      active_population)</span>
<span id="cb113-7"><a href="unit-tests.html#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="unit-tests.html#cb113-8" aria-hidden="true" tabindex="-1"></a>expected_value <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(</span>
<span id="cb113-9"><a href="unit-tests.html#cb113-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>, </span>
<span id="cb113-10"><a href="unit-tests.html#cb113-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;commune&quot;</span> <span class="ot">=</span> <span class="st">&quot;Kayl&quot;</span>, </span>
<span id="cb113-11"><a href="unit-tests.html#cb113-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">3863</span>))</span>
<span id="cb113-12"><a href="unit-tests.html#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="unit-tests.html#cb113-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb113-14"><a href="unit-tests.html#cb113-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>So your final script would look something like this:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="unit-tests.html#cb114-1" aria-hidden="true" tabindex="-1"></a>unemp_2013 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2013.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-2"><a href="unit-tests.html#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="unit-tests.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting the grand duchy works&quot;</span>, {</span>
<span id="cb114-4"><a href="unit-tests.html#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="unit-tests.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb114-6"><a href="unit-tests.html#cb114-6" aria-hidden="true" tabindex="-1"></a>    unemp_2013,</span>
<span id="cb114-7"><a href="unit-tests.html#cb114-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;Grand-D.*&quot;</span>, commune),</span>
<span id="cb114-8"><a href="unit-tests.html#cb114-8" aria-hidden="true" tabindex="-1"></a>    active_population)</span>
<span id="cb114-9"><a href="unit-tests.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="unit-tests.html#cb114-10" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(</span>
<span id="cb114-11"><a href="unit-tests.html#cb114-11" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>,</span>
<span id="cb114-12"><a href="unit-tests.html#cb114-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;commune&quot;</span> <span class="ot">=</span> <span class="st">&quot;Grand-Duche de Luxembourg&quot;</span>,</span>
<span id="cb114-13"><a href="unit-tests.html#cb114-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">242694</span>))</span>
<span id="cb114-14"><a href="unit-tests.html#cb114-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-15"><a href="unit-tests.html#cb114-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb114-16"><a href="unit-tests.html#cb114-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-17"><a href="unit-tests.html#cb114-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb114-18"><a href="unit-tests.html#cb114-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-19"><a href="unit-tests.html#cb114-19" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting cantons work&quot;</span>, {</span>
<span id="cb114-20"><a href="unit-tests.html#cb114-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-21"><a href="unit-tests.html#cb114-21" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb114-22"><a href="unit-tests.html#cb114-22" aria-hidden="true" tabindex="-1"></a>    unemp_2013,</span>
<span id="cb114-23"><a href="unit-tests.html#cb114-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune),</span>
<span id="cb114-24"><a href="unit-tests.html#cb114-24" aria-hidden="true" tabindex="-1"></a>    active_population)</span>
<span id="cb114-25"><a href="unit-tests.html#cb114-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-26"><a href="unit-tests.html#cb114-26" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;test_data_cantons.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-27"><a href="unit-tests.html#cb114-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-28"><a href="unit-tests.html#cb114-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb114-29"><a href="unit-tests.html#cb114-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-30"><a href="unit-tests.html#cb114-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb114-31"><a href="unit-tests.html#cb114-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-32"><a href="unit-tests.html#cb114-32" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting communes works&quot;</span>, {</span>
<span id="cb114-33"><a href="unit-tests.html#cb114-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-34"><a href="unit-tests.html#cb114-34" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb114-35"><a href="unit-tests.html#cb114-35" aria-hidden="true" tabindex="-1"></a>    unemp_2013,</span>
<span id="cb114-36"><a href="unit-tests.html#cb114-36" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;(Canton|Grand-D.*)&quot;</span>, commune),</span>
<span id="cb114-37"><a href="unit-tests.html#cb114-37" aria-hidden="true" tabindex="-1"></a>    active_population)</span>
<span id="cb114-38"><a href="unit-tests.html#cb114-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-39"><a href="unit-tests.html#cb114-39" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;test_data_communes.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-40"><a href="unit-tests.html#cb114-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-41"><a href="unit-tests.html#cb114-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb114-42"><a href="unit-tests.html#cb114-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-43"><a href="unit-tests.html#cb114-43" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb114-44"><a href="unit-tests.html#cb114-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-45"><a href="unit-tests.html#cb114-45" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting one commune works&quot;</span>, {</span>
<span id="cb114-46"><a href="unit-tests.html#cb114-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-47"><a href="unit-tests.html#cb114-47" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb114-48"><a href="unit-tests.html#cb114-48" aria-hidden="true" tabindex="-1"></a>    unemp_2013,</span>
<span id="cb114-49"><a href="unit-tests.html#cb114-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;Kayl&quot;</span>, commune),</span>
<span id="cb114-50"><a href="unit-tests.html#cb114-50" aria-hidden="true" tabindex="-1"></a>    active_population)</span>
<span id="cb114-51"><a href="unit-tests.html#cb114-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-52"><a href="unit-tests.html#cb114-52" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(</span>
<span id="cb114-53"><a href="unit-tests.html#cb114-53" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>,</span>
<span id="cb114-54"><a href="unit-tests.html#cb114-54" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;commune&quot;</span> <span class="ot">=</span> <span class="st">&quot;Kayl&quot;</span>,</span>
<span id="cb114-55"><a href="unit-tests.html#cb114-55" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">3863</span>))</span>
<span id="cb114-56"><a href="unit-tests.html#cb114-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-57"><a href="unit-tests.html#cb114-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb114-58"><a href="unit-tests.html#cb114-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-59"><a href="unit-tests.html#cb114-59" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="can-the-function-deal-with-all-kinds-of-input" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Can the function deal with all kinds of input?<a href="unit-tests.html#can-the-function-deal-with-all-kinds-of-input" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What <em>should</em> happen if your function gets an unexpected input? Let’s write a unit test and then see if it passes.
For example, what if the user enters a commune name that is not in Luxembourg? We expect the data frame to be
empty, so let’s write a test for that</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="unit-tests.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;wrong commune name&quot;</span>, {</span>
<span id="cb115-2"><a href="unit-tests.html#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="unit-tests.html#cb115-3" aria-hidden="true" tabindex="-1"></a>returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb115-4"><a href="unit-tests.html#cb115-4" aria-hidden="true" tabindex="-1"></a>                      unemp_2013,</span>
<span id="cb115-5"><a href="unit-tests.html#cb115-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">grepl</span>(<span class="st">&quot;Paris&quot;</span>, commune),</span>
<span id="cb115-6"><a href="unit-tests.html#cb115-6" aria-hidden="true" tabindex="-1"></a>                      active_population)</span>
<span id="cb115-7"><a href="unit-tests.html#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="unit-tests.html#cb115-8" aria-hidden="true" tabindex="-1"></a>expected_value <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(</span>
<span id="cb115-9"><a href="unit-tests.html#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb115-10"><a href="unit-tests.html#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;commune&quot;</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb115-11"><a href="unit-tests.html#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">0</span>)))</span>
<span id="cb115-12"><a href="unit-tests.html#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="unit-tests.html#cb115-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-14"><a href="unit-tests.html#cb115-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb115-15"><a href="unit-tests.html#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="unit-tests.html#cb115-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>This test reveals something interesting: your function returns an empty data frame, but the user might not understand
what’s wrong. Maybe we could add a message to inform the user? We could write something like:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="unit-tests.html#cb116-1" aria-hidden="true" tabindex="-1"></a>clean_unemp <span class="ot">&lt;-</span> <span class="cf">function</span>(unemp_data, level, col_of_interest){</span>
<span id="cb116-2"><a href="unit-tests.html#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="unit-tests.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> unemp_data <span class="sc">|&gt;</span></span>
<span id="cb116-4"><a href="unit-tests.html#cb116-4" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb116-5"><a href="unit-tests.html#cb116-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>({{level}}) <span class="sc">|&gt;</span></span>
<span id="cb116-6"><a href="unit-tests.html#cb116-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(year, commune, {{col_of_interest}})</span>
<span id="cb116-7"><a href="unit-tests.html#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="unit-tests.html#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(result) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb116-9"><a href="unit-tests.html#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;The returned data frame is empty. This is likely because the `level` argument supplied does not match any rows in the original data.&quot;</span>)</span>
<span id="cb116-10"><a href="unit-tests.html#cb116-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb116-11"><a href="unit-tests.html#cb116-11" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb116-12"><a href="unit-tests.html#cb116-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Replace the <code>clean_unemp()</code> function from your package with this one, and rerun the tests. The test should
still pass, but a warning will be shown. We can test for this as well; is the warning thrown? Let’s write
the required test for it:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="unit-tests.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;wrong commune name: warning is thrown&quot;</span>, {</span>
<span id="cb117-2"><a href="unit-tests.html#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="unit-tests.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_warning</span>({</span>
<span id="cb117-4"><a href="unit-tests.html#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_unemp</span>(</span>
<span id="cb117-5"><a href="unit-tests.html#cb117-5" aria-hidden="true" tabindex="-1"></a>      unemp_2013,</span>
<span id="cb117-6"><a href="unit-tests.html#cb117-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;Paris&quot;</span>, commune),</span>
<span id="cb117-7"><a href="unit-tests.html#cb117-7" aria-hidden="true" tabindex="-1"></a>      active_population)</span>
<span id="cb117-8"><a href="unit-tests.html#cb117-8" aria-hidden="true" tabindex="-1"></a>  }, <span class="st">&quot;This is likely&quot;</span>)</span>
<span id="cb117-9"><a href="unit-tests.html#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="unit-tests.html#cb117-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><code>expect_warning()</code> needs the expression that should raise the warning, and a regular expression.
I’ve used the string “This is likely”, which appears in the warning. This is to make sure that the
correct warning is raised. Should another warning be thrown, the test will fail, and I’ll know that
something’s wrong (try to change the regular expression and rerun the test, you see that it’ll fail).</p>
</div>
<div id="back-to-developing-again" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Back to developing again<a href="unit-tests.html#back-to-developing-again" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now might be a good time to stop writing tests and think a little bit. While writing these tests,
and filling the shoes of your users, you might have realized that your function might not be that
great. We are asking users to enter a regular expression to filter data, which is really not
great nor user-friendly. And this is because the data we’re dealing with is actually not clean,
because the same column mixes three different regional levels. For example, what if the users
wants to take a look at the commune “Luxembourg”?</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="unit-tests.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_unemp</span>(</span>
<span id="cb118-2"><a href="unit-tests.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  unemp_2013,</span>
<span id="cb118-3"><a href="unit-tests.html#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;Luxembourg&quot;</span>, commune),</span>
<span id="cb118-4"><a href="unit-tests.html#cb118-4" aria-hidden="true" tabindex="-1"></a>  active_population)</span></code></pre></div>
<pre><code># A tibble: 3 × 3
 year commune                   active_population
&lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
 2013 Grand-Duche de Luxembourg            242694
 2013 Canton Luxembourg                     68368
 2013 Luxembourg                            43368
</code></pre>
<p>So the user gets back three rows; that’s because there’s the country, the canton and the commune of Luxembourg.
Of course the user can now filter again to just get the commune. But this is not a good interface.</p>
<p>What we should do instead is clean the input data. And while we’re at it, we could also provide the
data directly inside the package. This way users get the data “for free” once they install the
package. Let’s do exactly that. To package data, we first need to create the <code>data-raw</code> folder.
This can be done with the following call:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="unit-tests.html#cb120-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data_raw</span>()</span></code></pre></div>
<p>There’s a script called <code>DATASET.R</code> inside the <code>data-raw</code> folder. This is the script that we
should edit to clean the data. Let’s write the following lines in it:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="unit-tests.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="do">## code to prepare `DATASET` dataset goes here</span></span>
<span id="cb121-2"><a href="unit-tests.html#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="unit-tests.html#cb121-3" aria-hidden="true" tabindex="-1"></a>unemp_2013 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2013.csv&quot;</span>)</span>
<span id="cb121-4"><a href="unit-tests.html#cb121-4" aria-hidden="true" tabindex="-1"></a>unemp_2014 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2014.csv&quot;</span>)</span>
<span id="cb121-5"><a href="unit-tests.html#cb121-5" aria-hidden="true" tabindex="-1"></a>unemp_2015 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/unemp_2015.csv&quot;</span>)</span>
<span id="cb121-6"><a href="unit-tests.html#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="unit-tests.html#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb121-8"><a href="unit-tests.html#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="unit-tests.html#cb121-9" aria-hidden="true" tabindex="-1"></a>clean_data <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb121-10"><a href="unit-tests.html#cb121-10" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&gt;%</span></span>
<span id="cb121-11"><a href="unit-tests.html#cb121-11" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb121-12"><a href="unit-tests.html#cb121-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">level =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-13"><a href="unit-tests.html#cb121-13" aria-hidden="true" tabindex="-1"></a>             <span class="fu">grepl</span>(<span class="st">&quot;Grand-D.*&quot;</span>, commune) <span class="sc">~</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb121-14"><a href="unit-tests.html#cb121-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune) <span class="sc">~</span> <span class="st">&quot;Canton&quot;</span>,</span>
<span id="cb121-15"><a href="unit-tests.html#cb121-15" aria-hidden="true" tabindex="-1"></a>             <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;(Canton|Grand-D.*)&quot;</span>, commune) <span class="sc">~</span> <span class="st">&quot;Commune&quot;</span></span>
<span id="cb121-16"><a href="unit-tests.html#cb121-16" aria-hidden="true" tabindex="-1"></a>           ),</span>
<span id="cb121-17"><a href="unit-tests.html#cb121-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">commune =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Canton&quot;</span>, commune),</span>
<span id="cb121-18"><a href="unit-tests.html#cb121-18" aria-hidden="true" tabindex="-1"></a>                            stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(commune, <span class="st">&quot;Canton &quot;</span>),</span>
<span id="cb121-19"><a href="unit-tests.html#cb121-19" aria-hidden="true" tabindex="-1"></a>                            commune),</span>
<span id="cb121-20"><a href="unit-tests.html#cb121-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">commune =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Grand-D.*&quot;</span>, commune),</span>
<span id="cb121-21"><a href="unit-tests.html#cb121-21" aria-hidden="true" tabindex="-1"></a>                            stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(commune, <span class="st">&quot;Grand-Duche de &quot;</span>),</span>
<span id="cb121-22"><a href="unit-tests.html#cb121-22" aria-hidden="true" tabindex="-1"></a>                            commune),</span>
<span id="cb121-23"><a href="unit-tests.html#cb121-23" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb121-24"><a href="unit-tests.html#cb121-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year,</span>
<span id="cb121-25"><a href="unit-tests.html#cb121-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">place_name =</span> commune,</span>
<span id="cb121-26"><a href="unit-tests.html#cb121-26" aria-hidden="true" tabindex="-1"></a>           level,</span>
<span id="cb121-27"><a href="unit-tests.html#cb121-27" aria-hidden="true" tabindex="-1"></a>           <span class="fu">everything</span>())</span>
<span id="cb121-28"><a href="unit-tests.html#cb121-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-29"><a href="unit-tests.html#cb121-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-30"><a href="unit-tests.html#cb121-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-31"><a href="unit-tests.html#cb121-31" aria-hidden="true" tabindex="-1"></a>my_datasets <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-32"><a href="unit-tests.html#cb121-32" aria-hidden="true" tabindex="-1"></a>  unemp_2013,</span>
<span id="cb121-33"><a href="unit-tests.html#cb121-33" aria-hidden="true" tabindex="-1"></a>  unemp_2014,</span>
<span id="cb121-34"><a href="unit-tests.html#cb121-34" aria-hidden="true" tabindex="-1"></a>  unemp_2015</span>
<span id="cb121-35"><a href="unit-tests.html#cb121-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-36"><a href="unit-tests.html#cb121-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-37"><a href="unit-tests.html#cb121-37" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(my_datasets, clean_data)</span>
<span id="cb121-38"><a href="unit-tests.html#cb121-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-39"><a href="unit-tests.html#cb121-39" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(unemp, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Running this code creates a dataset called <code>unemp</code>, which users of your package will be able to
load using <code>data("unemp")</code> (after having loaded your package). The now contains a new column
called <code>level</code> which will make filtering much easier. After <code>usethis::use_data()</code> is done,
we can read following message in the R console:</p>
<pre><code>✔ Saving &#39;unemp&#39; to &#39;data/unemp.rda&#39;
• Document your data (see &#39;https://r-pkgs.org/data.html&#39;)</code></pre>
<p>We are invited to document our data. To do so, create and edit a file called <code>data.R</code> in the <code>R</code>
directory:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="unit-tests.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Unemployement in Luxembourg data</span></span>
<span id="cb123-2"><a href="unit-tests.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb123-3"><a href="unit-tests.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; A tidy dataset of unemployment data in Luxembourg.</span></span>
<span id="cb123-4"><a href="unit-tests.html#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb123-5"><a href="unit-tests.html#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @format ## `who`</span></span>
<span id="cb123-6"><a href="unit-tests.html#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; A data frame with 7,240 rows and 60 columns:</span></span>
<span id="cb123-7"><a href="unit-tests.html#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \describe{</span></span>
<span id="cb123-8"><a href="unit-tests.html#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{year}{Year}</span></span>
<span id="cb123-9"><a href="unit-tests.html#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{place_name}{Name of commune, canton or country}</span></span>
<span id="cb123-10"><a href="unit-tests.html#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{level}{Country, Canton, or Commune}</span></span>
<span id="cb123-11"><a href="unit-tests.html#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{total_employed_population}{Total employed population living in `place_name`}</span></span>
<span id="cb123-12"><a href="unit-tests.html#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{of_which_wage_earners}{... of which are wage earners living in `place_name`}</span></span>
<span id="cb123-13"><a href="unit-tests.html#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{of_which_non_wage_earners}{... of which are non-wage earners living in `place_name`}</span></span>
<span id="cb123-14"><a href="unit-tests.html#cb123-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{unemployed}{Total unemployed population living in `place_name`}</span></span>
<span id="cb123-15"><a href="unit-tests.html#cb123-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{active_population}{Total active population living in `place_name`}</span></span>
<span id="cb123-16"><a href="unit-tests.html#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{unemployement_rate_in_percent}{Unemployement rate in `place_name`}</span></span>
<span id="cb123-17"><a href="unit-tests.html#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   ...</span></span>
<span id="cb123-18"><a href="unit-tests.html#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb123-19"><a href="unit-tests.html#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @source &lt;https://is.gd/e6wKRk&gt;</span></span>
<span id="cb123-20"><a href="unit-tests.html#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;unemp&quot;</span></span></code></pre></div>
<p>You can now rebuild the document using <code>CTRL-SHIFT-D</code> and reload the package using <code>CRTL-SHIFT-L</code>. You
should now be able to load the data into your session using <code>data("unemp")</code>.</p>
<p>We can now change our function to accommodate this new data format. Let’s edit our function like this:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="unit-tests.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Easily filter unemployment data for Luxembourg</span></span>
<span id="cb124-2"><a href="unit-tests.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param unemp_data A data frame containing unemployment data for Luxembourg.</span></span>
<span id="cb124-3"><a href="unit-tests.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param year_of_interest Optional: The year that should be kept. Leave empty to select every year.</span></span>
<span id="cb124-4"><a href="unit-tests.html#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param place_name_of_interest Optional: The name of the place of interest: leave empty to select every place in `level_of_interest`.</span></span>
<span id="cb124-5"><a href="unit-tests.html#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param level_of_interest Optional: The level of interest: one of `Country`, `Canton`, `Commune`. Leave empty to select every level with the same place name.</span></span>
<span id="cb124-6"><a href="unit-tests.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param col_of_interest A column of the `unemp` data frame that you wish to select.</span></span>
<span id="cb124-7"><a href="unit-tests.html#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom janitor clean_names</span></span>
<span id="cb124-8"><a href="unit-tests.html#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom dplyr filter select</span></span>
<span id="cb124-9"><a href="unit-tests.html#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom rlang quo `!!`</span></span>
<span id="cb124-10"><a href="unit-tests.html#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame</span></span>
<span id="cb124-11"><a href="unit-tests.html#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb124-12"><a href="unit-tests.html#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @details</span></span>
<span id="cb124-13"><a href="unit-tests.html#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Users can filter data on two variables: the name of the place of interest, and the level of interest.</span></span>
<span id="cb124-14"><a href="unit-tests.html#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; By leaving the argument `place_name_of_interest` empty</span></span>
<span id="cb124-15"><a href="unit-tests.html#cb124-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb124-16"><a href="unit-tests.html#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Filter on cantons</span></span>
<span id="cb124-17"><a href="unit-tests.html#cb124-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clean_unemp(unemp,</span></span>
<span id="cb124-18"><a href="unit-tests.html#cb124-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             level_of_interest = &quot;Canton&quot;,</span></span>
<span id="cb124-19"><a href="unit-tests.html#cb124-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             col_of_interest = active_population)</span></span>
<span id="cb124-20"><a href="unit-tests.html#cb124-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Filter on a specific commune</span></span>
<span id="cb124-21"><a href="unit-tests.html#cb124-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clean_unemp(unemp,</span></span>
<span id="cb124-22"><a href="unit-tests.html#cb124-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             place_name_of_interest = &quot;Luxembourg&quot;,</span></span>
<span id="cb124-23"><a href="unit-tests.html#cb124-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             level_of_interest = &quot;Commune&quot;,</span></span>
<span id="cb124-24"><a href="unit-tests.html#cb124-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             col_of_interest = active_population)</span></span>
<span id="cb124-25"><a href="unit-tests.html#cb124-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; # Filter on every level called Luxembourg</span></span>
<span id="cb124-26"><a href="unit-tests.html#cb124-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clean_unemp(unemp,</span></span>
<span id="cb124-27"><a href="unit-tests.html#cb124-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             place_name_of_interest = &quot;Luxembourg&quot;,</span></span>
<span id="cb124-28"><a href="unit-tests.html#cb124-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;             col_of_interest = active_population)</span></span>
<span id="cb124-29"><a href="unit-tests.html#cb124-29" aria-hidden="true" tabindex="-1"></a>clean_unemp <span class="ot">&lt;-</span> <span class="cf">function</span>(unemp_data,</span>
<span id="cb124-30"><a href="unit-tests.html#cb124-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">year_of_interest =</span> <span class="cn">NULL</span>,</span>
<span id="cb124-31"><a href="unit-tests.html#cb124-31" aria-hidden="true" tabindex="-1"></a>                        <span class="at">place_name_of_interest =</span> <span class="cn">NULL</span>,</span>
<span id="cb124-32"><a href="unit-tests.html#cb124-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">level_of_interest =</span> <span class="cn">NULL</span>,</span>
<span id="cb124-33"><a href="unit-tests.html#cb124-33" aria-hidden="true" tabindex="-1"></a>                        col_of_interest){</span>
<span id="cb124-34"><a href="unit-tests.html#cb124-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-35"><a href="unit-tests.html#cb124-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(year_of_interest)){</span>
<span id="cb124-36"><a href="unit-tests.html#cb124-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-37"><a href="unit-tests.html#cb124-37" aria-hidden="true" tabindex="-1"></a>    year_of_interest <span class="ot">&lt;-</span> <span class="fu">quo</span>(year)</span>
<span id="cb124-38"><a href="unit-tests.html#cb124-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-39"><a href="unit-tests.html#cb124-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb124-40"><a href="unit-tests.html#cb124-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-41"><a href="unit-tests.html#cb124-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(place_name_of_interest)){</span>
<span id="cb124-42"><a href="unit-tests.html#cb124-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-43"><a href="unit-tests.html#cb124-43" aria-hidden="true" tabindex="-1"></a>    place_name_of_interest <span class="ot">&lt;-</span> <span class="fu">quo</span>(place_name)</span>
<span id="cb124-44"><a href="unit-tests.html#cb124-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-45"><a href="unit-tests.html#cb124-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb124-46"><a href="unit-tests.html#cb124-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-47"><a href="unit-tests.html#cb124-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(level_of_interest)){</span>
<span id="cb124-48"><a href="unit-tests.html#cb124-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-49"><a href="unit-tests.html#cb124-49" aria-hidden="true" tabindex="-1"></a>    level_of_interest <span class="ot">&lt;-</span> <span class="fu">quo</span>(level)</span>
<span id="cb124-50"><a href="unit-tests.html#cb124-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-51"><a href="unit-tests.html#cb124-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb124-52"><a href="unit-tests.html#cb124-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-53"><a href="unit-tests.html#cb124-53" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> unemp_data <span class="sc">|&gt;</span></span>
<span id="cb124-54"><a href="unit-tests.html#cb124-54" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb124-55"><a href="unit-tests.html#cb124-55" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="sc">!!</span>year_of_interest,</span>
<span id="cb124-56"><a href="unit-tests.html#cb124-56" aria-hidden="true" tabindex="-1"></a>                  place_name <span class="sc">%in%</span> <span class="sc">!!</span>place_name_of_interest,</span>
<span id="cb124-57"><a href="unit-tests.html#cb124-57" aria-hidden="true" tabindex="-1"></a>                  level <span class="sc">%in%</span> <span class="sc">!!</span>level_of_interest) <span class="sc">|&gt;</span></span>
<span id="cb124-58"><a href="unit-tests.html#cb124-58" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(year, place_name, level, {{col_of_interest}})</span>
<span id="cb124-59"><a href="unit-tests.html#cb124-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-60"><a href="unit-tests.html#cb124-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(result) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb124-61"><a href="unit-tests.html#cb124-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;The returned data frame is empty. This is likely because the `place_name_of_interest` or `level_of_interest` argument supplied does not match any rows in the original data.&quot;</span>)</span>
<span id="cb124-62"><a href="unit-tests.html#cb124-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb124-63"><a href="unit-tests.html#cb124-63" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb124-64"><a href="unit-tests.html#cb124-64" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>There’s a lot more going on now: if you don’t get everything that’s going on in this function,
don’t worry, it is not that important for what follows. But do try to understand what’s happening,
especially the part about the optional arguments.</p>
</div>
<div id="and-back-to-testing" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> And back to testing<a href="unit-tests.html#and-back-to-testing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Running our tests now will obviously fail:</p>
<pre><code>➤ devtools::test(&#39;.&#39;)

ℹ Testing myPackage
✔ | F W S  OK | Context
✖ | 6       0 | clean_unemp [0.3s]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Error (test-clean_unemp.R:5:3): selecting the grand duchy works
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. myPackage::clean_unemp(...)
      at test-clean_unemp.R:5:2
 2. base::grepl(&quot;Grand-D.*&quot;, commune)
      at myPackage/R/functions.R:29:2
 3. base::is.factor(x)

Error (test-clean_unemp.R:21:3): selecting cantons work
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. myPackage::clean_unemp(...)
      at test-clean_unemp.R:21:2
 2. base::grepl(&quot;Canton&quot;, commune)
      at myPackage/R/functions.R:29:2
 3. base::is.factor(x)

Error (test-clean_unemp.R:34:3): selecting communes works
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. myPackage::clean_unemp(...)
      at test-clean_unemp.R:34:2
 2. base::grepl(&quot;(Canton|Grand-D.*)&quot;, commune)
      at myPackage/R/functions.R:29:2
 3. base::is.factor(x)

Error (test-clean_unemp.R:47:3): selecting one commune works
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. myPackage::clean_unemp(unemp_2013, grepl(&quot;Kayl&quot;, commune), active_population)
      at test-clean_unemp.R:47:2
 2. base::grepl(&quot;Kayl&quot;, commune)
      at myPackage/R/functions.R:29:2
 3. base::is.factor(x)

Error (test-clean_unemp.R:63:3): wrong commune name
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. myPackage::clean_unemp(unemp_2013, grepl(&quot;Paris&quot;, commune), active_population)
      at test-clean_unemp.R:63:2
 2. base::grepl(&quot;Paris&quot;, commune)
      at myPackage/R/functions.R:29:2
 3. base::is.factor(x)

Error (test-clean_unemp.R:80:3): wrong commune name: warning is thrown
Error in `is.factor(x)`: object &#39;commune&#39; not found
Backtrace:
 1. testthat::expect_warning(...)
      at test-clean_unemp.R:80:2
 8. base::grepl(&quot;Paris&quot;, commune)
      at myPackage/R/functions.R:29:2
 9. base::is.factor(x)
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

══ Results ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════
Duration: 0.4 s

[ FAIL 6 | WARN 0 | SKIP 0 | PASS 0 ]
Warning message:
── Conflicts ────────────────────────────────────────────────────────────────────────────────────────── myPackage conflicts
──
✖ `clean_unemp` masks `myPackage::clean_unemp()`.
ℹ Did you accidentally source a file rather than using `load_all()`?
  Run `rm(list = c(&quot;clean_unemp&quot;))` to remove the conflicts. 
&gt; </code></pre>
<p>At this stage, it might be a good idea to at least commit. Maybe let’s not push yet, and only
push once the tests have been rewritten to pass. Commit from RStudio or from a terminal, the
choice is yours. We now have to rewrite the tests, to make them pass again. We also need
to recreate the csv files for some of the tests, and will probably need to create others. This is
what the script containing the tests could look like once you’re done:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="unit-tests.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting the grand duchy works&quot;</span>, {</span>
<span id="cb126-2"><a href="unit-tests.html#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="unit-tests.html#cb126-3" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb126-4"><a href="unit-tests.html#cb126-4" aria-hidden="true" tabindex="-1"></a>    unemp,</span>
<span id="cb126-5"><a href="unit-tests.html#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-6"><a href="unit-tests.html#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">level_of_interest =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb126-7"><a href="unit-tests.html#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_of_interest =</span> active_population) <span class="sc">|&gt;</span></span>
<span id="cb126-8"><a href="unit-tests.html#cb126-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb126-9"><a href="unit-tests.html#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="unit-tests.html#cb126-10" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb126-11"><a href="unit-tests.html#cb126-11" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>,</span>
<span id="cb126-12"><a href="unit-tests.html#cb126-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;place_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;Luxembourg&quot;</span>,</span>
<span id="cb126-13"><a href="unit-tests.html#cb126-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;level&quot;</span> <span class="ot">=</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb126-14"><a href="unit-tests.html#cb126-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">242694</span>)</span>
<span id="cb126-15"><a href="unit-tests.html#cb126-15" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb126-16"><a href="unit-tests.html#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="unit-tests.html#cb126-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb126-18"><a href="unit-tests.html#cb126-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-19"><a href="unit-tests.html#cb126-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb126-20"><a href="unit-tests.html#cb126-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-21"><a href="unit-tests.html#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting cantons work&quot;</span>, {</span>
<span id="cb126-22"><a href="unit-tests.html#cb126-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-23"><a href="unit-tests.html#cb126-23" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb126-24"><a href="unit-tests.html#cb126-24" aria-hidden="true" tabindex="-1"></a>    unemp,</span>
<span id="cb126-25"><a href="unit-tests.html#cb126-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-26"><a href="unit-tests.html#cb126-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">level_of_interest =</span> <span class="st">&quot;Canton&quot;</span>,</span>
<span id="cb126-27"><a href="unit-tests.html#cb126-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_of_interest =</span> active_population) <span class="sc">|&gt;</span></span>
<span id="cb126-28"><a href="unit-tests.html#cb126-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb126-29"><a href="unit-tests.html#cb126-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-30"><a href="unit-tests.html#cb126-30" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;test_data_cantons.csv&quot;</span>)</span>
<span id="cb126-31"><a href="unit-tests.html#cb126-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-32"><a href="unit-tests.html#cb126-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb126-33"><a href="unit-tests.html#cb126-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-34"><a href="unit-tests.html#cb126-34" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb126-35"><a href="unit-tests.html#cb126-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-36"><a href="unit-tests.html#cb126-36" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting communes works&quot;</span>, {</span>
<span id="cb126-37"><a href="unit-tests.html#cb126-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-38"><a href="unit-tests.html#cb126-38" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb126-39"><a href="unit-tests.html#cb126-39" aria-hidden="true" tabindex="-1"></a>    unemp,</span>
<span id="cb126-40"><a href="unit-tests.html#cb126-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-41"><a href="unit-tests.html#cb126-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">level_of_interest =</span> <span class="st">&quot;Commune&quot;</span>,</span>
<span id="cb126-42"><a href="unit-tests.html#cb126-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_of_interest =</span> active_population) <span class="sc">|&gt;</span></span>
<span id="cb126-43"><a href="unit-tests.html#cb126-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb126-44"><a href="unit-tests.html#cb126-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-45"><a href="unit-tests.html#cb126-45" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;test_data_communes.csv&quot;</span>)</span>
<span id="cb126-46"><a href="unit-tests.html#cb126-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-47"><a href="unit-tests.html#cb126-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb126-48"><a href="unit-tests.html#cb126-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-49"><a href="unit-tests.html#cb126-49" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb126-50"><a href="unit-tests.html#cb126-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-51"><a href="unit-tests.html#cb126-51" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;selecting one commune works&quot;</span>, {</span>
<span id="cb126-52"><a href="unit-tests.html#cb126-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-53"><a href="unit-tests.html#cb126-53" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb126-54"><a href="unit-tests.html#cb126-54" aria-hidden="true" tabindex="-1"></a>    unemp,</span>
<span id="cb126-55"><a href="unit-tests.html#cb126-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-56"><a href="unit-tests.html#cb126-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">place_name_of_interest =</span> <span class="st">&quot;Kayl&quot;</span>,</span>
<span id="cb126-57"><a href="unit-tests.html#cb126-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_of_interest =</span> active_population) <span class="sc">|&gt;</span></span>
<span id="cb126-58"><a href="unit-tests.html#cb126-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb126-59"><a href="unit-tests.html#cb126-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-60"><a href="unit-tests.html#cb126-60" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb126-61"><a href="unit-tests.html#cb126-61" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="dv">2013</span>,</span>
<span id="cb126-62"><a href="unit-tests.html#cb126-62" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;place_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;Kayl&quot;</span>,</span>
<span id="cb126-63"><a href="unit-tests.html#cb126-63" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;level&quot;</span> <span class="ot">=</span> <span class="st">&quot;Commune&quot;</span>,</span>
<span id="cb126-64"><a href="unit-tests.html#cb126-64" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="dv">3863</span>))</span>
<span id="cb126-65"><a href="unit-tests.html#cb126-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-66"><a href="unit-tests.html#cb126-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb126-67"><a href="unit-tests.html#cb126-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-68"><a href="unit-tests.html#cb126-68" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb126-69"><a href="unit-tests.html#cb126-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-70"><a href="unit-tests.html#cb126-70" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;wrong commune name&quot;</span>, {</span>
<span id="cb126-71"><a href="unit-tests.html#cb126-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-72"><a href="unit-tests.html#cb126-72" aria-hidden="true" tabindex="-1"></a>  returned_value <span class="ot">&lt;-</span> <span class="fu">clean_unemp</span>(</span>
<span id="cb126-73"><a href="unit-tests.html#cb126-73" aria-hidden="true" tabindex="-1"></a>    unemp,</span>
<span id="cb126-74"><a href="unit-tests.html#cb126-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-75"><a href="unit-tests.html#cb126-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">place_name_of_interest =</span> <span class="st">&quot;Paris&quot;</span>,</span>
<span id="cb126-76"><a href="unit-tests.html#cb126-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_of_interest =</span> active_population) <span class="sc">|&gt;</span></span>
<span id="cb126-77"><a href="unit-tests.html#cb126-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb126-78"><a href="unit-tests.html#cb126-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-79"><a href="unit-tests.html#cb126-79" aria-hidden="true" tabindex="-1"></a>  expected_value <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb126-80"><a href="unit-tests.html#cb126-80" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb126-81"><a href="unit-tests.html#cb126-81" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;place_name&quot;</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb126-82"><a href="unit-tests.html#cb126-82" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;level&quot;</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb126-83"><a href="unit-tests.html#cb126-83" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;active_population&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">0</span>)))</span>
<span id="cb126-84"><a href="unit-tests.html#cb126-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-85"><a href="unit-tests.html#cb126-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-86"><a href="unit-tests.html#cb126-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(returned_value, expected_value)</span>
<span id="cb126-87"><a href="unit-tests.html#cb126-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-88"><a href="unit-tests.html#cb126-88" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb126-89"><a href="unit-tests.html#cb126-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-90"><a href="unit-tests.html#cb126-90" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;wrong commune name: warning is thrown&quot;</span>, {</span>
<span id="cb126-91"><a href="unit-tests.html#cb126-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-92"><a href="unit-tests.html#cb126-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_warning</span>({</span>
<span id="cb126-93"><a href="unit-tests.html#cb126-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_unemp</span>(</span>
<span id="cb126-94"><a href="unit-tests.html#cb126-94" aria-hidden="true" tabindex="-1"></a>      unemp,</span>
<span id="cb126-95"><a href="unit-tests.html#cb126-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_of_interest =</span> <span class="dv">2013</span>,</span>
<span id="cb126-96"><a href="unit-tests.html#cb126-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">place_name_of_interest =</span> <span class="st">&quot;Paris&quot;</span>,</span>
<span id="cb126-97"><a href="unit-tests.html#cb126-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_of_interest =</span> active_population)</span>
<span id="cb126-98"><a href="unit-tests.html#cb126-98" aria-hidden="true" tabindex="-1"></a>  }, <span class="st">&quot;This is likely&quot;</span>)</span>
<span id="cb126-99"><a href="unit-tests.html#cb126-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-100"><a href="unit-tests.html#cb126-100" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Once you’re done, commit and push your changes.</p>
<p>You should now have a pretty good intuition about unit tests. As you can see, unit tests are not just
useful to make sure that changes that get introduced in our functions don’t result in regressions in
our code, but also to actually improve our code. Writing unit tests allows us to fill the shoes
of our users and rethink our code.</p>
<p>A little sidenote before continuing; you might want to look into <em>code coverage</em> using the <code>{covr}</code>
package. This package helps you identify code from your package that is not tested yet. The goal
of course being to improve the coverage as much as possible! Take a look at
<a href="https://covr.r-lib.org/"><code>{cover}</code>’s website</a> to learn more.</p>
<p>Ok, one final thing; let’s say that we’re happy with our package. To actually use it in other
projects we have to install it to our library. To do so, make sure RStudio is inside the
right project, and press <code>CTRL-SHIFT-B</code>. This will install the package to our library.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="package-development.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="setting-up-pipelines-with-targets.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/b-rodrigues/rap4mads/edit/master/06-unit-tests.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/b-rodrigues/rap4mads/blob/master/06-unit-tests.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
